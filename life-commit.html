<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Commit - ë‹¹ì‹ ì˜ í•˜ë£¨ë¥¼ ì»¤ë°‹í•˜ì„¸ìš”</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Firebase ì„¤ì • - Firebase Consoleì—ì„œ ê°€ì ¸ì˜¨ ê°’ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ì „ì—­ìœ¼ë¡œ Firebase ê°ì²´ ë…¸ì¶œ
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthFunctions = { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged };
        window.firebaseDbFunctions = { doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, updateDoc, deleteDoc };
    </script>

    <style>
        :root {
            --grass-empty: #1a1f2e;
            --grass-level-1: #0e4429;
            --grass-level-2: #006d32;
            --grass-level-3: #26a641;
            --grass-level-4: #39d353;
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border: #30363d;
            --accent: #58a6ff;
            --accent-hover: #79c0ff;
            --success: #3fb950;
            --warning: #d29922;
            --danger: #f85149;
        }

        [data-theme="light"] {
            --grass-empty: #ebedf0;
            --grass-level-1: #9be9a8;
            --grass-level-2: #40c463;
            --grass-level-3: #30a14e;
            --grass-level-4: #216e39;
            --bg-primary: #ffffff;
            --bg-secondary: #f6f8fa;
            --bg-tertiary: #eaeef2;
            --text-primary: #1f2328;
            --text-secondary: #656d76;
            --text-muted: #8c959f;
            --border: #d0d7de;
            --accent: #0969da;
            --accent-hover: #0550ae;
            --success: #1a7f37;
            --warning: #bf8700;
            --danger: #cf222e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app {
            display: flex;
            min-height: 100vh;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 24px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .logo {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .logo h1 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: opacity 0.2s;
        }

        .logo h1:hover {
            opacity: 0.8;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: var(--success);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .nav-menu {
            list-style: none;
            padding: 0 12px;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 14px;
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-section {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent), var(--success));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .logout-btn {
            width: 100%;
            padding: 8px;
            background: transparent;
            color: var(--danger);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: rgba(248, 81, 73, 0.1);
            border-color: var(--danger);
        }

        .theme-toggle-btn {
            width: 100%;
            padding: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            font-family: inherit;
        }

        .theme-toggle-btn:hover {
            background: var(--border);
        }

        .theme-icon {
            font-size: 16px;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 32px 48px;
            max-width: 1400px;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* í—¤ë” */
        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 15px;
        }

        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .today-info h2 {
            font-size: 24px;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .today-date {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(var(--success) 0%, var(--grass-empty) 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .progress-inner {
            width: 64px;
            height: 64px;
            background: var(--bg-secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .progress-text {
            font-size: 20px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .progress-label {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* ì·¨ë¯¸ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .hobby-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .hobby-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .hobby-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .hobby-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .hobby-info {
            flex: 1;
        }

        .hobby-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-icon {
            font-size: 20px;
        }

        .hobby-target {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .hobby-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-pending {
            background: rgba(139, 148, 158, 0.15);
            color: var(--text-secondary);
        }

        .status-completed {
            background: rgba(63, 185, 80, 0.15);
            color: var(--success);
        }

        .status-exceeded {
            background: rgba(210, 153, 34, 0.15);
            color: var(--warning);
        }

        .hobby-action {
            margin-top: 16px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* ìœ„ì ¯ ê·¸ë¦¬ë“œ */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .widget {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .widget-title {
            font-size: 16px;
            font-weight: 600;
        }

        .widget-action {
            color: var(--accent);
            font-size: 13px;
            text-decoration: none;
            cursor: pointer;
        }

        .widget-action:hover {
            text-decoration: underline;
        }

        /* ë¯¸ë‹ˆ ì”ë”” */
        .mini-grass {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
        }

        .mini-grass-week {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .grass-cell {
            width: 12px;
            height: 12px;
            background: var(--grass-empty);
            border-radius: 2px;
            transition: all 0.2s;
        }

        .grass-cell.level-1 {
            background: var(--grass-level-1);
        }

        .grass-cell.level-2 {
            background: var(--grass-level-2);
        }

        .grass-cell.level-3 {
            background: var(--grass-level-3);
        }

        .grass-cell.level-4 {
            background: var(--grass-level-4);
        }

        .grass-cell:hover {
            transform: scale(1.2);
            border: 1px solid var(--accent);
        }

        .overall-count {
            margin-top: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
        }

        /* í†µê³„ ì¹´ë“œ */
        .stat-card {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
        }

        /* ì”ë””ë°­ ì „ì²´ ë·° */
        .grass-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .grass-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .year-selector {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
        }

        .grass-graph {
            overflow-x: auto;
            padding-bottom: 16px;
        }

        .grass-grid {
            display: inline-flex;
            gap: 3px;
        }

        .grass-column {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .grass-cell-full {
            width: 14px;
            height: 14px;
            background: var(--grass-empty);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
        }

        .grass-cell-full:hover {
            transform: scale(1.3);
            z-index: 10;
            box-shadow: 0 0 0 2px var(--accent);
        }

        .grass-cell-full.level-1 {
            background: var(--grass-level-1);
        }

        .grass-cell-full.level-2 {
            background: var(--grass-level-2);
        }

        .grass-cell-full.level-3 {
            background: var(--grass-level-3);
        }

        .grass-cell-full.level-4 {
            background: var(--grass-level-4);
        }

        .grass-legend {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .grass-legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .month-labels {
            display: flex;
            gap: 3px;
            margin-bottom: 8px;
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.2s ease-in;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 12px;
        }

        .radio-group {
            display: flex;
            gap: 12px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
        }

        .radio-label:hover {
            border-color: var(--accent);
        }

        .radio-label input[type="radio"] {
            margin: 0;
        }

        .radio-label input[type="radio"]:checked + span {
            font-weight: 600;
        }

        .radio-label:has(input:checked) {
            background: rgba(88, 166, 255, 0.1);
            border-color: var(--accent);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* ì·¨ë¯¸ ëª©ë¡ */
        .hobby-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hobby-list-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .hobby-list-item:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .hobby-list-info {
            flex: 1;
        }

        .hobby-list-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-list-meta {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .hobby-list-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .btn-icon:hover {
            background: var(--border);
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: var(--success);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 64px 32px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-text {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* ë¡œê·¸ì¸ í˜ì´ì§€ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
            padding: 24px;
        }

        .login-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 48px;
            max-width: 440px;
            width: 100%;
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 32px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 12px;
        }

        .login-tagline {
            color: var(--text-secondary);
            font-size: 15px;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-actions {
            margin-top: 24px;
        }

        .login-footer {
            text-align: center;
            margin-top: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .login-footer a {
            color: var(--accent);
            text-decoration: none;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        .auth-error {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            text-align: center;
        }

        .auth-loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* í†µê³„ í˜ì´ì§€ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stats-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .stats-card-title {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stats-card-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 36px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 8px;
        }

        .stats-card-label {
            color: var(--text-muted);
            font-size: 12px;
        }

        .hobby-stats-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hobby-stat-item {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .hobby-stat-item:hover {
            background: var(--border);
            transform: translateX(4px);
        }

        .hobby-stat-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--success);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 24px 16px;
            }

            .hobby-grid {
                grid-template-columns: 1fr;
            }

            .widgets-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* íˆ´íŒ */
        .tooltip {
            position: fixed;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 2000;
            display: none;
            white-space: nowrap;
        }

        .tooltip.active {
            display: block;
        }

        /* ìƒ‰ìƒ ì„ íƒê¸° */
        .color-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
        }

        /* ì•„ì´ì½˜ ì„ íƒê¸° */
        .icon-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .icon-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .icon-option:hover {
            transform: scale(1.1);
            background: var(--border);
        }

        .icon-option.selected {
            border-color: var(--accent);
            background: rgba(88, 166, 255, 0.1);
        }

        .record-display {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .record-date {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .record-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 4px;
        }

        .record-memo {
            color: var(--text-secondary);
            font-size: 14px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="login-logo">ğŸŒ± Life Commit</div>
                <div class="login-tagline">ë‹¹ì‹ ì˜ í•˜ë£¨ë¥¼ ì»¤ë°‹í•˜ì„¸ìš”</div>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label class="form-label">ì´ë©”ì¼</label>
                    <input type="email" class="form-input" id="authEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-input" id="authPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="6">
                </div>
                <div id="authError" class="auth-error" style="display: none;"></div>
                <div class="login-actions">
                    <button type="submit" class="btn btn-primary" id="authSubmitBtn">ë¡œê·¸ì¸</button>
                </div>
            </form>
            <div class="login-footer">
                <span id="authToggleText">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?</span> <a href="#" id="authToggleLink">íšŒì›ê°€ì…</a>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì•± -->
    <div id="mainApp" class="app" style="display: none;">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <div class="logo">
                <h1 style="cursor: pointer;" onclick="navigateTo('dashboard')">
                    <span class="logo-icon">ğŸŒ±</span>
                    Life Commit
                </h1>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a class="nav-link active" data-page="dashboard">
                            <span class="nav-icon">ğŸ“Š</span>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="overall">
                            <span class="nav-icon">ğŸ†</span>
                            Overall
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="stats">
                            <span class="nav-icon">ğŸ“ˆ</span>
                            Stats
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="hobbies">
                            <span class="nav-icon">âš™ï¸</span>
                            Hobbies
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="user-section">
                <div class="user-info">
                    <div class="user-avatar">U</div>
                    <div class="user-name" id="userName">ì‚¬ìš©ì</div>
                </div>
                <button class="theme-toggle-btn" id="themeToggle">
                    <span class="theme-icon">ğŸŒ™</span>
                    <span class="theme-text">ë‹¤í¬ ëª¨ë“œ</span>
                </button>
                <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </aside>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ -->
            <div id="dashboardPage" class="page active">
                <div class="dashboard-header">
                    <div class="today-info">
                        <h2 id="todayDate">2026ë…„ 1ì›” 30ì¼ ê¸ˆìš”ì¼</h2>
                        <div class="today-date">ì˜¤ëŠ˜ì˜ ëª©í‘œë¥¼ ì™„ë£Œí•˜ì„¸ìš”</div>
                    </div>
                    <div class="progress-circle" id="todayProgress">
                        <div class="progress-inner">
                            <div class="progress-text">0/0</div>
                            <div class="progress-label">ì™„ë£Œ</div>
                        </div>
                    </div>
                </div>

                <div id="hobbyCardsContainer" class="hobby-grid">
                    <!-- ì·¨ë¯¸ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <!-- Overall ì”ë””ë°­ ì„¹ì…˜ -->
                <div style="margin-top: 48px;">
                    <div class="page-header" style="margin-bottom: 24px;">
                        <h2 class="page-title" style="font-size: 24px;">Overall ì”ë””ë°­</h2>
                        <p class="page-subtitle">ëª¨ë“  ëª©í‘œë¥¼ ë‹¬ì„±í•œ ì™„ë²½í•œ í•˜ë£¨ë“¤</p>
                    </div>
                    <div class="grass-container">
                        <div class="grass-header">
                            <h3>ì—°ê°„ ì¢…í•© ë‹¬ì„±</h3>
                            <select class="year-selector" id="dashboardOverallYearSelect">
                                <option value="2026">2026</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                        <div id="dashboardOverallGrassContainer"></div>
                    </div>
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stats-card">
                            <div class="stats-card-title">ì˜¬í•´ ì™„ë²½í•œ í•˜ë£¨</div>
                            <div class="stats-card-value" id="dashboardOverallYearCount">0</div>
                            <div class="stats-card-label">ì¼</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-title">í˜„ì¬ ì—°ì† ê¸°ë¡</div>
                            <div class="stats-card-value" id="dashboardOverallCurrentStreak">0</div>
                            <div class="stats-card-label">ì¼</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-title">ìµœì¥ ì—°ì† ê¸°ë¡</div>
                            <div class="stats-card-value" id="dashboardOverallMaxStreak">0</div>
                            <div class="stats-card-label">ì¼</div>
                        </div>
                    </div>
                </div>

                <!-- í†µê³„ ì„¹ì…˜ -->
                <div style="margin-top: 48px;">
                    <div class="page-header" style="margin-bottom: 24px;">
                        <h2 class="page-title" style="font-size: 24px;">í†µê³„</h2>
                        <p class="page-subtitle">ë‹¹ì‹ ì˜ ì„±ì·¨ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                    <div style="margin-bottom: 24px;">
                        <select class="year-selector" id="dashboardStatsYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div class="stats-grid" id="dashboardStatsContainer">
                        <!-- í†µê³„ ì¹´ë“œë“¤ -->
                    </div>
                    <div class="grass-container" style="margin-top: 24px;">
                        <h3 style="margin-bottom: 24px;">ì·¨ë¯¸ë³„ ë‹¬ì„±ë¥ </h3>
                        <div class="hobby-stats-list" id="dashboardHobbyStatsContainer">
                            <!-- ì·¨ë¯¸ë³„ í†µê³„ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì·¨ë¯¸ ê´€ë¦¬ í˜ì´ì§€ -->
            <div id="hobbiesPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">ì·¨ë¯¸ ê´€ë¦¬</h1>
                    <p class="page-subtitle">ìŠµê´€ê³¼ ëª©í‘œë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</p>
                </div>
                <div style="margin-bottom: 24px;">
                    <button class="btn btn-primary" id="newHobbyBtn">+ ìƒˆ ì·¨ë¯¸ ì¶”ê°€</button>
                </div>
                <div id="hobbyListContainer" class="hobby-list">
                    <!-- ì·¨ë¯¸ ëª©ë¡ -->
                </div>
            </div>

            <!-- Overall í˜ì´ì§€ -->
            <div id="overallPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">Overall ì”ë””ë°­</h1>
                    <p class="page-subtitle">ëª¨ë“  ëª©í‘œë¥¼ ë‹¬ì„±í•œ ì™„ë²½í•œ í•˜ë£¨ë“¤</p>
                </div>
                <div class="grass-container">
                    <div class="grass-header">
                        <h3>ì—°ê°„ ì¢…í•© ë‹¬ì„±</h3>
                        <select class="year-selector" id="overallYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div id="overallGrassContainer"></div>
                </div>
                <div class="stats-grid">
                    <div class="stats-card">
                        <div class="stats-card-title">ì˜¬í•´ ì™„ë²½í•œ í•˜ë£¨</div>
                        <div class="stats-card-value" id="overallYearCount">0</div>
                        <div class="stats-card-label">ì¼</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-title">í˜„ì¬ ì—°ì† ê¸°ë¡</div>
                        <div class="stats-card-value" id="overallCurrentStreak">0</div>
                        <div class="stats-card-label">ì¼</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-title">ìµœì¥ ì—°ì† ê¸°ë¡</div>
                        <div class="stats-card-value" id="overallMaxStreak">0</div>
                        <div class="stats-card-label">ì¼</div>
                    </div>
                </div>
            </div>

            <!-- í†µê³„ í˜ì´ì§€ -->
            <div id="statsPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">í†µê³„</h1>
                    <p class="page-subtitle">ë‹¹ì‹ ì˜ ì„±ì·¨ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
                </div>
                <div style="margin-bottom: 24px;">
                    <select class="year-selector" id="statsYearSelect">
                        <option value="2026">2026</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
                <div class="stats-grid" id="statsContainer">
                    <!-- í†µê³„ ì¹´ë“œë“¤ -->
                </div>
                <div class="grass-container">
                    <h3 style="margin-bottom: 24px;">ì·¨ë¯¸ë³„ ë‹¬ì„±ë¥ </h3>
                    <div class="hobby-stats-list" id="hobbyStatsContainer">
                        <!-- ì·¨ë¯¸ë³„ í†µê³„ -->
                    </div>
                </div>
            </div>

            <!-- ì·¨ë¯¸ ìƒì„¸ í˜ì´ì§€ -->
            <div id="hobbyDetailPage" class="page">
                <div class="page-header">
                    <h1 class="page-title" id="hobbyDetailTitle">ì·¨ë¯¸ ìƒì„¸</h1>
                    <p class="page-subtitle" id="hobbyDetailSubtitle"></p>
                </div>
                <div class="grass-container">
                    <div class="grass-header">
                        <h3 id="hobbyDetailName">ì”ë””ë°­</h3>
                        <select class="year-selector" id="hobbyDetailYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div id="hobbyDetailGrassContainer"></div>
                </div>
                <div style="margin-top: 24px;">
                    <button class="btn btn-secondary" id="backToDashboard">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            </div>
        </main>
    </div>

    <!-- ê¸°ë¡ ëª¨ë‹¬ -->
    <div id="recordModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeRecordModal()">Ã—</button>
            <div class="modal-header">
                <h2 class="modal-title" id="recordModalTitle">ì˜¤ëŠ˜ ê¸°ë¡í•˜ê¸°</h2>
                <div class="modal-subtitle" id="recordModalSubtitle"></div>
            </div>
            <form id="recordForm">
                <div id="recordFormContent">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                </div>
                <div class="form-group">
                    <label class="form-label">ë©”ëª¨ (ì„ íƒ)</label>
                    <textarea class="form-textarea" id="recordMemo" placeholder="ì˜¤ëŠ˜ì˜ ì†Œê°ì„ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeRecordModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-success">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì·¨ë¯¸ ìƒì„±/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="hobbyModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeHobbyModal()">Ã—</button>
            <div class="modal-header">
                <h2 class="modal-title" id="hobbyModalTitle">ìƒˆ ì·¨ë¯¸ ì¶”ê°€</h2>
                <div class="modal-subtitle">ê¾¸ì¤€íˆ ì‹¤ì²œí•  ìŠµê´€ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</div>
            </div>
            <form id="hobbyForm">
                <div class="form-group">
                    <label class="form-label">ì·¨ë¯¸ëª… *</label>
                    <input type="text" class="form-input" id="hobbyName" placeholder="ì˜ˆ: ìš´ë™, ë…ì„œ, ì˜ë‹¨ì–´" required maxlength="20">
                </div>
                <div class="form-group">
                    <label class="form-label">íƒ€ì… *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="hobbyType" value="quant" checked>
                            <span>ìˆ˜ì¹˜í˜•</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="hobbyType" value="binary">
                            <span>ì™„ë£Œí˜•</span>
                        </label>
                    </div>
                </div>
                <div id="quantFields">
                    <div class="form-group">
                        <label class="form-label">ëª©í‘œ</label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="targetValue" placeholder="30" min="1" required>
                            <select class="form-select" id="targetUnit" required>
                                <option value="ë¶„">ë¶„</option>
                                <option value="ê°œ">ê°œ</option>
                                <option value="íšŒ">íšŒ</option>
                                <option value="í˜ì´ì§€">í˜ì´ì§€</option>
                                <option value="km">km</option>
                                <option value="ì”">ì”</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="binaryFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">ëª©í‘œ ì„¤ëª… (ì„ íƒ)</label>
                        <input type="text" class="form-input" id="binaryDesc" placeholder="ì˜ˆ: 30ë¶„ ì´ìƒ ë…ì„œí•˜ê¸°">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì•„ì´ì½˜</label>
                    <div class="icon-picker" id="iconPicker">
                        <div class="icon-option selected" data-icon="ğŸ’ª">ğŸ’ª</div>
                        <div class="icon-option" data-icon="ğŸ“š">ğŸ“š</div>
                        <div class="icon-option" data-icon="âœï¸">âœï¸</div>
                        <div class="icon-option" data-icon="ğŸƒ">ğŸƒ</div>
                        <div class="icon-option" data-icon="ğŸ§˜">ğŸ§˜</div>
                        <div class="icon-option" data-icon="ğŸ¨">ğŸ¨</div>
                        <div class="icon-option" data-icon="ğŸµ">ğŸµ</div>
                        <div class="icon-option" data-icon="ğŸ®">ğŸ®</div>
                        <div class="icon-option" data-icon="ğŸ’»">ğŸ’»</div>
                        <div class="icon-option" data-icon="ğŸŒ¿">ğŸŒ¿</div>
                        <div class="icon-option" data-icon="â˜•">â˜•</div>
                        <div class="icon-option" data-icon="ğŸ">ğŸ</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeHobbyModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-success">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- íˆ´íŒ -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        // ì „ì—­ ìƒíƒœ
        let currentUser = null;
        let hobbies = [];
        let records = [];
        let currentPage = 'dashboard';
        let selectedHobbyId = null;
        let isSignupMode = false;

        // ìƒ‰ìƒ ìƒìˆ˜
        const COLORS = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'];

        // ë‚ ì§œ ìœ í‹¸ë¦¬í‹°
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function parseDate(dateStr) {
            return new Date(dateStr + 'T00:00:00');
        }

        function getKoreanDate(date) {
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayOfWeek = days[date.getDay()];
            return `${year}ë…„ ${month}ì›” ${day}ì¼ ${dayOfWeek}ìš”ì¼`;
        }

        function getTodayString() {
            return formatDate(new Date());
        }

        // Firebase Firestore ìœ í‹¸ë¦¬í‹°
        async function saveToFirestore() {
            if (!currentUser || !window.firebaseDb) return;

            const { doc, setDoc } = window.firebaseDbFunctions;
            const db = window.firebaseDb;

            try {
                // ìœ ì € ë°ì´í„° ì €ì¥
                await setDoc(doc(db, 'users', currentUser.uid), {
                    email: currentUser.email,
                    name: currentUser.name,
                    updatedAt: new Date().toISOString()
                });

                // ì·¨ë¯¸ ë°ì´í„° ì €ì¥
                await setDoc(doc(db, 'users', currentUser.uid, 'data', 'hobbies'), {
                    items: hobbies
                });

                // ê¸°ë¡ ë°ì´í„° ì €ì¥
                await setDoc(doc(db, 'users', currentUser.uid, 'data', 'records'), {
                    items: records
                });

                console.log('Firestoreì— ì €ì¥ ì™„ë£Œ');
            } catch (error) {
                console.error('Firestore ì €ì¥ ì˜¤ë¥˜:', error);
                // ì˜¤í”„ë¼ì¸ ë°±ì—…ìœ¼ë¡œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë„ ì‚¬ìš©
                saveToLocalStorage();
            }
        }

        async function loadFromFirestore() {
            if (!currentUser || !window.firebaseDb) return;

            const { doc, getDoc } = window.firebaseDbFunctions;
            const db = window.firebaseDb;

            try {
                // ì·¨ë¯¸ ë°ì´í„° ë¡œë“œ
                const hobbiesDoc = await getDoc(doc(db, 'users', currentUser.uid, 'data', 'hobbies'));
                if (hobbiesDoc.exists()) {
                    hobbies = hobbiesDoc.data().items || [];
                }

                // ê¸°ë¡ ë°ì´í„° ë¡œë“œ
                const recordsDoc = await getDoc(doc(db, 'users', currentUser.uid, 'data', 'records'));
                if (recordsDoc.exists()) {
                    records = recordsDoc.data().items || [];
                }

                console.log('Firestoreì—ì„œ ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('Firestore ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì˜¤í”„ë¼ì¸ ë°±ì—…ì—ì„œ ë¡œë“œ ì‹œë„
                loadFromLocalStorage();
            }
        }

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°±ì—… (ì˜¤í”„ë¼ì¸ ì§€ì›)
        function saveToLocalStorage() {
            localStorage.setItem('lifeCommitData', JSON.stringify({
                hobbies,
                records
            }));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('lifeCommitData');
            if (data) {
                const parsed = JSON.parse(data);
                hobbies = parsed.hobbies || [];
                records = parsed.records || [];
            }
        }

        // ì €ì¥ í•¨ìˆ˜ (Firestore ìš°ì„ , ë¡œì»¬ ë°±ì—…)
        async function saveToStorage() {
            if (currentUser && window.firebaseDb) {
                await saveToFirestore();
            }
            saveToLocalStorage();
        }

        // ë¡œë“œ í•¨ìˆ˜ (Firestore ìš°ì„ , ë¡œì»¬ ë°±ì—…)
        async function loadFromStorage() {
            if (currentUser && window.firebaseDb) {
                await loadFromFirestore();
            } else {
                loadFromLocalStorage();
            }
        }

        // í…Œë§ˆ ê´€ë¦¬
        function initTheme() {
            const savedTheme = localStorage.getItem('lifeCommitTheme') || 'dark';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('lifeCommitTheme', theme);
            
            const themeIcon = document.querySelector('.theme-icon');
            const themeText = document.querySelector('.theme-text');
            
            if (themeIcon && themeText) {
                if (theme === 'light') {
                    themeIcon.textContent = 'ğŸŒ™';
                    themeText.textContent = 'ë‹¤í¬ ëª¨ë“œ';
                } else {
                    themeIcon.textContent = 'â˜€ï¸';
                    themeText.textContent = 'ë¼ì´íŠ¸ ëª¨ë“œ';
                }
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        // UUID ìƒì„±
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function hideAuthError() {
            document.getElementById('authError').style.display = 'none';
        }

        // íšŒì›ê°€ì…/ë¡œê·¸ì¸ í† ê¸€
        document.getElementById('authToggleLink').addEventListener('click', function(e) {
            e.preventDefault();
            isSignupMode = !isSignupMode;

            const submitBtn = document.getElementById('authSubmitBtn');
            const toggleText = document.getElementById('authToggleText');
            const toggleLink = document.getElementById('authToggleLink');

            if (isSignupMode) {
                submitBtn.textContent = 'íšŒì›ê°€ì…';
                toggleText.textContent = 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?';
                toggleLink.textContent = 'ë¡œê·¸ì¸';
            } else {
                submitBtn.textContent = 'ë¡œê·¸ì¸';
                toggleText.textContent = 'ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?';
                toggleLink.textContent = 'íšŒì›ê°€ì…';
            }

            hideAuthError();
        });

        // Firebase ì—ëŸ¬ ë©”ì‹œì§€ í•œê¸€í™”
        function getFirebaseErrorMessage(errorCode) {
            const errorMessages = {
                'auth/email-already-in-use': 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.',
                'auth/invalid-email': 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.',
                'auth/operation-not-allowed': 'ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.',
                'auth/weak-password': 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤. (ìµœì†Œ 6ì)',
                'auth/user-disabled': 'ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤.',
                'auth/user-not-found': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤.',
                'auth/wrong-password': 'ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.',
                'auth/invalid-credential': 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.',
                'auth/too-many-requests': 'ë„ˆë¬´ ë§ì€ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                'auth/network-request-failed': 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
            };
            return errorMessages[errorCode] || 'ì¸ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        }

        // ì´ˆê¸° ë°ì´í„° ìƒì„± (ìƒˆ ì‚¬ìš©ììš©)
        function createInitialData() {
            hobbies = [
                {
                    id: generateId(),
                    name: 'ìš´ë™',
                    type: 'quant',
                    targetValue: 30,
                    unit: 'ë¶„',
                    icon: 'ğŸ’ª',
                    color: COLORS[0],
                    isActive: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: 'ë…ì„œ',
                    type: 'quant',
                    targetValue: 30,
                    unit: 'ë¶„',
                    icon: 'ğŸ“š',
                    color: COLORS[3],
                    isActive: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: 'ëª…ìƒ',
                    type: 'binary',
                    icon: 'ğŸ§˜',
                    color: COLORS[4],
                    isActive: true,
                    createdAt: new Date().toISOString()
                }
            ];
            records = [];
        }

        // ë¡œê·¸ì¸ í›„ ì²˜ë¦¬
        async function handleAuthSuccess(user, isNewUser = false) {
            currentUser = {
                uid: user.uid,
                email: user.email,
                name: user.email.split('@')[0]
            };

            document.getElementById('userName').textContent = currentUser.name;

            // ë°ì´í„° ë¡œë“œ ë˜ëŠ” ì´ˆê¸°í™”
            await loadFromStorage();

            if (isNewUser || hobbies.length === 0) {
                createInitialData();
                await saveToStorage();
            }

            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            renderDashboard();
        }

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            hideAuthError();

            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const submitBtn = document.getElementById('authSubmitBtn');

            // Firebaseê°€ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ì²´í¬
            if (!window.firebaseAuth || !window.firebaseAuthFunctions) {
                showAuthError('Firebaseê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            const { createUserWithEmailAndPassword, signInWithEmailAndPassword } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            submitBtn.classList.add('auth-loading');
            submitBtn.disabled = true;

            try {
                if (isSignupMode) {
                    // íšŒì›ê°€ì…
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    console.log('íšŒì›ê°€ì… ì„±ê³µ:', userCredential.user.email);
                    await handleAuthSuccess(userCredential.user, true);
                } else {
                    // ë¡œê·¸ì¸
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    console.log('ë¡œê·¸ì¸ ì„±ê³µ:', userCredential.user.email);
                    await handleAuthSuccess(userCredential.user, false);
                }
            } catch (error) {
                console.error('ì¸ì¦ ì˜¤ë¥˜:', error);
                showAuthError(getFirebaseErrorMessage(error.code));
            } finally {
                submitBtn.classList.remove('auth-loading');
                submitBtn.disabled = false;
            }
        });

        // ë¡œê·¸ì•„ì›ƒ
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    if (window.firebaseAuth && window.firebaseAuthFunctions) {
                        const { signOut } = window.firebaseAuthFunctions;
                        await signOut(window.firebaseAuth);
                    }

                    currentUser = null;
                    hobbies = [];
                    records = [];

                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('loginPage').style.display = 'flex';

                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('loginForm').reset();
                    hideAuthError();
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                }
            }
        });

        // í…Œë§ˆ í† ê¸€
        document.getElementById('themeToggle').addEventListener('click', function() {
            toggleTheme();
        });

        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜
        document.querySelectorAll('.nav-link, .widget-action').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.getAttribute('data-page');
                if (page) {
                    navigateTo(page);
                }
            });
        });

        function navigateTo(page) {
            currentPage = page;
            
            // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™”
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                }
            });

            // í˜ì´ì§€ í‘œì‹œ
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById(page + 'Page').classList.add('active');

            // í˜ì´ì§€ë³„ ë Œë”ë§
            switch(page) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'hobbies':
                    renderHobbiesList();
                    break;
                case 'overall':
                    renderOverall();
                    break;
                case 'stats':
                    renderStats();
                    break;
            }
        }

        // ëŒ€ì‹œë³´ë“œ ë Œë”ë§
        function renderDashboard() {
            // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
            document.getElementById('todayDate').textContent = getKoreanDate(new Date());

            // í™œì„± ì·¨ë¯¸ ê°€ì ¸ì˜¤ê¸°
            const activeHobbies = hobbies.filter(h => h.isActive);
            const today = getTodayString();

            // ì˜¤ëŠ˜ì˜ ì§„í–‰ë„ ê³„ì‚°
            const todayRecords = records.filter(r => r.date === today);
            const completedCount = activeHobbies.filter(hobby => {
                const record = todayRecords.find(r => r.hobbyId === hobby.id);
                return record && record.achieved;
            }).length;

            // ì§„í–‰ë„ ì› ì—…ë°ì´íŠ¸
            const progressCircle = document.getElementById('todayProgress');
            const percentage = activeHobbies.length > 0 ? (completedCount / activeHobbies.length) * 100 : 0;
            progressCircle.style.background = `conic-gradient(var(--success) ${percentage}%, var(--grass-empty) 0%)`;
            progressCircle.querySelector('.progress-text').textContent = `${completedCount}/${activeHobbies.length}`;

            // ì·¨ë¯¸ ì¹´ë“œ ë Œë”ë§
            const container = document.getElementById('hobbyCardsContainer');
            if (activeHobbies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">ğŸŒ±</div>
                        <h3 class="empty-title">ì·¨ë¯¸ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”</h3>
                        <p class="empty-text">ì²« ë²ˆì§¸ ìŠµê´€ì„ ë§Œë“¤ê³  ê¾¸ì¤€í•¨ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
                        <button class="btn btn-primary" onclick="navigateTo('hobbies')">ì·¨ë¯¸ ì¶”ê°€í•˜ê¸°</button>
                    </div>
                `;
            } else {
                container.innerHTML = activeHobbies.map(hobby => {
                    const record = todayRecords.find(r => r.hobbyId === hobby.id);
                    let status = 'pending';
                    let statusText = 'ë¯¸ì™„ë£Œ';
                    let recordValue = '';

                    if (record) {
                        if (hobby.type === 'quant') {
                            recordValue = `${record.value}${hobby.unit}`;
                            if (record.value >= hobby.targetValue * 1.5) {
                                status = 'exceeded';
                                statusText = 'ì´ˆê³¼ë‹¬ì„±';
                            } else if (record.achieved) {
                                status = 'completed';
                                statusText = 'ì™„ë£Œ';
                            } else {
                                status = 'pending';
                                statusText = 'ë¯¸ì™„ë£Œ';
                            }
                        } else {
                            if (record.achieved) {
                                status = 'completed';
                                statusText = 'ì™„ë£Œ';
                            } else {
                                status = 'pending';
                                statusText = 'ë¯¸ì™„ë£Œ';
                            }
                        }
                    }

                    const targetText = hobby.type === 'quant' 
                        ? `ëª©í‘œ: ${hobby.targetValue}${hobby.unit}`
                        : 'ì™„ë£Œ ì—¬ë¶€ ì²´í¬';

                    return `
                        <div class="hobby-card" onclick="showHobbyDetail('${hobby.id}')">
                            <div class="hobby-card-header">
                                <div class="hobby-info">
                                    <div class="hobby-name">
                                        <span class="hobby-icon">${hobby.icon}</span>
                                        ${hobby.name}
                                    </div>
                                    <div class="hobby-target">${targetText}</div>
                                    ${recordValue ? `<div class="hobby-target" style="color: var(--success); font-weight: 600;">${recordValue}</div>` : ''}
                                </div>
                                <div class="hobby-status status-${status}">${statusText}</div>
                            </div>
                            <div class="hobby-action" style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" style="flex: 1;" onclick="event.stopPropagation(); toggleTodayRecord('${hobby.id}')">
                                    ${record ? (record.achieved ? '<span style="text-decoration: line-through; text-decoration-thickness: 2px; text-decoration-color: currentColor;">ì™„ë£Œ</span>' : 'ì™„ë£Œ') : 'ì˜¤ëŠ˜ ì²´í¬'}
                                </button>
                                <button class="btn btn-secondary" onclick="event.stopPropagation(); editHobby('${hobby.id}')" title="ì·¨ë¯¸ ì„¤ì • ìˆ˜ì •">
                                    âš™ï¸
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // ëŒ€ì‹œë³´ë“œ Overall ì”ë””ë°­ ë Œë”ë§
            renderDashboardOverall();

            // ëŒ€ì‹œë³´ë“œ í†µê³„ ë Œë”ë§
            renderDashboardStats();
        }

        // ëŒ€ì‹œë³´ë“œ Overall ì”ë””ë°­ ë Œë”ë§
        function renderDashboardOverall() {
            const yearSelect = document.getElementById('dashboardOverallYearSelect');
            const year = parseInt(yearSelect.value);
            
            yearSelect.onchange = function() {
                renderDashboardOverall();
            };

            renderOverallGrassInContainer('dashboardOverallGrassContainer', year);

            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('dashboardOverallYearCount').textContent = calculateOverallCount(year);
            document.getElementById('dashboardOverallCurrentStreak').textContent = calculateOverallCurrentStreak();
            document.getElementById('dashboardOverallMaxStreak').textContent = calculateOverallMaxStreak(year);
        }

        // ëŒ€ì‹œë³´ë“œ í†µê³„ ë Œë”ë§
        function renderDashboardStats() {
            const yearSelect = document.getElementById('dashboardStatsYearSelect');
            const year = parseInt(yearSelect.value);
            
            yearSelect.onchange = function() {
                renderDashboardStats();
            };

            // ì „ì²´ í†µê³„ ê³„ì‚°
            const activeHobbies = hobbies.filter(h => h.isActive);
            const yearRecords = records.filter(r => {
                const recordYear = parseInt(r.date.split('-')[0]);
                return recordYear === year;
            });

            const totalDays = Math.min(365, Math.floor((new Date() - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24)) + 1);
            const totalPossible = totalDays * activeHobbies.length;
            const totalAchieved = yearRecords.filter(r => r.achieved).length;
            const achievementRate = totalPossible > 0 ? Math.round((totalAchieved / totalPossible) * 100) : 0;

            const overallCount = calculateOverallCount(year);
            const overallRate = totalDays > 0 ? Math.round((overallCount / totalDays) * 100) : 0;

            // í†µê³„ ì¹´ë“œ ë Œë”ë§
            const statsContainer = document.getElementById('dashboardStatsContainer');
            statsContainer.innerHTML = `
                <div class="stats-card">
                    <div class="stats-card-title">ì „ì²´ ë‹¬ì„±ë¥ </div>
                    <div class="stats-card-value">${achievementRate}%</div>
                    <div class="stats-card-label">${totalAchieved} / ${totalPossible}</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">ì™„ë²½í•œ í•˜ë£¨</div>
                    <div class="stats-card-value">${overallCount}</div>
                    <div class="stats-card-label">ì´ ${totalDays}ì¼ ì¤‘</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">ì¢…í•© ë‹¬ì„±ë¥ </div>
                    <div class="stats-card-value">${overallRate}%</div>
                    <div class="stats-card-label">ì™„ë²½í•œ í•˜ë£¨ ë¹„ìœ¨</div>
                </div>
            `;

            // ì·¨ë¯¸ë³„ í†µê³„
            const hobbyStatsContainer = document.getElementById('dashboardHobbyStatsContainer');
            if (activeHobbies.length === 0) {
                hobbyStatsContainer.innerHTML = `
                    <div class="empty-state">
                        <p class="empty-text">í™œì„± ì·¨ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            } else {
                hobbyStatsContainer.innerHTML = activeHobbies.map(hobby => {
                    const hobbyRecords = yearRecords.filter(r => r.hobbyId === hobby.id);
                    const achievedCount = hobbyRecords.filter(r => r.achieved).length;
                    const rate = totalDays > 0 ? Math.round((achievedCount / totalDays) * 100) : 0;
                    const currentStreak = calculateCurrentStreak(hobby.id);
                    const maxStreak = calculateMaxStreak(hobby.id, year);

                    return `
                        <div class="hobby-stat-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                            <div class="hobby-stat-name">
                                <span>${hobby.icon}</span>
                                <span>${hobby.name}</span>
                            </div>
                            <div style="text-align: right;">
                                <div class="hobby-stat-value">${rate}%</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                                    í˜„ì¬ ${currentStreak}ì¼ Â· ìµœì¥ ${maxStreak}ì¼
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Overall ë‹¬ì„± ì—¬ë¶€ ì²´í¬
        function checkOverallAchievement(date) {
            const activeHobbies = hobbies.filter(h => h.isActive);
            if (activeHobbies.length === 0) return false;

            const dayRecords = records.filter(r => r.date === date);
            
            return activeHobbies.every(hobby => {
                const record = dayRecords.find(r => r.hobbyId === hobby.id);
                return record && record.achieved;
            });
        }

        // Overall ì”ë”” ë Œë”ë§ (ì¬ì‚¬ìš© ê°€ëŠ¥)
        function renderOverallGrassInContainer(containerId, year) {
            const container = document.getElementById(containerId);
            
            // ì”ë”” ê·¸ë¦¬ë“œ ìƒì„±
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            let html = '<div class="grass-graph"><div class="grass-grid">';
            
            let currentDate = new Date(startDate);
            
            // ì²« ì£¼ì˜ ì‹œì‘ì„ ì›”ìš”ì¼ë¡œ ë§ì¶”ê¸°
            while (currentDate.getDay() !== 1) {
                currentDate.setDate(currentDate.getDate() - 1);
            }

            let weekCount = 0;
            while (currentDate <= endDate || currentDate.getDay() !== 1) {
                html += '<div class="grass-column">';
                
                for (let day = 0; day < 7; day++) {
                    const dateStr = formatDate(currentDate);
                    const isAchieved = checkOverallAchievement(dateStr);
                    const isCurrentYear = currentDate.getFullYear() === year;
                    
                    html += `<div class="grass-cell-full ${isAchieved && isCurrentYear ? 'level-4' : ''}" 
                             title="${dateStr}${isAchieved ? ' - ì™„ë²½í•œ í•˜ë£¨' : ''}"></div>`;
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                html += '</div>';
                weekCount++;
                
                if (weekCount > 53) break;
            }
            
            html += '</div></div>';
            
            // ë²”ë¡€ ì¶”ê°€
            html += `
                <div class="grass-legend">
                    <span>Less</span>
                    <div class="grass-legend-item"><div class="grass-cell"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-4"></div></div>
                    <span>More</span>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Overall ì¹´ìš´íŠ¸ ê³„ì‚°
        function calculateOverallCount(year) {
            let count = 0;
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            const today = new Date();
            const lastDate = endDate > today ? today : endDate;

            for (let d = new Date(startDate); d <= lastDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                if (checkOverallAchievement(dateStr)) {
                    count++;
                }
            }
            return count;
        }

        // Quick Stats ë Œë”ë§
        // í˜„ì¬ ìŠ¤íŠ¸ë¦­ ê³„ì‚°
        function calculateCurrentStreak(hobbyId) {
            const today = new Date();
            let streak = 0;
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                
                const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                if (record && record.achieved) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        // ìµœì¥ ìŠ¤íŠ¸ë¦­ ê³„ì‚°
        function calculateMaxStreak(hobbyId, year) {
            let maxStreak = 0;
            let currentStreak = 0;
            
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                
                if (record && record.achieved) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            }
            
            return maxStreak;
        }

        // ì˜¤ëŠ˜ ê¸°ë¡ í† ê¸€ (ì™„ë£Œí˜•) ë˜ëŠ” ëª¨ë‹¬ ì—´ê¸° (ìˆ˜ì¹˜í˜•)
        function toggleTodayRecord(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            const today = getTodayString();
            const existingRecord = records.find(r => r.hobbyId === hobbyId && r.date === today);

            if (hobby.type === 'binary') {
                // ì™„ë£Œí˜•: í† ê¸€ ë°©ì‹
                if (existingRecord) {
                    // ê¸°ì¡´ ê¸°ë¡ì´ ìˆìœ¼ë©´ achieved í† ê¸€
                    existingRecord.achieved = !existingRecord.achieved;
                    existingRecord.updatedAt = new Date().toISOString();
                } else {
                    // ê¸°ì¡´ ê¸°ë¡ì´ ì—†ìœ¼ë©´ ì™„ë£Œë¡œ ìƒì„±
                    const newRecord = {
                        id: generateId(),
                        hobbyId: hobbyId,
                        date: today,
                        achieved: true,
                        createdAt: new Date().toISOString()
                    };
                    records.push(newRecord);
                }
                saveToStorage();
                renderDashboard();
            } else {
                // ìˆ˜ì¹˜í˜•: ëª¨ë‹¬ ì—´ê¸°
                openRecordModal(hobbyId);
            }
        }

        // ê¸°ë¡ ëª¨ë‹¬ ì—´ê¸°
        function openRecordModal(hobbyId, date = null) {
            selectedHobbyId = hobbyId;
            const hobby = hobbies.find(h => h.id === hobbyId);
            const targetDate = date || getTodayString();
            
            document.getElementById('recordModalTitle').textContent = 
                date ? 'ê¸°ë¡ ìˆ˜ì •' : 'ì˜¤ëŠ˜ ê¸°ë¡í•˜ê¸°';
            document.getElementById('recordModalSubtitle').textContent = 
                `${hobby.icon} ${hobby.name} - ${targetDate}`;

            const existingRecord = records.find(r => r.hobbyId === hobbyId && r.date === targetDate);
            
            let formHtml = '';
            if (hobby.type === 'quant') {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">ë‹¬ì„±ëŸ‰ *</label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="recordValue" 
                                   value="${existingRecord ? existingRecord.value : ''}" 
                                   placeholder="${hobby.targetValue}" min="0" required>
                            <input type="text" class="form-input" value="${hobby.unit}" readonly>
                        </div>
                        <div style="margin-top: 8px; font-size: 13px; color: var(--text-secondary);">
                            ëª©í‘œ: ${hobby.targetValue}${hobby.unit}
                        </div>
                    </div>
                `;
            } else {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">ì™„ë£Œ ì—¬ë¶€</label>
                        <div class="radio-group">
                            <label class="radio-label ${!existingRecord || existingRecord.achieved ? '' : 'selected'}">
                                <input type="radio" name="achieved" value="false" ${!existingRecord || !existingRecord.achieved ? 'checked' : ''}>
                                <span>ë¯¸ì™„ë£Œ</span>
                            </label>
                            <label class="radio-label ${existingRecord && existingRecord.achieved ? 'selected' : ''}">
                                <input type="radio" name="achieved" value="true" ${existingRecord && existingRecord.achieved ? 'checked' : ''}>
                                <span>ì™„ë£Œ</span>
                            </label>
                        </div>
                    </div>
                `;
            }

            document.getElementById('recordFormContent').innerHTML = formHtml;
            document.getElementById('recordMemo').value = existingRecord ? (existingRecord.memo || '') : '';
            
            // ë¼ë””ì˜¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.radio-label').forEach(label => {
                label.addEventListener('click', function() {
                    document.querySelectorAll('.radio-label').forEach(l => l.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            document.getElementById('recordModal').classList.add('active');
        }

        function closeRecordModal() {
            document.getElementById('recordModal').classList.remove('active');
            selectedHobbyId = null;
        }

        // ê¸°ë¡ ì €ì¥
        document.getElementById('recordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const hobby = hobbies.find(h => h.id === selectedHobbyId);
            const today = getTodayString();
            const memo = document.getElementById('recordMemo').value;
            
            let recordData = {
                hobbyId: selectedHobbyId,
                date: today,
                memo: memo,
                createdAt: new Date().toISOString()
            };

            if (hobby.type === 'quant') {
                const value = parseInt(document.getElementById('recordValue').value);
                recordData.value = value;
                recordData.achieved = value >= hobby.targetValue;
            } else {
                const achievedInput = document.querySelector('input[name="achieved"]:checked');
                recordData.achieved = achievedInput.value === 'true';
            }

            // ê¸°ì¡´ ê¸°ë¡ í™•ì¸
            const existingIndex = records.findIndex(r => r.hobbyId === selectedHobbyId && r.date === today);
            if (existingIndex >= 0) {
                recordData.id = records[existingIndex].id;
                records[existingIndex] = recordData;
            } else {
                recordData.id = generateId();
                records.push(recordData);
            }

            saveToStorage();
            closeRecordModal();
            renderDashboard();
        });

        // ì·¨ë¯¸ ëª©ë¡ ë Œë”ë§
        function renderHobbiesList() {
            const container = document.getElementById('hobbyListContainer');
            
            if (hobbies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸŒ±</div>
                        <h3 class="empty-title">ì•„ì§ ì·¨ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p class="empty-text">ì²« ë²ˆì§¸ ì·¨ë¯¸ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = hobbies.map(hobby => {
                const targetText = hobby.type === 'quant' 
                    ? `${hobby.targetValue}${hobby.unit}`
                    : 'ì™„ë£Œí˜•';
                
                const recordCount = records.filter(r => r.hobbyId === hobby.id).length;

                return `
                    <div class="hobby-list-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                        <div class="hobby-list-info">
                            <div class="hobby-list-name">
                                <span>${hobby.icon}</span>
                                ${hobby.name}
                            </div>
                            <div class="hobby-list-meta">
                                ëª©í‘œ: ${targetText} Â· ì´ ${recordCount}íšŒ ê¸°ë¡
                            </div>
                        </div>
                        <div class="hobby-list-actions">
                            <div class="toggle-switch ${hobby.isActive ? 'active' : ''}" 
                                 onclick="event.stopPropagation(); toggleHobbyActive('${hobby.id}')">
                                <div class="toggle-slider"></div>
                            </div>
                            <button class="btn-icon" onclick="event.stopPropagation(); editHobby('${hobby.id}')">
                                ìˆ˜ì •
                            </button>
                            <button class="btn-icon" onclick="event.stopPropagation(); deleteHobby('${hobby.id}')" 
                                    style="color: var(--danger);">
                                ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ì·¨ë¯¸ í™œì„±í™”/ë¹„í™œì„±í™”
        function toggleHobbyActive(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            hobby.isActive = !hobby.isActive;
            saveToStorage();
            renderHobbiesList();
        }

        // ì·¨ë¯¸ ì‚­ì œ
        function deleteHobby(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            if (confirm(`"${hobby.name}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ê¸°ë¡ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                hobbies = hobbies.filter(h => h.id !== hobbyId);
                records = records.filter(r => r.hobbyId !== hobbyId);
                saveToStorage();
                renderHobbiesList();
            }
        }

        // ìƒˆ ì·¨ë¯¸ ë²„íŠ¼
        document.getElementById('newHobbyBtn').addEventListener('click', function() {
            openHobbyModal();
        });

        // ì·¨ë¯¸ ëª¨ë‹¬ ì—´ê¸°
        function openHobbyModal(hobbyId = null) {
            if (hobbyId) {
                // ìˆ˜ì • ëª¨ë“œ
                const hobby = hobbies.find(h => h.id === hobbyId);
                document.getElementById('hobbyModalTitle').textContent = 'ì·¨ë¯¸ ìˆ˜ì •';
                document.getElementById('hobbyName').value = hobby.name;
                
                // íƒ€ì… ì„¤ì •
                document.querySelector(`input[name="hobbyType"][value="${hobby.type}"]`).checked = true;
                
                if (hobby.type === 'quant') {
                    document.getElementById('quantFields').style.display = 'block';
                    document.getElementById('binaryFields').style.display = 'none';
                    document.getElementById('targetValue').value = hobby.targetValue;
                    document.getElementById('targetUnit').value = hobby.unit;
                } else {
                    document.getElementById('quantFields').style.display = 'none';
                    document.getElementById('binaryFields').style.display = 'block';
                    document.getElementById('binaryDesc').value = hobby.description || '';
                }
                
                // ì•„ì´ì½˜ ì„ íƒ
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                    if (opt.getAttribute('data-icon') === hobby.icon) {
                        opt.classList.add('selected');
                    }
                });
                
                // í¼ì— ìˆ˜ì • ì¤‘ì¸ ID ì €ì¥
                document.getElementById('hobbyForm').setAttribute('data-edit-id', hobbyId);
            } else {
                // ìƒì„± ëª¨ë“œ
                document.getElementById('hobbyModalTitle').textContent = 'ìƒˆ ì·¨ë¯¸ ì¶”ê°€';
                document.getElementById('hobbyForm').reset();
                document.getElementById('hobbyForm').removeAttribute('data-edit-id');
                
                // ê¸°ë³¸ê°’ìœ¼ë¡œ ìˆ˜ì¹˜í˜• ì„ íƒ ë° í•„ë“œ í‘œì‹œ
                document.querySelector('input[name="hobbyType"][value="quant"]').checked = true;
                document.getElementById('quantFields').style.display = 'block';
                document.getElementById('binaryFields').style.display = 'none';
                
                // ì•„ì´ì½˜ ì„ íƒ ì´ˆê¸°í™”
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                document.querySelector('.icon-option').classList.add('selected');
            }
            
            document.getElementById('hobbyModal').classList.add('active');
        }

        function closeHobbyModal() {
            document.getElementById('hobbyModal').classList.remove('active');
            document.getElementById('hobbyForm').removeAttribute('data-edit-id');
        }

        // ì·¨ë¯¸ ìˆ˜ì • í•¨ìˆ˜
        function editHobby(hobbyId) {
            openHobbyModal(hobbyId);
        }

        // ì·¨ë¯¸ íƒ€ì… ë³€ê²½
        document.querySelectorAll('input[name="hobbyType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'quant') {
                    document.getElementById('quantFields').style.display = 'block';
                    document.getElementById('binaryFields').style.display = 'none';
                } else {
                    document.getElementById('quantFields').style.display = 'none';
                    document.getElementById('binaryFields').style.display = 'block';
                }
            });
        });

        // ì•„ì´ì½˜ ì„ íƒ
        document.querySelectorAll('.icon-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
            });
        });

        // ì·¨ë¯¸ ì €ì¥
        document.getElementById('hobbyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editId = this.getAttribute('data-edit-id');
            const name = document.getElementById('hobbyName').value;
            const type = document.querySelector('input[name="hobbyType"]:checked').value;
            const icon = document.querySelector('.icon-option.selected').getAttribute('data-icon');
            
            if (editId) {
                // ìˆ˜ì • ëª¨ë“œ
                const hobby = hobbies.find(h => h.id === editId);
                hobby.name = name;
                hobby.type = type;
                hobby.icon = icon;
                
                if (type === 'quant') {
                    hobby.targetValue = parseInt(document.getElementById('targetValue').value);
                    hobby.unit = document.getElementById('targetUnit').value;
                    delete hobby.description;
                } else {
                    const desc = document.getElementById('binaryDesc').value;
                    if (desc) hobby.description = desc;
                    delete hobby.targetValue;
                    delete hobby.unit;
                }
                
                hobby.updatedAt = new Date().toISOString();
            } else {
                // ìƒì„± ëª¨ë“œ
                const hobbyData = {
                    id: generateId(),
                    name: name,
                    type: type,
                    icon: icon,
                    color: COLORS[hobbies.length % COLORS.length],
                    isActive: true,
                    createdAt: new Date().toISOString()
                };

                if (type === 'quant') {
                    hobbyData.targetValue = parseInt(document.getElementById('targetValue').value);
                    hobbyData.unit = document.getElementById('targetUnit').value;
                } else {
                    const desc = document.getElementById('binaryDesc').value;
                    if (desc) hobbyData.description = desc;
                }

                hobbies.push(hobbyData);
            }

            saveToStorage();
            closeHobbyModal();
            
            // í˜„ì¬ í˜ì´ì§€ì— ë”°ë¼ ë Œë”ë§
            if (currentPage === 'hobbies') {
                renderHobbiesList();
            } else if (currentPage === 'dashboard') {
                renderDashboard();
            }
        });

        // ì·¨ë¯¸ ìƒì„¸ ë³´ê¸°
        function showHobbyDetail(hobbyId) {
            selectedHobbyId = hobbyId;
            const hobby = hobbies.find(h => h.id === hobbyId);
            
            document.getElementById('hobbyDetailTitle').textContent = hobby.name;
            document.getElementById('hobbyDetailName').textContent = `${hobby.icon} ${hobby.name}`;
            
            const targetText = hobby.type === 'quant' 
                ? `ëª©í‘œ: ${hobby.targetValue}${hobby.unit}`
                : 'ì™„ë£Œí˜• ëª©í‘œ';
            document.getElementById('hobbyDetailSubtitle').textContent = targetText;

            navigateTo('hobbyDetail');
            renderHobbyGrass(hobbyId, new Date().getFullYear());
        }

        // ì·¨ë¯¸ ì”ë””ë°­ ë Œë”ë§
        function renderHobbyGrass(hobbyId, year) {
            const container = document.getElementById('hobbyDetailGrassContainer');
            const hobby = hobbies.find(h => h.id === hobbyId);
            
            // ì—°ë„ ì„ íƒê¸° ì„¤ì •
            const yearSelect = document.getElementById('hobbyDetailYearSelect');
            yearSelect.value = year;
            yearSelect.onchange = function() {
                renderHobbyGrass(hobbyId, parseInt(this.value));
            };

            // ì›” ë¼ë²¨
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // ì”ë”” ê·¸ë¦¬ë“œ ìƒì„±
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            let html = '<div class="grass-graph"><div class="grass-grid">';
            
            let currentDate = new Date(startDate);
            
            // ì²« ì£¼ì˜ ì‹œì‘ì„ ì›”ìš”ì¼ë¡œ ë§ì¶”ê¸°
            while (currentDate.getDay() !== 1) {
                currentDate.setDate(currentDate.getDate() - 1);
            }

            let weekCount = 0;
            while (currentDate <= endDate || currentDate.getDay() !== 1) {
                html += '<div class="grass-column">';
                
                for (let day = 0; day < 7; day++) {
                    const dateStr = formatDate(currentDate);
                    const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                    
                    let level = 0;
                    let tooltipText = dateStr;
                    
                    if (record) {
                        if (hobby.type === 'quant') {
                            const percentage = (record.value / hobby.targetValue) * 100;
                            if (percentage >= 150) level = 4;
                            else if (percentage >= 100) level = 3;
                            else if (percentage >= 50) level = 2;
                            else level = 1;
                            tooltipText += ` - ${record.value}${hobby.unit}`;
                        } else {
                            level = record.achieved ? 4 : 0;
                            tooltipText += record.achieved ? ' - ì™„ë£Œ' : '';
                        }
                    }

                    const isCurrentYear = currentDate.getFullYear() === year;
                    
                    html += `<div class="grass-cell-full ${level > 0 && isCurrentYear ? `level-${level}` : ''}" 
                             title="${tooltipText}"></div>`;
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                html += '</div>';
                weekCount++;
                
                if (weekCount > 53) break;
            }
            
            html += '</div></div>';
            
            // ë²”ë¡€ ì¶”ê°€
            html += `
                <div class="grass-legend">
                    <span>Less</span>
                    <div class="grass-legend-item"><div class="grass-cell"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-1"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-2"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-3"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-4"></div></div>
                    <span>More</span>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
        document.getElementById('backToDashboard').addEventListener('click', function() {
            navigateTo('dashboard');
        });

        // Overall í˜ì´ì§€ ë Œë”ë§
        function renderOverall() {
            const year = parseInt(document.getElementById('overallYearSelect').value);
            renderOverallGrass(year);
            
            document.getElementById('overallYearSelect').onchange = function() {
                renderOverall();
            };
        }

        function renderOverallGrass(year) {
            renderOverallGrassInContainer('overallGrassContainer', year);

            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('overallYearCount').textContent = calculateOverallCount(year);
            
            const currentStreak = calculateOverallCurrentStreak();
            document.getElementById('overallCurrentStreak').textContent = currentStreak;
            
            const maxStreak = calculateOverallMaxStreak(year);
            document.getElementById('overallMaxStreak').textContent = maxStreak;
        }

        function calculateOverallCurrentStreak() {
            const today = new Date();
            let streak = 0;
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                
                if (checkOverallAchievement(dateStr)) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function calculateOverallMaxStreak(year) {
            let maxStreak = 0;
            let currentStreak = 0;
            
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                
                if (checkOverallAchievement(dateStr)) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            }
            
            return maxStreak;
        }

        // í†µê³„ í˜ì´ì§€ ë Œë”ë§
        function renderStats() {
            const year = parseInt(document.getElementById('statsYearSelect').value);
            
            document.getElementById('statsYearSelect').onchange = function() {
                renderStats();
            };

            // ì „ì²´ í†µê³„ ê³„ì‚°
            const activeHobbies = hobbies.filter(h => h.isActive);
            const yearRecords = records.filter(r => {
                const recordYear = parseInt(r.date.split('-')[0]);
                return recordYear === year;
            });

            const totalDays = Math.min(365, Math.floor((new Date() - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24)) + 1);
            const totalPossible = totalDays * activeHobbies.length;
            const totalAchieved = yearRecords.filter(r => r.achieved).length;
            const achievementRate = totalPossible > 0 ? Math.round((totalAchieved / totalPossible) * 100) : 0;

            const overallCount = calculateOverallCount(year);
            const overallRate = totalDays > 0 ? Math.round((overallCount / totalDays) * 100) : 0;

            // í†µê³„ ì¹´ë“œ ë Œë”ë§
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="stats-card">
                    <div class="stats-card-title">ì „ì²´ ë‹¬ì„±ë¥ </div>
                    <div class="stats-card-value">${achievementRate}%</div>
                    <div class="stats-card-label">${totalAchieved} / ${totalPossible}</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">ì™„ë²½í•œ í•˜ë£¨</div>
                    <div class="stats-card-value">${overallCount}</div>
                    <div class="stats-card-label">ì´ ${totalDays}ì¼ ì¤‘</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">ì¢…í•© ë‹¬ì„±ë¥ </div>
                    <div class="stats-card-value">${overallRate}%</div>
                    <div class="stats-card-label">ì™„ë²½í•œ í•˜ë£¨ ë¹„ìœ¨</div>
                </div>
            `;

            // ì·¨ë¯¸ë³„ í†µê³„
            const hobbyStatsContainer = document.getElementById('hobbyStatsContainer');
            hobbyStatsContainer.innerHTML = activeHobbies.map(hobby => {
                const hobbyRecords = yearRecords.filter(r => r.hobbyId === hobby.id);
                const achievedCount = hobbyRecords.filter(r => r.achieved).length;
                const rate = totalDays > 0 ? Math.round((achievedCount / totalDays) * 100) : 0;
                const currentStreak = calculateCurrentStreak(hobby.id);
                const maxStreak = calculateMaxStreak(hobby.id, year);

                return `
                    <div class="hobby-stat-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                        <div class="hobby-stat-name">
                            <span>${hobby.icon}</span>
                            <span>${hobby.name}</span>
                        </div>
                        <div style="text-align: right;">
                            <div class="hobby-stat-value">${rate}%</div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                                í˜„ì¬ ${currentStreak}ì¼ Â· ìµœì¥ ${maxStreak}ì¼
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            if (activeHobbies.length === 0) {
                hobbyStatsContainer.innerHTML = `
                    <div class="empty-state">
                        <p class="empty-text">í™œì„± ì·¨ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            }
        }

        // Firebase ì¸ì¦ ìƒíƒœ ê°ì§€ ì„¤ì •
        function setupAuthStateListener() {
            if (!window.firebaseAuth || !window.firebaseAuthFunctions) {
                // Firebaseê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ì¬ì‹œë„
                setTimeout(setupAuthStateListener, 100);
                return;
            }

            const { onAuthStateChanged } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ëœ ìƒíƒœ
                    console.log('ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì¸ë¨', user.email);
                    await handleAuthSuccess(user, false);
                } else {
                    // ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒëœ ìƒíƒœ
                    console.log('ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì•„ì›ƒë¨');
                    currentUser = null;
                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('loginPage').style.display = 'flex';
                }
            });
        }

        // ì´ˆê¸° ë¡œë“œ
        window.addEventListener('load', function() {
            initTheme();

            // Firebase ì¸ì¦ ìƒíƒœ ê°ì§€ ì‹œì‘
            setupAuthStateListener();
        });
    </script>
</body>
</html>