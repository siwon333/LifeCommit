<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Commit - ÎãπÏã†Ïùò ÌïòÎ£®Î•º Ïª§Î∞ãÌïòÏÑ∏Ïöî</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, setPersistence, browserLocalPersistence, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyDKvoBQBwaIn99IDNrH7mxCgE-NA6H7Upo",
            authDomain: "life-commit-dfa88.firebaseapp.com",
            projectId: "life-commit-dfa88",
            storageBucket: "life-commit-dfa88.firebasestorage.app",
            messagingSenderId: "29344205499",
            appId: "1:29344205499:web:e0bad9bfe3fa606c37779e",
            measurementId: "G-MTLKM3PW7F"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        await setPersistence(auth, browserLocalPersistence);
        const db = getFirestore(app);

        // Ï†ÑÏó≠ÏúºÎ°ú Firebase Í∞ùÏ≤¥ ÎÖ∏Ï∂ú
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthFunctions = { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail };
        window.firebaseDbFunctions = { doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, updateDoc, deleteDoc };
    </script>

    <style>
        :root {
            --grass-empty: #1a1f2e;
            --grass-level-1: #0e4429;
            --grass-level-2: #006d32;
            --grass-level-3: #26a641;
            --grass-level-4: #39d353;
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border: #30363d;
            --accent: #58a6ff;
            --accent-hover: #79c0ff;
            --success: #3fb950;
            --warning: #d29922;
            --danger: #f85149;
        }

        [data-theme="light"] {
            --grass-empty: #ebedf0;
            --grass-level-1: #9be9a8;
            --grass-level-2: #40c463;
            --grass-level-3: #30a14e;
            --grass-level-4: #216e39;
            --bg-primary: #ffffff;
            --bg-secondary: #f6f8fa;
            --bg-tertiary: #eaeef2;
            --text-primary: #1f2328;
            --text-secondary: #656d76;
            --text-muted: #8c959f;
            --border: #d0d7de;
            --accent: #0969da;
            --accent-hover: #0550ae;
            --success: #1a7f37;
            --warning: #bf8700;
            --danger: #cf222e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app {
            display: flex;
            min-height: 100vh;
        }

        /* ÏÇ¨Ïù¥ÎìúÎ∞î */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 24px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .logo {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .logo h1 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: opacity 0.2s;
        }

        .logo h1:hover {
            opacity: 0.8;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: var(--success);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .nav-menu {
            list-style: none;
            padding: 0 12px;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 14px;
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-section {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent), var(--success));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .logout-btn {
            width: 100%;
            padding: 8px;
            background: transparent;
            color: var(--danger);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: rgba(248, 81, 73, 0.1);
            border-color: var(--danger);
        }

        .theme-toggle-btn {
            width: 100%;
            padding: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            font-family: inherit;
        }

        .theme-toggle-btn:hover {
            background: var(--border);
        }

        .theme-icon {
            font-size: 16px;
        }

        /* Î©îÏù∏ Ïª®ÌÖêÏ∏† */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 32px 48px;
            max-width: 1400px;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ìó§Îçî */
        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 15px;
        }

        /* ÎåÄÏãúÎ≥¥Îìú */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .today-info h2 {
            font-size: 24px;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .today-date {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(var(--success) 0%, var(--grass-empty) 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .progress-inner {
            width: 64px;
            height: 64px;
            background: var(--bg-secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .progress-text {
            font-size: 20px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .progress-label {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Ï∑®ÎØ∏ Ïπ¥Îìú Í∑∏Î¶¨Îìú */
        .hobby-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .hobby-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .hobby-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .hobby-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .hobby-info {
            flex: 1;
        }

        .hobby-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-icon {
            font-size: 20px;
        }

        .hobby-target {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .hobby-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-pending {
            background: rgba(139, 148, 158, 0.15);
            color: var(--text-secondary);
        }

        .status-completed {
            background: rgba(63, 185, 80, 0.15);
            color: var(--success);
        }

        .status-exceeded {
            background: rgba(210, 153, 34, 0.15);
            color: var(--warning);
        }

        .hobby-action {
            margin-top: 16px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* ÏúÑÏ†Ø Í∑∏Î¶¨Îìú */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .widget {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .widget-title {
            font-size: 16px;
            font-weight: 600;
        }

        .widget-action {
            color: var(--accent);
            font-size: 13px;
            text-decoration: none;
            cursor: pointer;
        }

        .widget-action:hover {
            text-decoration: underline;
        }

        /* ÎØ∏Îãà ÏûîÎîî */
        .mini-grass {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
        }

        .mini-grass-week {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .grass-cell {
            width: 12px;
            height: 12px;
            background: var(--grass-empty);
            border-radius: 2px;
            transition: all 0.2s;
        }

        .grass-cell.level-1 {
            background: var(--grass-level-1);
        }

        .grass-cell.level-2 {
            background: var(--grass-level-2);
        }

        .grass-cell.level-3 {
            background: var(--grass-level-3);
        }

        .grass-cell.level-4 {
            background: var(--grass-level-4);
        }

        .grass-cell:hover {
            transform: scale(1.2);
            border: 1px solid var(--accent);
        }

        .overall-count {
            margin-top: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
        }

        /* ÌÜµÍ≥Ñ Ïπ¥Îìú */
        .stat-card {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
        }

        /* ÏûîÎîîÎ∞≠ Ï†ÑÏ≤¥ Î∑∞ */
        .grass-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .grass-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .year-selector {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
        }

        .grass-graph {
            overflow-x: auto;
            padding-bottom: 16px;
        }

        .grass-grid {
            display: inline-flex;
            gap: 3px;
        }

        .grass-column {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .grass-cell-full {
            width: 14px;
            height: 14px;
            background: var(--grass-empty);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
        }

        .grass-cell-full:hover {
            transform: scale(1.3);
            z-index: 10;
            box-shadow: 0 0 0 2px var(--accent);
        }

        .grass-cell-full.level-1 {
            background: var(--grass-level-1);
        }

        .grass-cell-full.level-2 {
            background: var(--grass-level-2);
        }

        .grass-cell-full.level-3 {
            background: var(--grass-level-3);
        }

        .grass-cell-full.level-4 {
            background: var(--grass-level-4);
        }

        .grass-legend {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .grass-legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .month-labels {
            display: flex;
            gap: 3px;
            margin-bottom: 8px;
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.2s ease-in;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 12px;
        }

        .radio-group {
            display: flex;
            gap: 12px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
        }

        .radio-label:hover {
            border-color: var(--accent);
        }

        .radio-label input[type="radio"] {
            margin: 0;
        }

        .radio-label input[type="radio"]:checked + span {
            font-weight: 600;
        }

        .radio-label:has(input:checked) {
            background: rgba(88, 166, 255, 0.1);
            border-color: var(--accent);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* Ï∑®ÎØ∏ Î™©Î°ù */
        .hobby-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hobby-list-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .hobby-list-item:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .hobby-list-info {
            flex: 1;
        }

        .hobby-list-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-list-meta {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .hobby-list-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .btn-icon:hover {
            background: var(--border);
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: var(--success);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        /* Îπà ÏÉÅÌÉú */
        .empty-state {
            text-align: center;
            padding: 64px 32px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-text {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
            padding: 24px;
        }

        .login-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 48px;
            max-width: 440px;
            width: 100%;
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 32px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 12px;
        }

        .login-tagline {
            color: var(--text-secondary);
            font-size: 15px;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-actions {
            margin-top: 24px;
        }

        .login-footer {
            text-align: center;
            margin-top: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .login-footer a {
            color: var(--accent);
            text-decoration: none;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        .auth-error {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            text-align: center;
        }

        .auth-loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .auth-success {
            background: rgba(63, 185, 80, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            text-align: center;
        }

        .forgot-password {
            text-align: center;
            margin-top: 16px;
        }

        .forgot-password a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
        }

        .forgot-password a:hover {
            color: var(--accent);
            text-decoration: underline;
        }

        /* ÌÜµÍ≥Ñ ÌéòÏù¥ÏßÄ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stats-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .stats-card-title {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stats-card-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 36px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 8px;
        }

        .stats-card-label {
            color: var(--text-muted);
            font-size: 12px;
        }

        .hobby-stats-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hobby-stat-item {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .hobby-stat-item:hover {
            background: var(--border);
            transform: translateX(4px);
        }

        .hobby-stat-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--success);
        }

        /* Î™®Î∞îÏùº Î©îÎâ¥ Î≤ÑÌäº */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 98;
            width: 44px;
            height: 44px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 80px 16px 24px 16px;
            }

            .hobby-grid {
                grid-template-columns: 1fr;
            }

            .widgets-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .grass-grid {
                overflow-x: auto;
                padding-bottom: 8px;
            }

            .hobby-card {
                padding: 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Ìà¥ÌåÅ */
        .tooltip {
            position: fixed;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 2000;
            display: none;
            white-space: nowrap;
        }

        .tooltip.active {
            display: block;
        }

        /* ÏÉâÏÉÅ ÏÑ†ÌÉùÍ∏∞ */
        .color-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
        }

        /* ÏïÑÏù¥ÏΩò ÏÑ†ÌÉùÍ∏∞ */
        .icon-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .icon-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .icon-option:hover {
            transform: scale(1.1);
            background: var(--border);
        }

        .icon-option.selected {
            border-color: var(--accent);
            background: rgba(88, 166, 255, 0.1);
        }

        .record-display {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .record-date {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .record-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 4px;
        }

        .record-memo {
            color: var(--text-secondary);
            font-size: 14px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="login-logo">üå± Life Commit</div>
                <div class="login-tagline">ÎãπÏã†Ïùò ÌïòÎ£®Î•º Ïª§Î∞ãÌïòÏÑ∏Ïöî</div>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label class="form-label">Ïù¥Î©îÏùº</label>
                    <input type="email" class="form-input" id="authEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input type="password" class="form-input" id="authPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                </div>
                <div id="authError" class="auth-error" style="display: none;"></div>
                <div id="authSuccess" class="auth-success" style="display: none;"></div>
                <div class="login-actions">
                    <button type="submit" class="btn btn-primary" id="authSubmitBtn">Î°úÍ∑∏Ïù∏</button>
                </div>
                <div class="forgot-password">
                    <a href="#" id="forgotPasswordLink">ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûäÏúºÏÖ®ÎÇòÏöî?</a>
                </div>
            </form>
            <div class="login-footer">
                <span id="authToggleText">Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî?</span> <a href="#" id="authToggleLink">ÌöåÏõêÍ∞ÄÏûÖ</a>
            </div>
        </div>
    </div>

    <!-- Î©îÏù∏ Ïï± -->
    <div id="mainApp" class="app" style="display: none;">
        <!-- Î™®Î∞îÏùº Î©îÎâ¥ Î≤ÑÌäº -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
        <div class="mobile-overlay" id="mobileOverlay"></div>

        <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <h1 style="cursor: pointer;" onclick="navigateTo('dashboard')">
                    <span class="logo-icon">üå±</span>
                    Life Commit
                </h1>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a class="nav-link active" data-page="dashboard">
                            <span class="nav-icon">üìä</span>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="overall">
                            <span class="nav-icon">üèÜ</span>
                            Overall
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="stats">
                            <span class="nav-icon">üìà</span>
                            Stats
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="hobbies">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            Hobbies
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="user-section">
                <div class="user-info">
                    <div class="user-avatar">U</div>
                    <div class="user-name" id="userName">ÏÇ¨Ïö©Ïûê</div>
                </div>
                <button class="theme-toggle-btn" id="themeToggle">
                    <span class="theme-icon">üåô</span>
                    <span class="theme-text">Îã§ÌÅ¨ Î™®Îìú</span>
                </button>
                <button class="logout-btn" id="logoutBtn">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </aside>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <main class="main-content">
            <!-- ÎåÄÏãúÎ≥¥Îìú ÌéòÏù¥ÏßÄ -->
            <div id="dashboardPage" class="page active">
                <div class="dashboard-header">
                    <div class="today-info">
                        <h2 id="todayDate">2026ÎÖÑ 1Ïõî 30Ïùº Í∏àÏöîÏùº</h2>
                        <div class="today-date">Ïò§ÎäòÏùò Î™©ÌëúÎ•º ÏôÑÎ£åÌïòÏÑ∏Ïöî</div>
                    </div>
                    <div class="progress-circle" id="todayProgress">
                        <div class="progress-inner">
                            <div class="progress-text">0/0</div>
                            <div class="progress-label">ÏôÑÎ£å</div>
                        </div>
                    </div>
                </div>

                <div id="hobbyCardsContainer" class="hobby-grid">
                    <!-- Ï∑®ÎØ∏ Ïπ¥ÎìúÎì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>

                <!-- Overall ÏûîÎîîÎ∞≠ ÏÑπÏÖò -->
                <div style="margin-top: 48px;">
                    <div class="page-header" style="margin-bottom: 24px;">
                        <h2 class="page-title" style="font-size: 24px;">Overall ÏûîÎîîÎ∞≠</h2>
                        <p class="page-subtitle">Î™®Îì† Î™©ÌëúÎ•º Îã¨ÏÑ±Ìïú ÏôÑÎ≤ΩÌïú ÌïòÎ£®Îì§</p>
                    </div>
                    <div class="grass-container">
                        <div class="grass-header">
                            <h3>Ïó∞Í∞Ñ Ï¢ÖÌï© Îã¨ÏÑ±</h3>
                            <select class="year-selector" id="dashboardOverallYearSelect">
                                <option value="2026">2026</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                        <div id="dashboardOverallGrassContainer"></div>
                    </div>
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stats-card">
                            <div class="stats-card-title">Ïò¨Ìï¥ ÏôÑÎ≤ΩÌïú ÌïòÎ£®</div>
                            <div class="stats-card-value" id="dashboardOverallYearCount">0</div>
                            <div class="stats-card-label">Ïùº</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-title">ÌòÑÏû¨ Ïó∞ÏÜç Í∏∞Î°ù</div>
                            <div class="stats-card-value" id="dashboardOverallCurrentStreak">0</div>
                            <div class="stats-card-label">Ïùº</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-title">ÏµúÏû• Ïó∞ÏÜç Í∏∞Î°ù</div>
                            <div class="stats-card-value" id="dashboardOverallMaxStreak">0</div>
                            <div class="stats-card-label">Ïùº</div>
                        </div>
                    </div>
                </div>

                <!-- ÌÜµÍ≥Ñ ÏÑπÏÖò -->
                <div style="margin-top: 48px;">
                    <div class="page-header" style="margin-bottom: 24px;">
                        <h2 class="page-title" style="font-size: 24px;">ÌÜµÍ≥Ñ</h2>
                        <p class="page-subtitle">ÎãπÏã†Ïùò ÏÑ±Ï∑®Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                    </div>
                    <div style="margin-bottom: 24px;">
                        <select class="year-selector" id="dashboardStatsYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div class="stats-grid" id="dashboardStatsContainer">
                        <!-- ÌÜµÍ≥Ñ Ïπ¥ÎìúÎì§ -->
                    </div>
                    <div class="grass-container" style="margin-top: 24px;">
                        <h3 style="margin-bottom: 24px;">Ï∑®ÎØ∏Î≥Ñ Îã¨ÏÑ±Î•†</h3>
                        <div class="hobby-stats-list" id="dashboardHobbyStatsContainer">
                            <!-- Ï∑®ÎØ∏Î≥Ñ ÌÜµÍ≥Ñ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ï∑®ÎØ∏ Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ -->
            <div id="hobbiesPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">Ï∑®ÎØ∏ Í¥ÄÎ¶¨</h1>
                    <p class="page-subtitle">ÏäµÍ¥ÄÍ≥º Î™©ÌëúÎ•º Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî</p>
                </div>
                <div style="margin-bottom: 24px;">
                    <button class="btn btn-primary" id="newHobbyBtn">+ ÏÉà Ï∑®ÎØ∏ Ï∂îÍ∞Ä</button>
                </div>
                <div id="hobbyListContainer" class="hobby-list">
                    <!-- Ï∑®ÎØ∏ Î™©Î°ù -->
                </div>
            </div>

            <!-- Overall ÌéòÏù¥ÏßÄ -->
            <div id="overallPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">Overall ÏûîÎîîÎ∞≠</h1>
                    <p class="page-subtitle">Î™®Îì† Î™©ÌëúÎ•º Îã¨ÏÑ±Ìïú ÏôÑÎ≤ΩÌïú ÌïòÎ£®Îì§</p>
                </div>
                <div class="grass-container">
                    <div class="grass-header">
                        <h3>Ïó∞Í∞Ñ Ï¢ÖÌï© Îã¨ÏÑ±</h3>
                        <select class="year-selector" id="overallYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div id="overallGrassContainer"></div>
                </div>
                <div class="stats-grid">
                    <div class="stats-card">
                        <div class="stats-card-title">Ïò¨Ìï¥ ÏôÑÎ≤ΩÌïú ÌïòÎ£®</div>
                        <div class="stats-card-value" id="overallYearCount">0</div>
                        <div class="stats-card-label">Ïùº</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-title">ÌòÑÏû¨ Ïó∞ÏÜç Í∏∞Î°ù</div>
                        <div class="stats-card-value" id="overallCurrentStreak">0</div>
                        <div class="stats-card-label">Ïùº</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-title">ÏµúÏû• Ïó∞ÏÜç Í∏∞Î°ù</div>
                        <div class="stats-card-value" id="overallMaxStreak">0</div>
                        <div class="stats-card-label">Ïùº</div>
                    </div>
                </div>
            </div>

            <!-- ÌÜµÍ≥Ñ ÌéòÏù¥ÏßÄ -->
            <div id="statsPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">ÌÜµÍ≥Ñ</h1>
                    <p class="page-subtitle">ÎãπÏã†Ïùò ÏÑ±Ï∑®Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                </div>
                <div style="margin-bottom: 24px;">
                    <select class="year-selector" id="statsYearSelect">
                        <option value="2026">2026</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
                <div class="stats-grid" id="statsContainer">
                    <!-- ÌÜµÍ≥Ñ Ïπ¥ÎìúÎì§ -->
                </div>
                <div class="grass-container">
                    <h3 style="margin-bottom: 24px;">Ï∑®ÎØ∏Î≥Ñ Îã¨ÏÑ±Î•†</h3>
                    <div class="hobby-stats-list" id="hobbyStatsContainer">
                        <!-- Ï∑®ÎØ∏Î≥Ñ ÌÜµÍ≥Ñ -->
                    </div>
                </div>
            </div>

            <!-- Ï∑®ÎØ∏ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ -->
            <div id="hobbyDetailPage" class="page">
                <div class="page-header">
                    <h1 class="page-title" id="hobbyDetailTitle">Ï∑®ÎØ∏ ÏÉÅÏÑ∏</h1>
                    <p class="page-subtitle" id="hobbyDetailSubtitle"></p>
                </div>
                <div class="grass-container">
                    <div class="grass-header">
                        <h3 id="hobbyDetailName">ÏûîÎîîÎ∞≠</h3>
                        <select class="year-selector" id="hobbyDetailYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div id="hobbyDetailGrassContainer"></div>
                </div>
                <div style="margin-top: 24px;">
                    <button class="btn btn-secondary" id="backToDashboard">‚Üê ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Í∏∞Î°ù Î™®Îã¨ -->
    <div id="recordModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeRecordModal()">√ó</button>
            <div class="modal-header">
                <h2 class="modal-title" id="recordModalTitle">Ïò§Îäò Í∏∞Î°ùÌïòÍ∏∞</h2>
                <div class="modal-subtitle" id="recordModalSubtitle"></div>
            </div>
            <form id="recordForm">
                <div id="recordFormContent">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
                </div>
                <div class="form-group">
                    <label class="form-label">Î©îÎ™® (ÏÑ†ÌÉù)</label>
                    <textarea class="form-textarea" id="recordMemo" placeholder="Ïò§ÎäòÏùò ÏÜåÍ∞êÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeRecordModal()">Ï∑®ÏÜå</button>
                    <button type="submit" class="btn btn-success">Ï†ÄÏû•</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ï∑®ÎØ∏ ÏÉùÏÑ±/ÏàòÏ†ï Î™®Îã¨ -->
    <div id="hobbyModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeHobbyModal()">√ó</button>
            <div class="modal-header">
                <h2 class="modal-title" id="hobbyModalTitle">ÏÉà Ï∑®ÎØ∏ Ï∂îÍ∞Ä</h2>
                <div class="modal-subtitle">Íæ∏Ï§ÄÌûà Ïã§Ï≤úÌï† ÏäµÍ¥ÄÏùÑ ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî</div>
            </div>
            <form id="hobbyForm">
                <div class="form-group">
                    <label class="form-label">Ï∑®ÎØ∏Î™Ö *</label>
                    <input type="text" class="form-input" id="hobbyName" placeholder="Ïòà: Ïö¥Îèô, ÎèÖÏÑú, ÏòÅÎã®Ïñ¥" required maxlength="20">
                </div>
                <div class="form-group">
                    <label class="form-label">ÌÉÄÏûÖ *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="hobbyType" value="quant" checked>
                            <span>ÏàòÏπòÌòï</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="hobbyType" value="binary">
                            <span>ÏôÑÎ£åÌòï</span>
                        </label>
                    </div>
                </div>
                <div id="quantFields">
                    <div class="form-group">
                        <label class="form-label">Î™©Ìëú</label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="targetValue" placeholder="30" min="1" required>
                            <select class="form-select" id="targetUnit" required>
                                <option value="Î∂Ñ">Î∂Ñ</option>
                                <option value="Í∞ú">Í∞ú</option>
                                <option value="Ìöå">Ìöå</option>
                                <option value="ÌéòÏù¥ÏßÄ">ÌéòÏù¥ÏßÄ</option>
                                <option value="km">km</option>
                                <option value="Ïûî">Ïûî</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="binaryFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Î™©Ìëú ÏÑ§Î™Ö (ÏÑ†ÌÉù)</label>
                        <input type="text" class="form-input" id="binaryDesc" placeholder="Ïòà: 30Î∂Ñ Ïù¥ÏÉÅ ÎèÖÏÑúÌïòÍ∏∞">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ÏïÑÏù¥ÏΩò</label>
                    <div class="icon-picker" id="iconPicker">
                        <div class="icon-option selected" data-icon="üí™">üí™</div>
                        <div class="icon-option" data-icon="üìö">üìö</div>
                        <div class="icon-option" data-icon="‚úçÔ∏è">‚úçÔ∏è</div>
                        <div class="icon-option" data-icon="üèÉ">üèÉ</div>
                        <div class="icon-option" data-icon="üßò">üßò</div>
                        <div class="icon-option" data-icon="üé®">üé®</div>
                        <div class="icon-option" data-icon="üéµ">üéµ</div>
                        <div class="icon-option" data-icon="üéÆ">üéÆ</div>
                        <div class="icon-option" data-icon="üíª">üíª</div>
                        <div class="icon-option" data-icon="üåø">üåø</div>
                        <div class="icon-option" data-icon="‚òï">‚òï</div>
                        <div class="icon-option" data-icon="üçé">üçé</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeHobbyModal()">Ï∑®ÏÜå</button>
                    <button type="submit" class="btn btn-success">Ï†ÄÏû•</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ìà¥ÌåÅ -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        // Ï†ÑÏó≠ ÏÉÅÌÉú
        let currentUser = null;
        let hobbies = [];
        let records = [];
        let currentPage = 'dashboard';
        let selectedHobbyId = null;
        let isSignupMode = false;

        // ÏÉâÏÉÅ ÏÉÅÏàò
        const COLORS = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'];

        // ÎÇ†Ïßú Ïú†Ìã∏Î¶¨Ìã∞
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function parseDate(dateStr) {
            return new Date(dateStr + 'T00:00:00');
        }

        function getKoreanDate(date) {
            const days = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayOfWeek = days[date.getDay()];
            return `${year}ÎÖÑ ${month}Ïõî ${day}Ïùº ${dayOfWeek}ÏöîÏùº`;
        }

        function getTodayString() {
            return formatDate(new Date());
        }

        // Firebase Firestore Ïú†Ìã∏Î¶¨Ìã∞
        async function saveToFirestore() {
            if (!currentUser || !window.firebaseDb) return;

            const { doc, setDoc } = window.firebaseDbFunctions;
            const db = window.firebaseDb;

            try {
                // Ïú†Ï†Ä Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                await setDoc(doc(db, 'users', currentUser.uid), {
                    email: currentUser.email,
                    name: currentUser.name,
                    updatedAt: new Date().toISOString()
                });

                // Ï∑®ÎØ∏ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                await setDoc(doc(db, 'users', currentUser.uid, 'data', 'hobbies'), {
                    items: hobbies
                });

                // Í∏∞Î°ù Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                await setDoc(doc(db, 'users', currentUser.uid, 'data', 'records'), {
                    items: records
                });

                console.log('FirestoreÏóê Ï†ÄÏû• ÏôÑÎ£å');
            } catch (error) {
                console.error('Firestore Ï†ÄÏû• Ïò§Î•ò:', error);
                // Ïò§ÌîÑÎùºÏù∏ Î∞±ÏóÖÏúºÎ°ú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÎèÑ ÏÇ¨Ïö©
                saveToLocalStorage();
            }
        }

        async function loadFromFirestore() {
            if (!currentUser || !window.firebaseDb) return;

            const { doc, getDoc } = window.firebaseDbFunctions;
            const db = window.firebaseDb;

            try {
                // Ï∑®ÎØ∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                const hobbiesDoc = await getDoc(doc(db, 'users', currentUser.uid, 'data', 'hobbies'));
                if (hobbiesDoc.exists()) {
                    hobbies = hobbiesDoc.data().items || [];
                }

                // Í∏∞Î°ù Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                const recordsDoc = await getDoc(doc(db, 'users', currentUser.uid, 'data', 'records'));
                if (recordsDoc.exists()) {
                    records = recordsDoc.data().items || [];
                }

                console.log('FirestoreÏóêÏÑú Î°úÎìú ÏôÑÎ£å');
            } catch (error) {
                console.error('Firestore Î°úÎìú Ïò§Î•ò:', error);
                // Ïò§ÌîÑÎùºÏù∏ Î∞±ÏóÖÏóêÏÑú Î°úÎìú ÏãúÎèÑ
                loadFromLocalStorage();
            }
        }

        // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∞±ÏóÖ (Ïò§ÌîÑÎùºÏù∏ ÏßÄÏõê)
        function saveToLocalStorage() {
            localStorage.setItem('lifeCommitData', JSON.stringify({
                hobbies,
                records
            }));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('lifeCommitData');
            if (data) {
                const parsed = JSON.parse(data);
                hobbies = parsed.hobbies || [];
                records = parsed.records || [];
            }
        }

        // Ï†ÄÏû• Ìï®Ïàò (Î°úÏª¨ Î®ºÏ†Ä Ï†ÄÏû• ÌõÑ Firestore ÎèôÍ∏∞Ìôî)
        async function saveToStorage() {
            saveToLocalStorage();
            if (currentUser && window.firebaseDb) {
                await saveToFirestore();
            }
        }

        // Î°úÎìú Ìï®Ïàò (Firestore Ïö∞ÏÑ†, Î°úÏª¨ Î∞±ÏóÖ)
        async function loadFromStorage() {
            if (currentUser && window.firebaseDb) {
                await loadFromFirestore();
            } else {
                loadFromLocalStorage();
            }
        }

        // ÌÖåÎßà Í¥ÄÎ¶¨
        function initTheme() {
            const savedTheme = localStorage.getItem('lifeCommitTheme') || 'dark';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('lifeCommitTheme', theme);
            
            const themeIcon = document.querySelector('.theme-icon');
            const themeText = document.querySelector('.theme-text');
            
            if (themeIcon && themeText) {
                if (theme === 'light') {
                    themeIcon.textContent = 'üåô';
                    themeText.textContent = 'Îã§ÌÅ¨ Î™®Îìú';
                } else {
                    themeIcon.textContent = '‚òÄÔ∏è';
                    themeText.textContent = 'ÎùºÏù¥Ìä∏ Î™®Îìú';
                }
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        // UUID ÏÉùÏÑ±
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // ÏóêÎü¨ Î©îÏãúÏßÄ ÌëúÏãú
        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function hideAuthError() {
            document.getElementById('authError').style.display = 'none';
        }

        function showAuthSuccess(message) {
            const successEl = document.getElementById('authSuccess');
            successEl.textContent = message;
            successEl.style.display = 'block';
        }

        function hideAuthSuccess() {
            document.getElementById('authSuccess').style.display = 'none';
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï
        document.getElementById('forgotPasswordLink').addEventListener('click', async function(e) {
            e.preventDefault();
            hideAuthError();
            hideAuthSuccess();

            const email = document.getElementById('authEmail').value;

            if (!email) {
                showAuthError('Ïù¥Î©îÏùºÏùÑ Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (!window.firebaseAuth || !window.firebaseAuthFunctions) {
                showAuthError('FirebaseÍ∞Ä ÏïÑÏßÅ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            const { sendPasswordResetEmail } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            try {
                await sendPasswordResetEmail(auth, email);
                showAuthSuccess('ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï Ïù¥Î©îÏùºÏùÑ Î∞úÏÜ°ÌñàÏäµÎãàÎã§. Ïù¥Î©îÏùºÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
            } catch (error) {
                console.error('ÎπÑÎ∞ÄÎ≤àÌò∏ Ïû¨ÏÑ§Ï†ï Ïò§Î•ò:', error);
                if (error.code === 'auth/user-not-found') {
                    showAuthError('Îì±Î°ùÎêòÏßÄ ÏïäÏùÄ Ïù¥Î©îÏùºÏûÖÎãàÎã§.');
                } else if (error.code === 'auth/invalid-email') {
                    showAuthError('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ïù¥Î©îÏùº ÌòïÏãùÏûÖÎãàÎã§.');
                } else {
                    showAuthError('Ïù¥Î©îÏùº Î∞úÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            }
        });

        // ÌöåÏõêÍ∞ÄÏûÖ/Î°úÍ∑∏Ïù∏ ÌÜ†Í∏Ä
        document.getElementById('authToggleLink').addEventListener('click', function(e) {
            e.preventDefault();
            isSignupMode = !isSignupMode;

            const submitBtn = document.getElementById('authSubmitBtn');
            const toggleText = document.getElementById('authToggleText');
            const toggleLink = document.getElementById('authToggleLink');

            if (isSignupMode) {
                submitBtn.textContent = 'ÌöåÏõêÍ∞ÄÏûÖ';
                toggleText.textContent = 'Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî?';
                toggleLink.textContent = 'Î°úÍ∑∏Ïù∏';
            } else {
                submitBtn.textContent = 'Î°úÍ∑∏Ïù∏';
                toggleText.textContent = 'Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî?';
                toggleLink.textContent = 'ÌöåÏõêÍ∞ÄÏûÖ';
            }

            hideAuthError();
            hideAuthSuccess();
        });

        // Firebase ÏóêÎü¨ Î©îÏãúÏßÄ ÌïúÍ∏ÄÌôî
        function getFirebaseErrorMessage(errorCode) {
            const errorMessages = {
                'auth/email-already-in-use': 'Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ Ïù¥Î©îÏùºÏûÖÎãàÎã§.',
                'auth/invalid-email': 'Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ïù¥Î©îÏùº ÌòïÏãùÏûÖÎãàÎã§.',
                'auth/operation-not-allowed': 'Ïù¥Î©îÏùº/ÎπÑÎ∞ÄÎ≤àÌò∏ Î°úÍ∑∏Ïù∏Ïù¥ ÎπÑÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.',
                'auth/weak-password': 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÎÑàÎ¨¥ ÏïΩÌï©ÎãàÎã§. (ÏµúÏÜå 6Ïûê)',
                'auth/user-disabled': 'ÎπÑÌôúÏÑ±ÌôîÎêú Í≥ÑÏ†ïÏûÖÎãàÎã§.',
                'auth/user-not-found': 'Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî Í≥ÑÏ†ïÏûÖÎãàÎã§.',
                'auth/wrong-password': 'ÏûòÎ™ªÎêú ÎπÑÎ∞ÄÎ≤àÌò∏ÏûÖÎãàÎã§.',
                'auth/invalid-credential': 'Ïù¥Î©îÏùº ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.',
                'auth/too-many-requests': 'ÎÑàÎ¨¥ ÎßéÏùÄ ÏãúÎèÑÍ∞Ä ÏûàÏóàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.',
                'auth/network-request-failed': 'ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'
            };
            return errorMessages[errorCode] || 'Ïù∏Ï¶ù Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
        }

        // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± (ÏÉà ÏÇ¨Ïö©ÏûêÏö©)
        function createInitialData() {
            hobbies = [
                {
                    id: generateId(),
                    name: 'Ïö¥Îèô',
                    type: 'quant',
                    targetValue: 30,
                    unit: 'Î∂Ñ',
                    icon: 'üí™',
                    color: COLORS[0],
                    isActive: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: 'ÎèÖÏÑú',
                    type: 'quant',
                    targetValue: 30,
                    unit: 'Î∂Ñ',
                    icon: 'üìö',
                    color: COLORS[3],
                    isActive: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: 'Î™ÖÏÉÅ',
                    type: 'binary',
                    icon: 'üßò',
                    color: COLORS[4],
                    isActive: true,
                    createdAt: new Date().toISOString()
                }
            ];
            records = [];
        }

        // Î°úÍ∑∏Ïù∏ ÌõÑ Ï≤òÎ¶¨
        async function handleAuthSuccess(user, isNewUser = false) {
            currentUser = {
                uid: user.uid,
                email: user.email,
                name: user.email.split('@')[0]
            };

            document.getElementById('userName').textContent = currentUser.name;

            // Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÎòêÎäî Ï¥àÍ∏∞Ìôî
            await loadFromStorage();

            if (isNewUser) {
                createInitialData();
                await saveToStorage();
            }

            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            renderDashboard();
        }

        // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            hideAuthError();

            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const submitBtn = document.getElementById('authSubmitBtn');

            // FirebaseÍ∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ Ï≤¥ÌÅ¨
            if (!window.firebaseAuth || !window.firebaseAuthFunctions) {
                showAuthError('FirebaseÍ∞Ä ÏïÑÏßÅ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const { createUserWithEmailAndPassword, signInWithEmailAndPassword } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            submitBtn.classList.add('auth-loading');
            submitBtn.disabled = true;

            try {
                if (isSignupMode) {
                    // ÌöåÏõêÍ∞ÄÏûÖ
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    console.log('ÌöåÏõêÍ∞ÄÏûÖ ÏÑ±Í≥µ:', userCredential.user.email);
                    await handleAuthSuccess(userCredential.user, true);
                } else {
                    // Î°úÍ∑∏Ïù∏
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    console.log('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ:', userCredential.user.email);
                    await handleAuthSuccess(userCredential.user, false);
                }
            } catch (error) {
                console.error('Ïù∏Ï¶ù Ïò§Î•ò:', error);
                showAuthError(getFirebaseErrorMessage(error.code));
            } finally {
                submitBtn.classList.remove('auth-loading');
                submitBtn.disabled = false;
            }
        });

        // Î°úÍ∑∏ÏïÑÏõÉ
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                try {
                    if (window.firebaseAuth && window.firebaseAuthFunctions) {
                        const { signOut } = window.firebaseAuthFunctions;
                        await signOut(window.firebaseAuth);
                    }

                    currentUser = null;
                    hobbies = [];
                    records = [];

                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('loginPage').style.display = 'flex';

                    // Ìèº Ï¥àÍ∏∞Ìôî
                    document.getElementById('loginForm').reset();
                    hideAuthError();
                } catch (error) {
                    console.error('Î°úÍ∑∏ÏïÑÏõÉ Ïò§Î•ò:', error);
                }
            }
        });

        // ÌÖåÎßà ÌÜ†Í∏Ä
        document.getElementById('themeToggle').addEventListener('click', function() {
            toggleTheme();
        });

        // Î™®Î∞îÏùº Î©îÎâ¥ ÌÜ†Í∏Ä
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const isOpen = sidebar.classList.contains('mobile-open');

            if (isOpen) {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('mobile-open');
                overlay.classList.add('active');
            }
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
        }

        document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
        document.getElementById('mobileOverlay').addEventListener('click', closeMobileMenu);

        // ÌéòÏù¥ÏßÄ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        document.querySelectorAll('.nav-link, .widget-action').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.getAttribute('data-page');
                if (page) {
                    navigateTo(page);
                }
            });
        });

        function navigateTo(page) {
            currentPage = page;

            // Î™®Î∞îÏùº Î©îÎâ¥ Îã´Í∏∞
            closeMobileMenu();

            // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌôúÏÑ±Ìôî
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                }
            });

            // ÌéòÏù¥ÏßÄ ÌëúÏãú
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById(page + 'Page').classList.add('active');

            // ÌéòÏù¥ÏßÄÎ≥Ñ Î†åÎçîÎßÅ
            switch(page) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'hobbies':
                    renderHobbiesList();
                    break;
                case 'overall':
                    renderOverall();
                    break;
                case 'stats':
                    renderStats();
                    break;
            }
        }

        // ÎåÄÏãúÎ≥¥Îìú Î†åÎçîÎßÅ
        function renderDashboard() {
            // Ïò§Îäò ÎÇ†Ïßú ÌëúÏãú
            document.getElementById('todayDate').textContent = getKoreanDate(new Date());

            // ÌôúÏÑ± Ï∑®ÎØ∏ Í∞ÄÏ†∏Ïò§Í∏∞
            const activeHobbies = hobbies.filter(h => h.isActive);
            const today = getTodayString();

            // Ïò§ÎäòÏùò ÏßÑÌñâÎèÑ Í≥ÑÏÇ∞
            const todayRecords = records.filter(r => r.date === today);
            const completedCount = activeHobbies.filter(hobby => {
                const record = todayRecords.find(r => r.hobbyId === hobby.id);
                return record && record.achieved;
            }).length;

            // ÏßÑÌñâÎèÑ Ïõê ÏóÖÎç∞Ïù¥Ìä∏
            const progressCircle = document.getElementById('todayProgress');
            const percentage = activeHobbies.length > 0 ? (completedCount / activeHobbies.length) * 100 : 0;
            progressCircle.style.background = `conic-gradient(var(--success) ${percentage}%, var(--grass-empty) 0%)`;
            progressCircle.querySelector('.progress-text').textContent = `${completedCount}/${activeHobbies.length}`;

            // Ï∑®ÎØ∏ Ïπ¥Îìú Î†åÎçîÎßÅ
            const container = document.getElementById('hobbyCardsContainer');
            if (activeHobbies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üå±</div>
                        <h3 class="empty-title">Ï∑®ÎØ∏Î•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî</h3>
                        <p class="empty-text">Ï≤´ Î≤àÏß∏ ÏäµÍ¥ÄÏùÑ ÎßåÎì§Í≥† Íæ∏Ï§ÄÌï®ÏùÑ Í∏∞Î°ùÌïòÏÑ∏Ïöî</p>
                        <button class="btn btn-primary" onclick="navigateTo('hobbies')">Ï∑®ÎØ∏ Ï∂îÍ∞ÄÌïòÍ∏∞</button>
                    </div>
                `;
            } else {
                container.innerHTML = activeHobbies.map(hobby => {
                    const record = todayRecords.find(r => r.hobbyId === hobby.id);
                    let status = 'pending';
                    let statusText = 'ÎØ∏ÏôÑÎ£å';
                    let recordValue = '';

                    if (record) {
                        if (hobby.type === 'quant') {
                            recordValue = `${record.value}${hobby.unit}`;
                            if (record.value >= hobby.targetValue * 1.5) {
                                status = 'exceeded';
                                statusText = 'Ï¥àÍ≥ºÎã¨ÏÑ±';
                            } else if (record.achieved) {
                                status = 'completed';
                                statusText = 'ÏôÑÎ£å';
                            } else {
                                status = 'pending';
                                statusText = 'ÎØ∏ÏôÑÎ£å';
                            }
                        } else {
                            if (record.achieved) {
                                status = 'completed';
                                statusText = 'ÏôÑÎ£å';
                            } else {
                                status = 'pending';
                                statusText = 'ÎØ∏ÏôÑÎ£å';
                            }
                        }
                    }

                    const targetText = hobby.type === 'quant' 
                        ? `Î™©Ìëú: ${hobby.targetValue}${hobby.unit}`
                        : 'ÏôÑÎ£å Ïó¨Î∂Ä Ï≤¥ÌÅ¨';

                    return `
                        <div class="hobby-card" onclick="showHobbyDetail('${hobby.id}')">
                            <div class="hobby-card-header">
                                <div class="hobby-info">
                                    <div class="hobby-name">
                                        <span class="hobby-icon">${hobby.icon}</span>
                                        ${hobby.name}
                                    </div>
                                    <div class="hobby-target">${targetText}</div>
                                    ${recordValue ? `<div class="hobby-target" style="color: var(--success); font-weight: 600;">${recordValue}</div>` : ''}
                                </div>
                                <div class="hobby-status status-${status}">${statusText}</div>
                            </div>
                            <div class="hobby-action" style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" style="flex: 1;" onclick="event.stopPropagation(); toggleTodayRecord('${hobby.id}')">
                                    ${record ? (record.achieved ? '<span style="text-decoration: line-through; text-decoration-thickness: 2px; text-decoration-color: currentColor;">ÏôÑÎ£å</span>' : 'ÏôÑÎ£å') : 'Ïò§Îäò Ï≤¥ÌÅ¨'}
                                </button>
                                <button class="btn btn-secondary" onclick="event.stopPropagation(); editHobby('${hobby.id}')" title="Ï∑®ÎØ∏ ÏÑ§Ï†ï ÏàòÏ†ï">
                                    ‚öôÔ∏è
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // ÎåÄÏãúÎ≥¥Îìú Overall ÏûîÎîîÎ∞≠ Î†åÎçîÎßÅ
            renderDashboardOverall();

            // ÎåÄÏãúÎ≥¥Îìú ÌÜµÍ≥Ñ Î†åÎçîÎßÅ
            renderDashboardStats();
        }

        // ÎåÄÏãúÎ≥¥Îìú Overall ÏûîÎîîÎ∞≠ Î†åÎçîÎßÅ
        function renderDashboardOverall() {
            const yearSelect = document.getElementById('dashboardOverallYearSelect');
            const year = parseInt(yearSelect.value);
            
            yearSelect.onchange = function() {
                renderDashboardOverall();
            };

            renderOverallGrassInContainer('dashboardOverallGrassContainer', year);

            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('dashboardOverallYearCount').textContent = calculateOverallCount(year);
            document.getElementById('dashboardOverallCurrentStreak').textContent = calculateOverallCurrentStreak();
            document.getElementById('dashboardOverallMaxStreak').textContent = calculateOverallMaxStreak(year);
        }

        // ÎåÄÏãúÎ≥¥Îìú ÌÜµÍ≥Ñ Î†åÎçîÎßÅ
        function renderDashboardStats() {
            const yearSelect = document.getElementById('dashboardStatsYearSelect');
            const year = parseInt(yearSelect.value);
            
            yearSelect.onchange = function() {
                renderDashboardStats();
            };

            // Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const activeHobbies = hobbies.filter(h => h.isActive);
            const yearRecords = records.filter(r => {
                const recordYear = parseInt(r.date.split('-')[0]);
                return recordYear === year;
            });

            const totalDays = Math.min(365, Math.floor((new Date() - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24)) + 1);
            const totalPossible = totalDays * activeHobbies.length;
            const totalAchieved = yearRecords.filter(r => r.achieved).length;
            const achievementRate = totalPossible > 0 ? Math.round((totalAchieved / totalPossible) * 100) : 0;

            const overallCount = calculateOverallCount(year);
            const overallRate = totalDays > 0 ? Math.round((overallCount / totalDays) * 100) : 0;

            // ÌÜµÍ≥Ñ Ïπ¥Îìú Î†åÎçîÎßÅ
            const statsContainer = document.getElementById('dashboardStatsContainer');
            statsContainer.innerHTML = `
                <div class="stats-card">
                    <div class="stats-card-title">Ï†ÑÏ≤¥ Îã¨ÏÑ±Î•†</div>
                    <div class="stats-card-value">${achievementRate}%</div>
                    <div class="stats-card-label">${totalAchieved} / ${totalPossible}</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">ÏôÑÎ≤ΩÌïú ÌïòÎ£®</div>
                    <div class="stats-card-value">${overallCount}</div>
                    <div class="stats-card-label">Ï¥ù ${totalDays}Ïùº Ï§ë</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">Ï¢ÖÌï© Îã¨ÏÑ±Î•†</div>
                    <div class="stats-card-value">${overallRate}%</div>
                    <div class="stats-card-label">ÏôÑÎ≤ΩÌïú ÌïòÎ£® ÎπÑÏú®</div>
                </div>
            `;

            // Ï∑®ÎØ∏Î≥Ñ ÌÜµÍ≥Ñ
            const hobbyStatsContainer = document.getElementById('dashboardHobbyStatsContainer');
            if (activeHobbies.length === 0) {
                hobbyStatsContainer.innerHTML = `
                    <div class="empty-state">
                        <p class="empty-text">ÌôúÏÑ± Ï∑®ÎØ∏Í∞Ä ÏóÜÏäµÎãàÎã§</p>
                    </div>
                `;
            } else {
                hobbyStatsContainer.innerHTML = activeHobbies.map(hobby => {
                    const hobbyRecords = yearRecords.filter(r => r.hobbyId === hobby.id);
                    const achievedCount = hobbyRecords.filter(r => r.achieved).length;
                    const rate = totalDays > 0 ? Math.round((achievedCount / totalDays) * 100) : 0;
                    const currentStreak = calculateCurrentStreak(hobby.id);
                    const maxStreak = calculateMaxStreak(hobby.id, year);

                    return `
                        <div class="hobby-stat-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                            <div class="hobby-stat-name">
                                <span>${hobby.icon}</span>
                                <span>${hobby.name}</span>
                            </div>
                            <div style="text-align: right;">
                                <div class="hobby-stat-value">${rate}%</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                                    ÌòÑÏû¨ ${currentStreak}Ïùº ¬∑ ÏµúÏû• ${maxStreak}Ïùº
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Overall Îã¨ÏÑ± Ïó¨Î∂Ä Ï≤¥ÌÅ¨
        function checkOverallAchievement(date) {
            const activeHobbies = hobbies.filter(h => h.isActive);
            if (activeHobbies.length === 0) return false;

            const dayRecords = records.filter(r => r.date === date);
            
            return activeHobbies.every(hobby => {
                const record = dayRecords.find(r => r.hobbyId === hobby.id);
                return record && record.achieved;
            });
        }

        // Overall ÏûîÎîî Î†åÎçîÎßÅ (Ïû¨ÏÇ¨Ïö© Í∞ÄÎä•)
        function renderOverallGrassInContainer(containerId, year) {
            const container = document.getElementById(containerId);
            
            // ÏûîÎîî Í∑∏Î¶¨Îìú ÏÉùÏÑ±
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            let html = '<div class="grass-graph"><div class="grass-grid">';
            
            let currentDate = new Date(startDate);
            
            // Ï≤´ Ï£ºÏùò ÏãúÏûëÏùÑ ÏõîÏöîÏùºÎ°ú ÎßûÏ∂îÍ∏∞
            while (currentDate.getDay() !== 1) {
                currentDate.setDate(currentDate.getDate() - 1);
            }

            let weekCount = 0;
            while (currentDate <= endDate || currentDate.getDay() !== 1) {
                html += '<div class="grass-column">';
                
                for (let day = 0; day < 7; day++) {
                    const dateStr = formatDate(currentDate);
                    const isAchieved = checkOverallAchievement(dateStr);
                    const isCurrentYear = currentDate.getFullYear() === year;
                    
                    html += `<div class="grass-cell-full ${isAchieved && isCurrentYear ? 'level-4' : ''}" 
                             title="${dateStr}${isAchieved ? ' - ÏôÑÎ≤ΩÌïú ÌïòÎ£®' : ''}"></div>`;
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                html += '</div>';
                weekCount++;
                
                if (weekCount > 53) break;
            }
            
            html += '</div></div>';
            
            // Î≤îÎ°Ä Ï∂îÍ∞Ä
            html += `
                <div class="grass-legend">
                    <span>Less</span>
                    <div class="grass-legend-item"><div class="grass-cell"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-4"></div></div>
                    <span>More</span>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Overall Ïπ¥Ïö¥Ìä∏ Í≥ÑÏÇ∞
        function calculateOverallCount(year) {
            let count = 0;
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            const today = new Date();
            const lastDate = endDate > today ? today : endDate;

            for (let d = new Date(startDate); d <= lastDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                if (checkOverallAchievement(dateStr)) {
                    count++;
                }
            }
            return count;
        }

        // Quick Stats Î†åÎçîÎßÅ
        // ÌòÑÏû¨ Ïä§Ìä∏Î¶≠ Í≥ÑÏÇ∞
        function calculateCurrentStreak(hobbyId) {
            const today = new Date();
            let streak = 0;
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                
                const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                if (record && record.achieved) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        // ÏµúÏû• Ïä§Ìä∏Î¶≠ Í≥ÑÏÇ∞
        function calculateMaxStreak(hobbyId, year) {
            let maxStreak = 0;
            let currentStreak = 0;
            
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                
                if (record && record.achieved) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            }
            
            return maxStreak;
        }

        // Ïò§Îäò Í∏∞Î°ù ÌÜ†Í∏Ä (ÏôÑÎ£åÌòï) ÎòêÎäî Î™®Îã¨ Ïó¥Í∏∞ (ÏàòÏπòÌòï)
        async function toggleTodayRecord(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            const today = getTodayString();
            const existingRecord = records.find(r => r.hobbyId === hobbyId && r.date === today);

            if (hobby.type === 'binary') {
                // ÏôÑÎ£åÌòï: ÌÜ†Í∏Ä Î∞©Ïãù
                if (existingRecord) {
                    // Í∏∞Ï°¥ Í∏∞Î°ùÏù¥ ÏûàÏúºÎ©¥ achieved ÌÜ†Í∏Ä
                    existingRecord.achieved = !existingRecord.achieved;
                    existingRecord.updatedAt = new Date().toISOString();
                } else {
                    // Í∏∞Ï°¥ Í∏∞Î°ùÏù¥ ÏóÜÏúºÎ©¥ ÏôÑÎ£åÎ°ú ÏÉùÏÑ±
                    const newRecord = {
                        id: generateId(),
                        hobbyId: hobbyId,
                        date: today,
                        achieved: true,
                        createdAt: new Date().toISOString()
                    };
                    records.push(newRecord);
                }
                await saveToStorage();
                renderDashboard();
            } else {
                // ÏàòÏπòÌòï: Î™®Îã¨ Ïó¥Í∏∞
                openRecordModal(hobbyId);
            }
        }

        // Í∏∞Î°ù Î™®Îã¨ Ïó¥Í∏∞
        function openRecordModal(hobbyId, date = null) {
            selectedHobbyId = hobbyId;
            const hobby = hobbies.find(h => h.id === hobbyId);
            const targetDate = date || getTodayString();
            
            document.getElementById('recordModalTitle').textContent = 
                date ? 'Í∏∞Î°ù ÏàòÏ†ï' : 'Ïò§Îäò Í∏∞Î°ùÌïòÍ∏∞';
            document.getElementById('recordModalSubtitle').textContent = 
                `${hobby.icon} ${hobby.name} - ${targetDate}`;

            const existingRecord = records.find(r => r.hobbyId === hobbyId && r.date === targetDate);
            
            let formHtml = '';
            if (hobby.type === 'quant') {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">Îã¨ÏÑ±Îüâ *</label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="recordValue" 
                                   value="${existingRecord ? existingRecord.value : ''}" 
                                   placeholder="${hobby.targetValue}" min="0" required>
                            <input type="text" class="form-input" value="${hobby.unit}" readonly>
                        </div>
                        <div style="margin-top: 8px; font-size: 13px; color: var(--text-secondary);">
                            Î™©Ìëú: ${hobby.targetValue}${hobby.unit}
                        </div>
                    </div>
                `;
            } else {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">ÏôÑÎ£å Ïó¨Î∂Ä</label>
                        <div class="radio-group">
                            <label class="radio-label ${!existingRecord || existingRecord.achieved ? '' : 'selected'}">
                                <input type="radio" name="achieved" value="false" ${!existingRecord || !existingRecord.achieved ? 'checked' : ''}>
                                <span>ÎØ∏ÏôÑÎ£å</span>
                            </label>
                            <label class="radio-label ${existingRecord && existingRecord.achieved ? 'selected' : ''}">
                                <input type="radio" name="achieved" value="true" ${existingRecord && existingRecord.achieved ? 'checked' : ''}>
                                <span>ÏôÑÎ£å</span>
                            </label>
                        </div>
                    </div>
                `;
            }

            document.getElementById('recordFormContent').innerHTML = formHtml;
            document.getElementById('recordMemo').value = existingRecord ? (existingRecord.memo || '') : '';
            
            // ÎùºÎîîÏò§ Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.radio-label').forEach(label => {
                label.addEventListener('click', function() {
                    document.querySelectorAll('.radio-label').forEach(l => l.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            document.getElementById('recordModal').classList.add('active');
        }

        function closeRecordModal() {
            document.getElementById('recordModal').classList.remove('active');
            selectedHobbyId = null;
        }

        // Í∏∞Î°ù Ï†ÄÏû•
        document.getElementById('recordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const hobby = hobbies.find(h => h.id === selectedHobbyId);
            const today = getTodayString();
            const memo = document.getElementById('recordMemo').value;
            
            let recordData = {
                hobbyId: selectedHobbyId,
                date: today,
                memo: memo,
                createdAt: new Date().toISOString()
            };

            if (hobby.type === 'quant') {
                const value = parseInt(document.getElementById('recordValue').value);
                recordData.value = value;
                recordData.achieved = value >= hobby.targetValue;
            } else {
                const achievedInput = document.querySelector('input[name="achieved"]:checked');
                recordData.achieved = achievedInput.value === 'true';
            }

            // Í∏∞Ï°¥ Í∏∞Î°ù ÌôïÏù∏
            const existingIndex = records.findIndex(r => r.hobbyId === selectedHobbyId && r.date === today);
            if (existingIndex >= 0) {
                recordData.id = records[existingIndex].id;
                records[existingIndex] = recordData;
            } else {
                recordData.id = generateId();
                records.push(recordData);
            }

            await saveToStorage();
            closeRecordModal();
            renderDashboard();
        });

        // Ï∑®ÎØ∏ Î™©Î°ù Î†åÎçîÎßÅ
        function renderHobbiesList() {
            const container = document.getElementById('hobbyListContainer');
            
            if (hobbies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üå±</div>
                        <h3 class="empty-title">ÏïÑÏßÅ Ï∑®ÎØ∏Í∞Ä ÏóÜÏäµÎãàÎã§</h3>
                        <p class="empty-text">Ï≤´ Î≤àÏß∏ Ï∑®ÎØ∏Î•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = hobbies.map(hobby => {
                const targetText = hobby.type === 'quant' 
                    ? `${hobby.targetValue}${hobby.unit}`
                    : 'ÏôÑÎ£åÌòï';
                
                const recordCount = records.filter(r => r.hobbyId === hobby.id).length;

                return `
                    <div class="hobby-list-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                        <div class="hobby-list-info">
                            <div class="hobby-list-name">
                                <span>${hobby.icon}</span>
                                ${hobby.name}
                            </div>
                            <div class="hobby-list-meta">
                                Î™©Ìëú: ${targetText} ¬∑ Ï¥ù ${recordCount}Ìöå Í∏∞Î°ù
                            </div>
                        </div>
                        <div class="hobby-list-actions">
                            <div class="toggle-switch ${hobby.isActive ? 'active' : ''}" 
                                 onclick="event.stopPropagation(); toggleHobbyActive('${hobby.id}')">
                                <div class="toggle-slider"></div>
                            </div>
                            <button class="btn-icon" onclick="event.stopPropagation(); editHobby('${hobby.id}')">
                                ÏàòÏ†ï
                            </button>
                            <button class="btn-icon" onclick="event.stopPropagation(); deleteHobby('${hobby.id}')" 
                                    style="color: var(--danger);">
                                ÏÇ≠Ï†ú
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ï∑®ÎØ∏ ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
        async function toggleHobbyActive(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            hobby.isActive = !hobby.isActive;
            await saveToStorage();
            renderHobbiesList();
        }

        // Ï∑®ÎØ∏ ÏÇ≠Ï†ú
        async function deleteHobby(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            if (confirm(`"${hobby.name}"ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÎ™®Îì† Í∏∞Î°ùÎèÑ Ìï®Íªò ÏÇ≠Ï†úÎê©ÎãàÎã§.`)) {
                hobbies = hobbies.filter(h => h.id !== hobbyId);
                records = records.filter(r => r.hobbyId !== hobbyId);
                await saveToStorage();
                renderHobbiesList();
            }
        }

        // ÏÉà Ï∑®ÎØ∏ Î≤ÑÌäº
        document.getElementById('newHobbyBtn').addEventListener('click', function() {
            openHobbyModal();
        });

        // Ï∑®ÎØ∏ Î™®Îã¨ Ïó¥Í∏∞
        function openHobbyModal(hobbyId = null) {
            if (hobbyId) {
                // ÏàòÏ†ï Î™®Îìú
                const hobby = hobbies.find(h => h.id === hobbyId);
                document.getElementById('hobbyModalTitle').textContent = 'Ï∑®ÎØ∏ ÏàòÏ†ï';
                document.getElementById('hobbyName').value = hobby.name;
                
                // ÌÉÄÏûÖ ÏÑ§Ï†ï
                document.querySelector(`input[name="hobbyType"][value="${hobby.type}"]`).checked = true;
                
                if (hobby.type === 'quant') {
                    document.getElementById('quantFields').style.display = 'block';
                    document.getElementById('binaryFields').style.display = 'none';
                    document.getElementById('targetValue').value = hobby.targetValue;
                    document.getElementById('targetUnit').value = hobby.unit;
                } else {
                    document.getElementById('quantFields').style.display = 'none';
                    document.getElementById('binaryFields').style.display = 'block';
                    document.getElementById('binaryDesc').value = hobby.description || '';
                }
                
                // ÏïÑÏù¥ÏΩò ÏÑ†ÌÉù
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                    if (opt.getAttribute('data-icon') === hobby.icon) {
                        opt.classList.add('selected');
                    }
                });
                
                // ÌèºÏóê ÏàòÏ†ï Ï§ëÏù∏ ID Ï†ÄÏû•
                document.getElementById('hobbyForm').setAttribute('data-edit-id', hobbyId);
            } else {
                // ÏÉùÏÑ± Î™®Îìú
                document.getElementById('hobbyModalTitle').textContent = 'ÏÉà Ï∑®ÎØ∏ Ï∂îÍ∞Ä';
                document.getElementById('hobbyForm').reset();
                document.getElementById('hobbyForm').removeAttribute('data-edit-id');
                
                // Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏàòÏπòÌòï ÏÑ†ÌÉù Î∞è ÌïÑÎìú ÌëúÏãú
                document.querySelector('input[name="hobbyType"][value="quant"]').checked = true;
                document.getElementById('quantFields').style.display = 'block';
                document.getElementById('binaryFields').style.display = 'none';
                
                // ÏïÑÏù¥ÏΩò ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                document.querySelector('.icon-option').classList.add('selected');
            }
            
            document.getElementById('hobbyModal').classList.add('active');
        }

        function closeHobbyModal() {
            document.getElementById('hobbyModal').classList.remove('active');
            document.getElementById('hobbyForm').removeAttribute('data-edit-id');
        }

        // Ï∑®ÎØ∏ ÏàòÏ†ï Ìï®Ïàò
        function editHobby(hobbyId) {
            openHobbyModal(hobbyId);
        }

        // Ï∑®ÎØ∏ ÌÉÄÏûÖ Î≥ÄÍ≤Ω
        document.querySelectorAll('input[name="hobbyType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'quant') {
                    document.getElementById('quantFields').style.display = 'block';
                    document.getElementById('binaryFields').style.display = 'none';
                } else {
                    document.getElementById('quantFields').style.display = 'none';
                    document.getElementById('binaryFields').style.display = 'block';
                }
            });
        });

        // ÏïÑÏù¥ÏΩò ÏÑ†ÌÉù
        document.querySelectorAll('.icon-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
            });
        });

        // Ï∑®ÎØ∏ Ï†ÄÏû•
        document.getElementById('hobbyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const editId = this.getAttribute('data-edit-id');
            const name = document.getElementById('hobbyName').value;
            const type = document.querySelector('input[name="hobbyType"]:checked').value;
            const icon = document.querySelector('.icon-option.selected').getAttribute('data-icon');
            
            if (editId) {
                // ÏàòÏ†ï Î™®Îìú
                const hobby = hobbies.find(h => h.id === editId);
                hobby.name = name;
                hobby.type = type;
                hobby.icon = icon;
                
                if (type === 'quant') {
                    hobby.targetValue = parseInt(document.getElementById('targetValue').value);
                    hobby.unit = document.getElementById('targetUnit').value;
                    delete hobby.description;
                } else {
                    const desc = document.getElementById('binaryDesc').value;
                    if (desc) hobby.description = desc;
                    delete hobby.targetValue;
                    delete hobby.unit;
                }
                
                hobby.updatedAt = new Date().toISOString();
            } else {
                // ÏÉùÏÑ± Î™®Îìú
                const hobbyData = {
                    id: generateId(),
                    name: name,
                    type: type,
                    icon: icon,
                    color: COLORS[hobbies.length % COLORS.length],
                    isActive: true,
                    createdAt: new Date().toISOString()
                };

                if (type === 'quant') {
                    hobbyData.targetValue = parseInt(document.getElementById('targetValue').value);
                    hobbyData.unit = document.getElementById('targetUnit').value;
                } else {
                    const desc = document.getElementById('binaryDesc').value;
                    if (desc) hobbyData.description = desc;
                }

                hobbies.push(hobbyData);
            }

            await saveToStorage();
            closeHobbyModal();

            // ÌòÑÏû¨ ÌéòÏù¥ÏßÄÏóê Îî∞Îùº Î†åÎçîÎßÅ
            if (currentPage === 'hobbies') {
                renderHobbiesList();
            } else if (currentPage === 'dashboard') {
                renderDashboard();
            }
        });

        // Ï∑®ÎØ∏ ÏÉÅÏÑ∏ Î≥¥Í∏∞
        function showHobbyDetail(hobbyId) {
            selectedHobbyId = hobbyId;
            const hobby = hobbies.find(h => h.id === hobbyId);
            
            document.getElementById('hobbyDetailTitle').textContent = hobby.name;
            document.getElementById('hobbyDetailName').textContent = `${hobby.icon} ${hobby.name}`;
            
            const targetText = hobby.type === 'quant' 
                ? `Î™©Ìëú: ${hobby.targetValue}${hobby.unit}`
                : 'ÏôÑÎ£åÌòï Î™©Ìëú';
            document.getElementById('hobbyDetailSubtitle').textContent = targetText;

            navigateTo('hobbyDetail');
            renderHobbyGrass(hobbyId, new Date().getFullYear());
        }

        // Ï∑®ÎØ∏ ÏûîÎîîÎ∞≠ Î†åÎçîÎßÅ
        function renderHobbyGrass(hobbyId, year) {
            const container = document.getElementById('hobbyDetailGrassContainer');
            const hobby = hobbies.find(h => h.id === hobbyId);
            
            // Ïó∞ÎèÑ ÏÑ†ÌÉùÍ∏∞ ÏÑ§Ï†ï
            const yearSelect = document.getElementById('hobbyDetailYearSelect');
            yearSelect.value = year;
            yearSelect.onchange = function() {
                renderHobbyGrass(hobbyId, parseInt(this.value));
            };

            // Ïõî ÎùºÎ≤®
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // ÏûîÎîî Í∑∏Î¶¨Îìú ÏÉùÏÑ±
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            let html = '<div class="grass-graph"><div class="grass-grid">';
            
            let currentDate = new Date(startDate);
            
            // Ï≤´ Ï£ºÏùò ÏãúÏûëÏùÑ ÏõîÏöîÏùºÎ°ú ÎßûÏ∂îÍ∏∞
            while (currentDate.getDay() !== 1) {
                currentDate.setDate(currentDate.getDate() - 1);
            }

            let weekCount = 0;
            while (currentDate <= endDate || currentDate.getDay() !== 1) {
                html += '<div class="grass-column">';
                
                for (let day = 0; day < 7; day++) {
                    const dateStr = formatDate(currentDate);
                    const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                    
                    let level = 0;
                    let tooltipText = dateStr;
                    
                    if (record) {
                        if (hobby.type === 'quant') {
                            const percentage = (record.value / hobby.targetValue) * 100;
                            if (percentage >= 150) level = 4;
                            else if (percentage >= 100) level = 3;
                            else if (percentage >= 50) level = 2;
                            else level = 1;
                            tooltipText += ` - ${record.value}${hobby.unit}`;
                        } else {
                            level = record.achieved ? 4 : 0;
                            tooltipText += record.achieved ? ' - ÏôÑÎ£å' : '';
                        }
                    }

                    const isCurrentYear = currentDate.getFullYear() === year;
                    
                    html += `<div class="grass-cell-full ${level > 0 && isCurrentYear ? `level-${level}` : ''}" 
                             title="${tooltipText}"></div>`;
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                html += '</div>';
                weekCount++;
                
                if (weekCount > 53) break;
            }
            
            html += '</div></div>';
            
            // Î≤îÎ°Ä Ï∂îÍ∞Ä
            html += `
                <div class="grass-legend">
                    <span>Less</span>
                    <div class="grass-legend-item"><div class="grass-cell"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-1"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-2"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-3"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-4"></div></div>
                    <span>More</span>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ÎåÄÏãúÎ≥¥ÎìúÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
        document.getElementById('backToDashboard').addEventListener('click', function() {
            navigateTo('dashboard');
        });

        // Overall ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ
        function renderOverall() {
            const year = parseInt(document.getElementById('overallYearSelect').value);
            renderOverallGrass(year);
            
            document.getElementById('overallYearSelect').onchange = function() {
                renderOverall();
            };
        }

        function renderOverallGrass(year) {
            renderOverallGrassInContainer('overallGrassContainer', year);

            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('overallYearCount').textContent = calculateOverallCount(year);
            
            const currentStreak = calculateOverallCurrentStreak();
            document.getElementById('overallCurrentStreak').textContent = currentStreak;
            
            const maxStreak = calculateOverallMaxStreak(year);
            document.getElementById('overallMaxStreak').textContent = maxStreak;
        }

        function calculateOverallCurrentStreak() {
            const today = new Date();
            let streak = 0;
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                
                if (checkOverallAchievement(dateStr)) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function calculateOverallMaxStreak(year) {
            let maxStreak = 0;
            let currentStreak = 0;
            
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                
                if (checkOverallAchievement(dateStr)) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            }
            
            return maxStreak;
        }

        // ÌÜµÍ≥Ñ ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ
        function renderStats() {
            const year = parseInt(document.getElementById('statsYearSelect').value);
            
            document.getElementById('statsYearSelect').onchange = function() {
                renderStats();
            };

            // Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const activeHobbies = hobbies.filter(h => h.isActive);
            const yearRecords = records.filter(r => {
                const recordYear = parseInt(r.date.split('-')[0]);
                return recordYear === year;
            });

            const totalDays = Math.min(365, Math.floor((new Date() - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24)) + 1);
            const totalPossible = totalDays * activeHobbies.length;
            const totalAchieved = yearRecords.filter(r => r.achieved).length;
            const achievementRate = totalPossible > 0 ? Math.round((totalAchieved / totalPossible) * 100) : 0;

            const overallCount = calculateOverallCount(year);
            const overallRate = totalDays > 0 ? Math.round((overallCount / totalDays) * 100) : 0;

            // ÌÜµÍ≥Ñ Ïπ¥Îìú Î†åÎçîÎßÅ
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="stats-card">
                    <div class="stats-card-title">Ï†ÑÏ≤¥ Îã¨ÏÑ±Î•†</div>
                    <div class="stats-card-value">${achievementRate}%</div>
                    <div class="stats-card-label">${totalAchieved} / ${totalPossible}</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">ÏôÑÎ≤ΩÌïú ÌïòÎ£®</div>
                    <div class="stats-card-value">${overallCount}</div>
                    <div class="stats-card-label">Ï¥ù ${totalDays}Ïùº Ï§ë</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">Ï¢ÖÌï© Îã¨ÏÑ±Î•†</div>
                    <div class="stats-card-value">${overallRate}%</div>
                    <div class="stats-card-label">ÏôÑÎ≤ΩÌïú ÌïòÎ£® ÎπÑÏú®</div>
                </div>
            `;

            // Ï∑®ÎØ∏Î≥Ñ ÌÜµÍ≥Ñ
            const hobbyStatsContainer = document.getElementById('hobbyStatsContainer');
            hobbyStatsContainer.innerHTML = activeHobbies.map(hobby => {
                const hobbyRecords = yearRecords.filter(r => r.hobbyId === hobby.id);
                const achievedCount = hobbyRecords.filter(r => r.achieved).length;
                const rate = totalDays > 0 ? Math.round((achievedCount / totalDays) * 100) : 0;
                const currentStreak = calculateCurrentStreak(hobby.id);
                const maxStreak = calculateMaxStreak(hobby.id, year);

                return `
                    <div class="hobby-stat-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                        <div class="hobby-stat-name">
                            <span>${hobby.icon}</span>
                            <span>${hobby.name}</span>
                        </div>
                        <div style="text-align: right;">
                            <div class="hobby-stat-value">${rate}%</div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                                ÌòÑÏû¨ ${currentStreak}Ïùº ¬∑ ÏµúÏû• ${maxStreak}Ïùº
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            if (activeHobbies.length === 0) {
                hobbyStatsContainer.innerHTML = `
                    <div class="empty-state">
                        <p class="empty-text">ÌôúÏÑ± Ï∑®ÎØ∏Í∞Ä ÏóÜÏäµÎãàÎã§</p>
                    </div>
                `;
            }
        }

        // Firebase Ïù∏Ï¶ù ÏÉÅÌÉú Í∞êÏßÄ ÏÑ§Ï†ï
        function setupAuthStateListener() {
            if (!window.firebaseAuth || !window.firebaseAuthFunctions) {
                // FirebaseÍ∞Ä ÏïÑÏßÅ Î°úÎìúÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ Ïû¨ÏãúÎèÑ
                setTimeout(setupAuthStateListener, 100);
                return;
            }

            const { onAuthStateChanged } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    // ÏÇ¨Ïö©ÏûêÍ∞Ä Î°úÍ∑∏Ïù∏Îêú ÏÉÅÌÉú
                    console.log('Ïù∏Ï¶ù ÏÉÅÌÉú: Î°úÍ∑∏Ïù∏Îê®', user.email);
                    await handleAuthSuccess(user, false);
                } else {
                    // ÏÇ¨Ïö©ÏûêÍ∞Ä Î°úÍ∑∏ÏïÑÏõÉÎêú ÏÉÅÌÉú
                    console.log('Ïù∏Ï¶ù ÏÉÅÌÉú: Î°úÍ∑∏ÏïÑÏõÉÎê®');
                    currentUser = null;
                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('loginPage').style.display = 'flex';
                }
            });
        }

        // Ï¥àÍ∏∞ Î°úÎìú
        window.addEventListener('load', function() {
            initTheme();

            // Firebase Ïù∏Ï¶ù ÏÉÅÌÉú Í∞êÏßÄ ÏãúÏûë
            setupAuthStateListener();
        });
    </script>
</body>
</html>