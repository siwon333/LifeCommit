<!DOCTYPE html>
<html lang="ko">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6296484832176167"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Commit - 당신의 하루를 커밋하세요</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, setPersistence, browserLocalPersistence, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDKvoBQBwaIn99IDNrH7mxCgE-NA6H7Upo",
            authDomain: "life-commit-dfa88.firebaseapp.com",
            projectId: "life-commit-dfa88",
            storageBucket: "life-commit-dfa88.firebasestorage.app",
            messagingSenderId: "29344205499",
            appId: "1:29344205499:web:e0bad9bfe3fa606c37779e",
            measurementId: "G-MTLKM3PW7F"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        await setPersistence(auth, browserLocalPersistence);
        const db = getFirestore(app);

        // 전역으로 Firebase 객체 노출
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthFunctions = { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail };
        window.firebaseDbFunctions = { doc, setDoc, getDoc, collection, query, where, getDocs, addDoc, updateDoc, deleteDoc };
    </script>

    <style>
        :root {
            --grass-empty: #1a1f2e;
            --grass-level-1: #0e4429;
            --grass-level-2: #006d32;
            --grass-level-3: #26a641;
            --grass-level-4: #39d353;
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border: #30363d;
            --accent: #58a6ff;
            --accent-hover: #79c0ff;
            --success: #3fb950;
            --warning: #d29922;
            --danger: #f85149;
        }

        [data-theme="light"] {
            --grass-empty: #ebedf0;
            --grass-level-1: #9be9a8;
            --grass-level-2: #40c463;
            --grass-level-3: #30a14e;
            --grass-level-4: #216e39;
            --bg-primary: #ffffff;
            --bg-secondary: #f6f8fa;
            --bg-tertiary: #eaeef2;
            --text-primary: #1f2328;
            --text-secondary: #656d76;
            --text-muted: #8c959f;
            --border: #d0d7de;
            --accent: #0969da;
            --accent-hover: #0550ae;
            --success: #1a7f37;
            --warning: #bf8700;
            --danger: #cf222e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app {
            display: flex;
            min-height: 100vh;
        }

        /* 사이드바 */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 24px 0 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .sidebar nav {
            flex: 1;
        }

        .logo {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .logo h1 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: opacity 0.2s;
        }

        .logo h1:hover {
            opacity: 0.8;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: var(--success);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .nav-menu {
            list-style: none;
            padding: 0 12px;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 14px;
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-section {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent), var(--success));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .logout-btn {
            width: 100%;
            padding: 8px;
            background: transparent;
            color: var(--danger);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: rgba(248, 81, 73, 0.1);
            border-color: var(--danger);
        }

        .theme-toggle-btn {
            width: 100%;
            padding: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            font-family: inherit;
        }

        .theme-toggle-btn:hover {
            background: var(--border);
        }

        .theme-icon {
            font-size: 16px;
        }

        /* 메인 컨텐츠 */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 32px 48px;
            max-width: 1400px;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 헤더 */
        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 15px;
        }

        /* 대시보드 */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .today-info h2 {
            font-size: 24px;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .today-date {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(var(--success) 0%, var(--grass-empty) 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .progress-inner {
            width: 64px;
            height: 64px;
            background: var(--bg-secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .progress-text {
            font-size: 20px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .progress-label {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* 취미 카드 그리드 */
        .hobby-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .hobby-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .hobby-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .hobby-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .hobby-info {
            flex: 1;
        }

        .hobby-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-icon {
            font-size: 20px;
        }

        .hobby-target {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .hobby-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-pending {
            background: rgba(139, 148, 158, 0.15);
            color: var(--text-secondary);
        }

        .status-completed {
            background: rgba(63, 185, 80, 0.15);
            color: var(--success);
        }

        .status-exceeded {
            background: rgba(210, 153, 34, 0.15);
            color: var(--warning);
        }

        .hobby-action {
            margin-top: 16px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* 위젯 그리드 */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .widget {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .widget-title {
            font-size: 16px;
            font-weight: 600;
        }

        .widget-action {
            color: var(--accent);
            font-size: 13px;
            text-decoration: none;
            cursor: pointer;
        }

        .widget-action:hover {
            text-decoration: underline;
        }

        /* 미니 잔디 */
        .mini-grass {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
        }

        .mini-grass-week {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .grass-cell {
            width: 12px;
            height: 12px;
            background: var(--grass-empty);
            border-radius: 2px;
            transition: all 0.2s;
        }

        .grass-cell.level-1 {
            background: var(--grass-level-1);
        }

        .grass-cell.level-2 {
            background: var(--grass-level-2);
        }

        .grass-cell.level-3 {
            background: var(--grass-level-3);
        }

        .grass-cell.level-4 {
            background: var(--grass-level-4);
        }

        .grass-cell:hover {
            transform: scale(1.2);
            border: 1px solid var(--accent);
        }

        .overall-count {
            margin-top: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
        }

        /* 통계 카드 */
        .stat-card {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
        }

        /* 잔디밭 전체 뷰 */
        .grass-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .grass-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .year-selector {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
        }

        .grass-graph {
            overflow-x: auto;
            padding-bottom: 16px;
        }

        .grass-grid {
            display: inline-flex;
            gap: 3px;
        }

        .grass-column {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .grass-cell-full {
            width: 14px;
            height: 14px;
            background: var(--grass-empty);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
        }

        .grass-cell-full:hover {
            transform: scale(1.3);
            z-index: 10;
            box-shadow: 0 0 0 2px var(--accent);
        }

        .grass-cell-full.level-1 {
            background: var(--grass-level-1);
        }

        .grass-cell-full.level-2 {
            background: var(--grass-level-2);
        }

        .grass-cell-full.level-3 {
            background: var(--grass-level-3);
        }

        .grass-cell-full.level-4 {
            background: var(--grass-level-4);
        }

        .grass-legend {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .grass-legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .month-labels {
            display: flex;
            gap: 3px;
            margin-bottom: 8px;
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        /* 모달 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.2s ease-in;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 12px;
        }

        .radio-group {
            display: flex;
            gap: 12px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
        }

        .radio-label:hover {
            border-color: var(--accent);
        }

        .radio-label input[type="radio"] {
            margin: 0;
        }

        .radio-label input[type="radio"]:checked + span {
            font-weight: 600;
        }

        .radio-label:has(input:checked) {
            background: rgba(88, 166, 255, 0.1);
            border-color: var(--accent);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* 취미 목록 */
        .hobby-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hobby-list-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .hobby-list-item:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .hobby-list-info {
            flex: 1;
        }

        .hobby-list-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-list-meta {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .hobby-list-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .btn-icon:hover {
            background: var(--border);
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: var(--success);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        /* 빈 상태 */
        .empty-state {
            text-align: center;
            padding: 64px 32px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-text {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* 로그인 페이지 */
        /* ===== 랜딩 페이지 ===== */
        .landing-page {
            min-height: 100vh;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .landing-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 40px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .landing-nav-logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            color: var(--success);
            text-decoration: none;
        }

        .landing-nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .landing-nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s;
        }

        .landing-nav-links a:hover {
            color: var(--accent);
        }

        .landing-hero {
            max-width: 760px;
            margin: 0 auto;
            padding: 80px 40px 64px;
            text-align: center;
        }

        .landing-content {
            width: 100%;
        }

        /* CTA 버튼 그룹 */
        .landing-cta-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin: 32px 0 40px;
        }

        .landing-cta-btn {
            padding: 14px 32px;
            font-size: 16px;
            font-weight: 700;
            border-radius: 10px;
        }

        .landing-ghost-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 13px 24px;
            font-size: 14px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .landing-ghost-btn:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        /* 인증 모달 닫기 버튼 */
        .auth-modal-close {
            position: absolute;
            top: 16px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
            line-height: 1;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .auth-modal-close:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        /* 모달 내 login-box */
        .auth-modal-box {
            position: relative;
            max-width: 440px;
            width: 100%;
            flex-shrink: 0;
        }

        .landing-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(63, 185, 80, 0.1);
            border: 1px solid rgba(63, 185, 80, 0.3);
            color: var(--success);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .landing-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 48px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
            margin-bottom: 16px;
        }

        .landing-title .highlight {
            color: var(--success);
        }

        .landing-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .landing-features {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 40px;
        }

        .landing-feature-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        .landing-feature-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .landing-feature-text h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .landing-feature-text p {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .landing-grass-preview {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-bottom: 40px;
            padding: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        .landing-grass-row {
            display: flex;
            gap: 3px;
        }

        .landing-grass-cell {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
            padding: 24px;
        }

        .login-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 48px;
            max-width: 440px;
            width: 100%;
            flex-shrink: 0;
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 32px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 12px;
        }

        .login-tagline {
            color: var(--text-secondary);
            font-size: 15px;
        }

        /* 소개 섹션 */
        .landing-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 64px 40px;
            border-top: 1px solid var(--border);
        }

        .landing-section-title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 12px;
        }

        .landing-section-subtitle {
            text-align: center;
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 48px;
        }

        .how-it-works-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
        }

        .how-step {
            text-align: center;
            padding: 32px 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .how-step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--accent);
            color: white;
            font-weight: 700;
            border-radius: 50%;
            font-size: 16px;
            margin-bottom: 16px;
        }

        .how-step-icon {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
        }

        .how-step h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .how-step p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .benefit-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .benefit-item {
            display: flex;
            gap: 16px;
            padding: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .benefit-icon {
            font-size: 28px;
            flex-shrink: 0;
        }

        .benefit-item h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .benefit-item p {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .faq-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-width: 720px;
            margin: 0 auto;
        }

        .faq-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 24px;
        }

        .faq-question {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .faq-answer {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .landing-footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            padding: 40px;
            text-align: center;
        }

        .landing-footer-links {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 16px;
        }

        .landing-footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s;
        }

        .landing-footer-links a:hover {
            color: var(--accent);
        }

        .landing-footer-copy {
            color: var(--text-muted);
            font-size: 13px;
        }

        /* 게스트 시작 버튼 */
        .guest-start-btn {
            display: block;
            width: 100%;
            margin-top: 16px;
            padding: 10px;
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .guest-start-btn:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        /* 게스트 모드 배너 */
        .guest-banner {
            display: none;
            align-items: center;
            gap: 12px;
            background: rgba(210, 153, 34, 0.1);
            border-bottom: 1px solid rgba(210, 153, 34, 0.3);
            padding: 10px 24px;
            font-size: 13px;
            color: var(--warning);
            flex-shrink: 0;
        }

        .guest-banner-text {
            flex: 1;
        }

        .guest-banner-login-btn {
            background: var(--warning);
            color: #0d1117;
            border: none;
            border-radius: 6px;
            padding: 6px 14px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            transition: opacity 0.2s;
        }

        .guest-banner-login-btn:hover { opacity: 0.85; }

        .guest-banner-dismiss {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
            line-height: 1;
        }

        .guest-banner-dismiss:hover { color: var(--text-secondary); }

        /* 로그인 유도 팝업 */
        #loginPromptModal .modal-content {
            max-width: 420px;
            text-align: center;
        }

        .login-prompt-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .login-prompt-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .login-prompt-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 24px;
        }

        .login-prompt-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .login-prompt-primary-btn {
            background: var(--success);
            color: #0d1117;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .login-prompt-primary-btn:hover { opacity: 0.85; }

        .login-prompt-skip-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 8px;
            padding: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .login-prompt-skip-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* 데이터 마이그레이션 배너 */
        .migrate-banner {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 10px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
        }

        .migrate-banner-text {
            flex: 1;
            color: var(--text-secondary);
        }

        .migrate-banner-text strong {
            color: var(--accent);
            display: block;
            margin-bottom: 4px;
        }

        .migrate-yes-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 14px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .migrate-no-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
        }

        @media (max-width: 900px) {
            .landing-hero {
                padding: 48px 24px 40px;
            }
            .landing-features {
                grid-template-columns: 1fr;
            }
            .landing-nav {
                padding: 16px 24px;
            }
            .landing-nav-links {
                gap: 16px;
            }
            .landing-title {
                font-size: 32px;
            }
            .landing-section {
                padding: 48px 24px;
            }
            .landing-cta-group {
                flex-direction: column;
                align-items: center;
            }
            .landing-cta-btn,
            .landing-ghost-btn {
                width: 100%;
                max-width: 320px;
            }
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-actions {
            margin-top: 24px;
        }

        .login-footer {
            text-align: center;
            margin-top: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .login-footer a {
            color: var(--accent);
            text-decoration: none;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        .auth-error {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            text-align: center;
        }

        .auth-loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .auth-success {
            background: rgba(63, 185, 80, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            text-align: center;
        }

        .forgot-password {
            text-align: center;
            margin-top: 16px;
        }

        .forgot-password a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
        }

        .forgot-password a:hover {
            color: var(--accent);
            text-decoration: underline;
        }

        /* 통계 페이지 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stats-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .stats-card-title {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stats-card-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 36px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 8px;
        }

        .stats-card-label {
            color: var(--text-muted);
            font-size: 12px;
        }

        .hobby-stats-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .hobby-stat-item {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .hobby-stat-item:hover {
            background: var(--border);
            transform: translateX(4px);
        }

        .hobby-stat-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hobby-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--success);
        }

        /* 모바일 메뉴 버튼 */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 98;
            width: 44px;
            height: 44px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 80px 16px 24px 16px;
            }

            .hobby-grid {
                grid-template-columns: 1fr;
            }

            .widgets-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .grass-grid {
                overflow-x: auto;
                padding-bottom: 8px;
            }

            .hobby-card {
                padding: 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 툴팁 */
        .tooltip {
            position: fixed;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 2000;
            display: none;
            white-space: nowrap;
        }

        .tooltip.active {
            display: block;
        }

        /* 광고 영역 */
        .ad-sidebar {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
        }

        .ad-sidebar .ad-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            opacity: 0.6;
        }

        .ad-sidebar .ad-slot {
            background: var(--bg-tertiary);
            border: 1px dashed var(--border);
            border-radius: 8px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 13px;
            overflow: hidden;
        }

        .ad-footer {
            margin-top: 48px;
            padding: 24px 0;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        .ad-footer .ad-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            opacity: 0.6;
        }

        .ad-footer .ad-slot {
            background: var(--bg-secondary);
            border: 1px dashed var(--border);
            border-radius: 12px;
            min-height: 100px;
            max-width: 728px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 13px;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .ad-sidebar {
                display: none;
            }

            .ad-footer .ad-slot {
                min-height: 80px;
            }
        }

        /* 색상 선택기 */
        .color-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
        }

        /* 아이콘 선택기 */
        .icon-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .icon-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .icon-option:hover {
            transform: scale(1.1);
            background: var(--border);
        }

        .icon-option.selected {
            border-color: var(--accent);
            background: rgba(88, 166, 255, 0.1);
        }

        .record-display {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .record-date {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .record-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 4px;
        }

        .record-memo {
            color: var(--text-secondary);
            font-size: 14px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- 로그인 페이지 -->
    <div id="loginPage" class="landing-page">
        <!-- 상단 내비게이션 -->
        <nav class="landing-nav">
            <a href="index.html" class="landing-nav-logo">🌱 Life Commit</a>
            <div class="landing-nav-links">
                <a href="about.html">서비스 소개</a>
                <a href="guide.html">사용 가이드</a>
                <a href="privacy-policy.html">개인정보처리방침</a>
            </div>
        </nav>

        <!-- 히어로 섹션 (중앙 정렬) -->
        <div class="landing-hero">
            <div class="landing-content">
                <div class="landing-badge">✨ GitHub 잔디밭 스타일 습관 트래커</div>
                <h1 class="landing-title">
                    당신의 하루를<br><span class="highlight">커밋하세요</span>
                </h1>
                <p class="landing-subtitle">
                    매일의 작은 성취를 "커밋"으로 기록하고, 연간 달성 패턴을 한눈에 시각화하세요.
                    꾸준함이 쌓여 만들어지는 초록빛 잔디를 함께 만들어 보세요.
                </p>
                <div class="landing-cta-group">
                    <button class="btn btn-primary landing-cta-btn" id="openAuthModalBtn">🚀 시작하기 / 로그인</button>
                    <button class="landing-ghost-btn" id="heroGuestBtn">🔓 로그인 없이 체험하기</button>
                </div>
                <div style="font-size:12px; color: var(--text-muted);">
                    <strong style="color:var(--success);">🟢</strong> 현재 무료로 사용할 수 있습니다 &nbsp;·&nbsp;
                    <a href="guide.html" style="color:var(--accent); text-decoration:none;">사용 방법 보기 →</a>
                </div>
                <div class="landing-features">
                    <div class="landing-feature-item">
                        <div class="landing-feature-icon">🌱</div>
                        <div class="landing-feature-text">
                            <h4>GitHub 스타일 잔디밭</h4>
                            <p>연간 365일 달성 현황을 잔디밭 그래프로 시각화합니다.</p>
                        </div>
                    </div>
                    <div class="landing-feature-item">
                        <div class="landing-feature-icon">🎯</div>
                        <div class="landing-feature-text">
                            <h4>수치형 &amp; 완료형 목표</h4>
                            <p>운동 시간, 독서 페이지 등 수치 목표와 단순 완료 체크를 모두 지원합니다.</p>
                        </div>
                    </div>
                    <div class="landing-feature-item">
                        <div class="landing-feature-icon">📊</div>
                        <div class="landing-feature-text">
                            <h4>상세한 통계 분석</h4>
                            <p>달성률, 연속 기록(스트릭), 취미별 통계를 한눈에 확인하세요.</p>
                        </div>
                    </div>
                    <div class="landing-feature-item">
                        <div class="landing-feature-icon">🌙</div>
                        <div class="landing-feature-text">
                            <h4>다크 / 라이트 테마</h4>
                            <p>눈에 편한 다크모드와 밝은 라이트모드를 자유롭게 전환하세요.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 로그인 / 회원가입 모달 -->
        <div id="authModal" class="modal" style="display: none;">
            <div class="modal-content login-box auth-modal-box">
                <button class="auth-modal-close" id="closeAuthModalBtn" type="button">✕</button>
                <div class="login-header">
                    <div class="login-logo">🌱 Life Commit</div>
                    <div class="login-tagline">당신의 하루를 커밋하세요</div>
                </div>
                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <label class="form-label">이메일</label>
                        <input type="email" class="form-input" id="authEmail" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">비밀번호</label>
                        <input type="password" class="form-input" id="authPassword" placeholder="••••••••" required minlength="6">
                    </div>
                    <div id="authError" class="auth-error" style="display: none;"></div>
                    <div id="authSuccess" class="auth-success" style="display: none;"></div>
                    <div class="login-actions">
                        <button type="submit" class="btn btn-primary" id="authSubmitBtn">로그인</button>
                    </div>
                    <div class="forgot-password">
                        <a href="#" id="forgotPasswordLink">비밀번호를 잊으셨나요?</a>
                    </div>
                </form>
                <div class="login-footer">
                    <span id="authToggleText">계정이 없으신가요?</span> <a href="#" id="authToggleLink">회원가입</a>
                </div>
                <button class="guest-start-btn" id="guestStartBtn">
                    🔓 로그인 없이 체험하기 (기기에 저장)
                </button>
            </div>
        </div>

        <!-- 이용 방법 섹션 -->
        <section class="landing-section">
            <h2 class="landing-section-title">어떻게 사용하나요?</h2>
            <p class="landing-section-subtitle">3단계로 시작하는 나만의 습관 트래커</p>
            <div class="how-it-works-grid">
                <div class="how-step">
                    <span class="how-step-number">1</span>
                    <span class="how-step-icon">✍️</span>
                    <h3>습관 목표 설정</h3>
                    <p>운동, 독서, 명상 등 원하는 습관을 추가하고 목표 수치(시간, 횟수, 페이지 등)를 설정하세요.</p>
                </div>
                <div class="how-step">
                    <span class="how-step-number">2</span>
                    <span class="how-step-icon">✅</span>
                    <h3>매일 기록</h3>
                    <p>오늘의 달성 현황을 클릭 한 번으로 체크하거나 수치를 입력하세요. 간단할수록 꾸준히 할 수 있습니다.</p>
                </div>
                <div class="how-step">
                    <span class="how-step-number">3</span>
                    <span class="how-step-icon">🌱</span>
                    <h3>잔디 성장 확인</h3>
                    <p>매일 채워지는 잔디밭과 통계를 통해 성취감을 느끼고 꾸준함을 유지하세요.</p>
                </div>
                <div class="how-step">
                    <span class="how-step-number">4</span>
                    <span class="how-step-icon">📈</span>
                    <h3>성과 분석</h3>
                    <p>연간 달성률, 최장 연속 기록, 취미별 통계로 자신의 성장을 데이터로 확인하세요.</p>
                </div>
            </div>
        </section>

        <!-- 장점 섹션 -->
        <section class="landing-section">
            <h2 class="landing-section-title">왜 Life Commit인가요?</h2>
            <p class="landing-section-subtitle">습관 형성을 위해 설계된 스마트한 도구</p>
            <div class="benefit-list">
                <div class="benefit-item">
                    <div class="benefit-icon">🎨</div>
                    <div>
                        <h3>시각적 동기 부여</h3>
                        <p>GitHub 개발자들이 잔디밭을 채우며 느끼는 성취감을 일상 습관에도 적용했습니다. 초록색 잔디가 채워질수록 더 하고 싶어집니다.</p>
                    </div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">⚡</div>
                    <div>
                        <h3>빠른 기록</h3>
                        <p>복잡한 절차 없이 클릭 한 번으로 완료 체크. 수치형 목표도 숫자 입력 하나로 끝납니다. 기록하는 데 30초도 안 걸립니다.</p>
                    </div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">🔒</div>
                    <div>
                        <h3>안전한 데이터</h3>
                        <p>Firebase를 통해 클라우드에 안전하게 저장됩니다. 어디서든 로그인하면 내 기록을 확인할 수 있습니다.</p>
                    </div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">📱</div>
                    <div>
                        <h3>반응형 디자인</h3>
                        <p>PC와 모바일 모두에서 편리하게 사용할 수 있도록 반응형으로 설계되었습니다.</p>
                    </div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">🆓</div>
                    <div>
                        <h3>완전 무료</h3>
                        <p>모든 기능을 무료로 이용할 수 있습니다. 숨겨진 비용이나 제한 없이 원하는 만큼 습관을 추가하고 기록하세요.</p>
                    </div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">🌓</div>
                    <div>
                        <h3>다크 / 라이트 테마</h3>
                        <p>눈의 피로를 줄여주는 다크 모드와 밝은 라이트 모드를 지원합니다. 언제든 취향에 맞게 전환하세요.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ 섹션 -->
        <section class="landing-section">
            <h2 class="landing-section-title">자주 묻는 질문</h2>
            <p class="landing-section-subtitle">궁금한 점이 있으신가요?</p>
            <div class="faq-list">
                <div class="faq-item">
                    <div class="faq-question">Q. Life Commit은 무료인가요?</div>
                    <div class="faq-answer">네, Life Commit은 완전 무료 서비스입니다. 회원가입 후 모든 기능을 제한 없이 이용할 수 있습니다.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Q. 습관(취미)은 몇 개까지 추가할 수 있나요?</div>
                    <div class="faq-answer">제한 없이 원하는 만큼 습관을 추가할 수 있습니다. 운동, 독서, 명상, 언어 학습 등 다양한 목표를 자유롭게 설정하세요.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Q. 수치형과 완료형의 차이는 무엇인가요?</div>
                    <div class="faq-answer">수치형은 "30분 운동", "50페이지 독서"처럼 달성 수치를 입력하는 방식입니다. 목표 수치 이상 달성하면 완료로 처리됩니다. 완료형은 명상, 일기 쓰기처럼 했는지 안 했는지만 체크하는 방식입니다.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Q. Overall 잔디밭은 무엇인가요?</div>
                    <div class="faq-answer">모든 활성 습관을 하루에 전부 달성했을 때만 Overall 잔디에 커밋이 기록됩니다. 완벽한 하루를 만들었을 때의 성취감을 더욱 특별하게 느낄 수 있습니다.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Q. 데이터는 어디에 저장되나요?</div>
                    <div class="faq-answer">모든 데이터는 Google Firebase 클라우드에 안전하게 저장됩니다. 기기가 바뀌어도 로그인하면 동일한 데이터를 확인할 수 있습니다.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Q. 모바일에서도 사용할 수 있나요?</div>
                    <div class="faq-answer">네, Life Commit은 반응형으로 설계되어 스마트폰과 태블릿에서도 편리하게 이용할 수 있습니다.</div>
                </div>
            </div>
        </section>

        <!-- 푸터 -->
        <footer class="landing-footer">
            <div class="landing-footer-links">
                <a href="about.html">서비스 소개</a>
                <a href="guide.html">사용 가이드</a>
                <a href="privacy-policy.html">개인정보처리방침</a>
            </div>
            <div class="landing-footer-copy">© 2026 Life Commit. 당신의 하루를 커밋하세요.</div>
        </footer>
    </div>

    <!-- 메인 앱 -->
    <div id="mainApp" class="app" style="display: none;">
        <!-- 모바일 메뉴 버튼 -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>
        <div class="mobile-overlay" id="mobileOverlay"></div>

        <!-- 사이드바 -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <h1 style="cursor: pointer;" onclick="navigateTo('dashboard')">
                    <span class="logo-icon">🌱</span>
                    Life Commit
                </h1>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a class="nav-link active" data-page="dashboard">
                            <span class="nav-icon">📊</span>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="overall">
                            <span class="nav-icon">🏆</span>
                            Overall
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="stats">
                            <span class="nav-icon">📈</span>
                            Stats
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="hobbies">
                            <span class="nav-icon">⚙️</span>
                            Hobbies
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="ad-sidebar" id="sidebarAd">
                <div class="ad-label">Sponsored</div>
                <div class="ad-slot">
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6296484832176167"crossorigin="anonymous"></script>
                </div>
            </div>
            <div class="user-section">
                <div class="user-info">
                    <div class="user-avatar">U</div>
                    <div class="user-name" id="userName">사용자</div>
                </div>
                <button class="theme-toggle-btn" id="themeToggle">
                    <span class="theme-icon">🌙</span>
                    <span class="theme-text">다크 모드</span>
                </button>
                <button class="logout-btn" id="logoutBtn">로그아웃</button>
            </div>
        </aside>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <!-- 게스트 모드 배너 -->
            <div class="guest-banner" id="guestBanner">
                <span class="guest-banner-text">⚠️ 게스트 모드 — 데이터가 이 기기에만 저장됩니다. 로그인하면 어디서든 확인할 수 있습니다.</span>
                <button class="guest-banner-login-btn" id="guestBannerLoginBtn">로그인 / 회원가입</button>
                <button class="guest-banner-dismiss" id="guestBannerDismiss" title="닫기">✕</button>
            </div>

            <!-- 마이그레이션 배너 (동적으로 표시) -->
            <div id="migrateBanner" style="display:none; padding: 0 24px; margin-top: 16px;"></div>

            <!-- 대시보드 페이지 -->
            <div id="dashboardPage" class="page active">
                <div class="dashboard-header">
                    <div class="today-info">
                        <h2 id="todayDate">2026년 1월 30일 금요일</h2>
                        <div class="today-date">오늘의 목표를 완료하세요</div>
                    </div>
                    <div class="progress-circle" id="todayProgress">
                        <div class="progress-inner">
                            <div class="progress-text">0/0</div>
                            <div class="progress-label">완료</div>
                        </div>
                    </div>
                </div>

                <div id="hobbyCardsContainer" class="hobby-grid">
                    <!-- 취미 카드들이 동적으로 생성됩니다 -->
                </div>

                <!-- Overall 잔디밭 섹션 -->
                <div style="margin-top: 48px;">
                    <div class="page-header" style="margin-bottom: 24px;">
                        <h2 class="page-title" style="font-size: 24px;">Overall 잔디밭</h2>
                        <p class="page-subtitle">모든 목표를 달성한 완벽한 하루들</p>
                    </div>
                    <div class="grass-container">
                        <div class="grass-header">
                            <h3>연간 종합 달성</h3>
                            <select class="year-selector" id="dashboardOverallYearSelect">
                                <option value="2026">2026</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                        <div id="dashboardOverallGrassContainer"></div>
                    </div>
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stats-card">
                            <div class="stats-card-title">올해 완벽한 하루</div>
                            <div class="stats-card-value" id="dashboardOverallYearCount">0</div>
                            <div class="stats-card-label">일</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-title">현재 연속 기록</div>
                            <div class="stats-card-value" id="dashboardOverallCurrentStreak">0</div>
                            <div class="stats-card-label">일</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-title">최장 연속 기록</div>
                            <div class="stats-card-value" id="dashboardOverallMaxStreak">0</div>
                            <div class="stats-card-label">일</div>
                        </div>
                    </div>
                </div>

                <!-- 통계 섹션 -->
                <div style="margin-top: 48px;">
                    <div class="page-header" style="margin-bottom: 24px;">
                        <h2 class="page-title" style="font-size: 24px;">통계</h2>
                        <p class="page-subtitle">당신의 성취를 확인하세요</p>
                    </div>
                    <div style="margin-bottom: 24px;">
                        <select class="year-selector" id="dashboardStatsYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div class="stats-grid" id="dashboardStatsContainer">
                        <!-- 통계 카드들 -->
                    </div>
                    <div class="grass-container" style="margin-top: 24px;">
                        <h3 style="margin-bottom: 24px;">취미별 달성률</h3>
                        <div class="hobby-stats-list" id="dashboardHobbyStatsContainer">
                            <!-- 취미별 통계 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 취미 관리 페이지 -->
            <div id="hobbiesPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">취미 관리</h1>
                    <p class="page-subtitle">습관과 목표를 관리하세요</p>
                </div>
                <div style="margin-bottom: 24px;">
                    <button class="btn btn-primary" id="newHobbyBtn">+ 새 취미 추가</button>
                </div>
                <div id="hobbyListContainer" class="hobby-list">
                    <!-- 취미 목록 -->
                </div>
            </div>

            <!-- Overall 페이지 -->
            <div id="overallPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">Overall 잔디밭</h1>
                    <p class="page-subtitle">모든 목표를 달성한 완벽한 하루들</p>
                </div>
                <div class="grass-container">
                    <div class="grass-header">
                        <h3>연간 종합 달성</h3>
                        <select class="year-selector" id="overallYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div id="overallGrassContainer"></div>
                </div>
                <div class="stats-grid">
                    <div class="stats-card">
                        <div class="stats-card-title">올해 완벽한 하루</div>
                        <div class="stats-card-value" id="overallYearCount">0</div>
                        <div class="stats-card-label">일</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-title">현재 연속 기록</div>
                        <div class="stats-card-value" id="overallCurrentStreak">0</div>
                        <div class="stats-card-label">일</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-card-title">최장 연속 기록</div>
                        <div class="stats-card-value" id="overallMaxStreak">0</div>
                        <div class="stats-card-label">일</div>
                    </div>
                </div>
            </div>

            <!-- 통계 페이지 -->
            <div id="statsPage" class="page">
                <div class="page-header">
                    <h1 class="page-title">통계</h1>
                    <p class="page-subtitle">당신의 성취를 확인하세요</p>
                </div>
                <div style="margin-bottom: 24px;">
                    <select class="year-selector" id="statsYearSelect">
                        <option value="2026">2026</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
                <div class="stats-grid" id="statsContainer">
                    <!-- 통계 카드들 -->
                </div>
                <div class="grass-container">
                    <h3 style="margin-bottom: 24px;">취미별 달성률</h3>
                    <div class="hobby-stats-list" id="hobbyStatsContainer">
                        <!-- 취미별 통계 -->
                    </div>
                </div>
            </div>

            <!-- 취미 상세 페이지 -->
            <div id="hobbyDetailPage" class="page">
                <div class="page-header">
                    <h1 class="page-title" id="hobbyDetailTitle">취미 상세</h1>
                    <p class="page-subtitle" id="hobbyDetailSubtitle"></p>
                </div>
                <div class="grass-container">
                    <div class="grass-header">
                        <h3 id="hobbyDetailName">잔디밭</h3>
                        <select class="year-selector" id="hobbyDetailYearSelect">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                    <div id="hobbyDetailGrassContainer"></div>
                </div>
                <div style="margin-top: 24px;">
                    <button class="btn btn-secondary" id="backToDashboard">← 대시보드로 돌아가기</button>
                </div>
            </div>
            <!-- 페이지 하단 광고 -->
            <div class="ad-footer" id="footerAd">
                <div class="ad-label">Sponsored</div>
                <div class="ad-slot">
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6296484832176167"
     crossorigin="anonymous"></script>
                </div>
            </div>
        </main>
    </div>

    <!-- 기록 모달 -->
    <div id="recordModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeRecordModal()">×</button>
            <div class="modal-header">
                <h2 class="modal-title" id="recordModalTitle">오늘 기록하기</h2>
                <div class="modal-subtitle" id="recordModalSubtitle"></div>
            </div>
            <form id="recordForm">
                <div id="recordFormContent">
                    <!-- 동적으로 생성 -->
                </div>
                <div class="form-group">
                    <label class="form-label">메모 (선택)</label>
                    <textarea class="form-textarea" id="recordMemo" placeholder="오늘의 소감을 남겨보세요..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeRecordModal()">취소</button>
                    <button type="submit" class="btn btn-success">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 취미 생성/수정 모달 -->
    <div id="hobbyModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeHobbyModal()">×</button>
            <div class="modal-header">
                <h2 class="modal-title" id="hobbyModalTitle">새 취미 추가</h2>
                <div class="modal-subtitle">꾸준히 실천할 습관을 만들어보세요</div>
            </div>
            <form id="hobbyForm">
                <div class="form-group">
                    <label class="form-label">취미명 *</label>
                    <input type="text" class="form-input" id="hobbyName" placeholder="예: 운동, 독서, 영단어" required maxlength="20">
                </div>
                <div class="form-group">
                    <label class="form-label">타입 *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="hobbyType" value="quant" checked>
                            <span>수치형</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="hobbyType" value="binary">
                            <span>완료형</span>
                        </label>
                    </div>
                </div>
                <div id="quantFields">
                    <div class="form-group">
                        <label class="form-label">목표</label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="targetValue" placeholder="30" min="1" required>
                            <select class="form-select" id="targetUnit" required>
                                <option value="분">분</option>
                                <option value="개">개</option>
                                <option value="회">회</option>
                                <option value="페이지">페이지</option>
                                <option value="km">km</option>
                                <option value="잔">잔</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="binaryFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">목표 설명 (선택)</label>
                        <input type="text" class="form-input" id="binaryDesc" placeholder="예: 30분 이상 독서하기">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">아이콘</label>
                    <div class="icon-picker" id="iconPicker">
                        <div class="icon-option selected" data-icon="💪">💪</div>
                        <div class="icon-option" data-icon="📚">📚</div>
                        <div class="icon-option" data-icon="✍️">✍️</div>
                        <div class="icon-option" data-icon="🏃">🏃</div>
                        <div class="icon-option" data-icon="🧘">🧘</div>
                        <div class="icon-option" data-icon="🎨">🎨</div>
                        <div class="icon-option" data-icon="🎵">🎵</div>
                        <div class="icon-option" data-icon="🎮">🎮</div>
                        <div class="icon-option" data-icon="💻">💻</div>
                        <div class="icon-option" data-icon="🌿">🌿</div>
                        <div class="icon-option" data-icon="☕">☕</div>
                        <div class="icon-option" data-icon="🍎">🍎</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeHobbyModal()">취소</button>
                    <button type="submit" class="btn btn-success">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 로그인 유도 팝업 -->
    <div id="loginPromptModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="login-prompt-icon">🌱</div>
            <div class="login-prompt-title">기록을 안전하게 보관하세요</div>
            <div class="login-prompt-desc">
                현재 게스트 모드로 이 기기에만 저장되고 있습니다.<br>
                로그인하면 클라우드에 자동 동기화되어<br>
                어떤 기기에서도 내 잔디밭을 확인할 수 있어요.
            </div>
            <div class="login-prompt-actions">
                <button class="login-prompt-primary-btn" id="loginPromptLoginBtn">로그인 / 회원가입하기</button>
                <button class="login-prompt-skip-btn" id="loginPromptSkipBtn">괜찮아요, 계속 게스트로 사용할게요</button>
            </div>
        </div>
    </div>

    <!-- 툴팁 -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        // 전역 상태
        let currentUser = null;
        let hobbies = [];
        let records = [];
        let currentPage = 'dashboard';
        let selectedHobbyId = null;
        let isSignupMode = false;
        let isGuestMode = false;
        let guestPromptShown = false;

        // 색상 상수
        const COLORS = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'];

        // 날짜 유틸리티
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function parseDate(dateStr) {
            return new Date(dateStr + 'T00:00:00');
        }

        function getKoreanDate(date) {
            const days = ['일', '월', '화', '수', '목', '금', '토'];
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayOfWeek = days[date.getDay()];
            return `${year}년 ${month}월 ${day}일 ${dayOfWeek}요일`;
        }

        function getTodayString() {
            return formatDate(new Date());
        }

        // Firebase Firestore 유틸리티
        async function saveToFirestore() {
            if (!currentUser || !window.firebaseDb) return;

            const { doc, setDoc } = window.firebaseDbFunctions;
            const db = window.firebaseDb;

            try {
                // 유저 데이터 저장
                await setDoc(doc(db, 'users', currentUser.uid), {
                    email: currentUser.email,
                    name: currentUser.name,
                    updatedAt: new Date().toISOString()
                });

                // 취미 데이터 저장
                await setDoc(doc(db, 'users', currentUser.uid, 'data', 'hobbies'), {
                    items: hobbies
                });

                // 기록 데이터 저장
                await setDoc(doc(db, 'users', currentUser.uid, 'data', 'records'), {
                    items: records
                });

                console.log('Firestore에 저장 완료');
            } catch (error) {
                console.error('Firestore 저장 오류:', error);
                // 오프라인 백업으로 로컬스토리지도 사용
                saveToLocalStorage();
            }
        }

        async function loadFromFirestore() {
            if (!currentUser || !window.firebaseDb) return;

            const { doc, getDoc } = window.firebaseDbFunctions;
            const db = window.firebaseDb;

            try {
                // 취미 데이터 로드
                const hobbiesDoc = await getDoc(doc(db, 'users', currentUser.uid, 'data', 'hobbies'));
                if (hobbiesDoc.exists()) {
                    hobbies = hobbiesDoc.data().items || [];
                }

                // 기록 데이터 로드
                const recordsDoc = await getDoc(doc(db, 'users', currentUser.uid, 'data', 'records'));
                if (recordsDoc.exists()) {
                    records = recordsDoc.data().items || [];
                }

                console.log('Firestore에서 로드 완료');
            } catch (error) {
                console.error('Firestore 로드 오류:', error);
                // 오프라인 백업에서 로드 시도
                loadFromLocalStorage();
            }
        }

        // 로컬스토리지 백업 (오프라인 지원)
        function saveToLocalStorage() {
            localStorage.setItem('lifeCommitData', JSON.stringify({
                hobbies,
                records
            }));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('lifeCommitData');
            if (data) {
                const parsed = JSON.parse(data);
                hobbies = parsed.hobbies || [];
                records = parsed.records || [];
            }
        }

        // 저장 함수 (로컬 먼저 저장 후 Firestore 동기화)
        async function saveToStorage() {
            saveToLocalStorage();
            if (currentUser && window.firebaseDb) {
                await saveToFirestore();
            }
            // 게스트 모드에서 첫 저장 시 로그인 유도 팝업
            if (isGuestMode && !guestPromptShown) {
                guestPromptShown = true;
                setTimeout(() => showLoginPrompt(), 800);
            }
        }

        // 로드 함수 (Firestore 우선, 로컬 백업)
        async function loadFromStorage() {
            if (currentUser && window.firebaseDb) {
                await loadFromFirestore();
            } else {
                loadFromLocalStorage();
            }
        }

        // 테마 관리
        function initTheme() {
            const savedTheme = localStorage.getItem('lifeCommitTheme') || 'dark';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('lifeCommitTheme', theme);
            
            const themeIcon = document.querySelector('.theme-icon');
            const themeText = document.querySelector('.theme-text');
            
            if (themeIcon && themeText) {
                if (theme === 'light') {
                    themeIcon.textContent = '🌙';
                    themeText.textContent = '다크 모드';
                } else {
                    themeIcon.textContent = '☀️';
                    themeText.textContent = '라이트 모드';
                }
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        // UUID 생성
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // 에러 메시지 표시
        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function hideAuthError() {
            document.getElementById('authError').style.display = 'none';
        }

        // ===== 게스트 모드 =====

        // 게스트 모드 시작
        async function handleGuestMode() {
            isGuestMode = true;
            guestPromptShown = false;
            currentUser = null;
            localStorage.setItem('lifeCommitGuestMode', 'true');

            // 기존 로컬 데이터 로드 또는 초기 데이터 생성
            loadFromLocalStorage();
            if (hobbies.length === 0) {
                createInitialData();
                saveToLocalStorage();
            }

            // UI 전환
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            document.getElementById('guestBanner').style.display = 'flex';
            document.getElementById('userName').textContent = '게스트';
            document.getElementById('logoutBtn').textContent = '로그인하기';

            renderDashboard();
        }

        // 로그인 유도 팝업 표시
        function showLoginPrompt() {
            document.getElementById('loginPromptModal').style.display = 'flex';
        }

        // 로그인 유도 팝업 닫기
        function closeLoginPrompt() {
            document.getElementById('loginPromptModal').style.display = 'none';
        }

        // 게스트 → 로그인 페이지로 이동 (모달 자동 열기)
        function exitGuestModeToLogin() {
            closeLoginPrompt();
            // 마이그레이션 플래그 설정
            localStorage.setItem('lifeCommitPendingMigration', 'true');
            isGuestMode = false;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            // 로그인 모달 자동 열기
            document.getElementById('authModal').style.display = 'flex';
        }

        // 게스트 배너 버튼 이벤트
        document.getElementById('guestBannerLoginBtn').addEventListener('click', exitGuestModeToLogin);
        document.getElementById('guestBannerDismiss').addEventListener('click', function() {
            document.getElementById('guestBanner').style.display = 'none';
        });

        // 로그인 유도 팝업 버튼 이벤트
        document.getElementById('loginPromptLoginBtn').addEventListener('click', exitGuestModeToLogin);
        document.getElementById('loginPromptSkipBtn').addEventListener('click', closeLoginPrompt);

        // 인증 모달 열기/닫기
        document.getElementById('openAuthModalBtn').addEventListener('click', function() {
            document.getElementById('authModal').style.display = 'flex';
        });
        document.getElementById('closeAuthModalBtn').addEventListener('click', function() {
            document.getElementById('authModal').style.display = 'none';
        });
        document.getElementById('authModal').addEventListener('click', function(e) {
            if (e.target === this) this.style.display = 'none';
        });

        // 히어로 게스트 버튼 (모달 열지 않고 바로 게스트 진입)
        document.getElementById('heroGuestBtn').addEventListener('click', handleGuestMode);

        // 모달 내 게스트 시작 버튼
        document.getElementById('guestStartBtn').addEventListener('click', handleGuestMode);

        // ===== 게스트 모드 끝 =====

        function showAuthSuccess(message) {
            const successEl = document.getElementById('authSuccess');
            successEl.textContent = message;
            successEl.style.display = 'block';
        }

        function hideAuthSuccess() {
            document.getElementById('authSuccess').style.display = 'none';
        }

        // 비밀번호 재설정
        document.getElementById('forgotPasswordLink').addEventListener('click', async function(e) {
            e.preventDefault();
            hideAuthError();
            hideAuthSuccess();

            const email = document.getElementById('authEmail').value;

            if (!email) {
                showAuthError('이메일을 먼저 입력해주세요.');
                return;
            }

            if (!window.firebaseAuth || !window.firebaseAuthFunctions) {
                showAuthError('Firebase가 아직 로드되지 않았습니다.');
                return;
            }

            const { sendPasswordResetEmail } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            try {
                await sendPasswordResetEmail(auth, email);
                showAuthSuccess('비밀번호 재설정 이메일을 발송했습니다. 이메일을 확인해주세요.');
            } catch (error) {
                console.error('비밀번호 재설정 오류:', error);
                if (error.code === 'auth/user-not-found') {
                    showAuthError('등록되지 않은 이메일입니다.');
                } else if (error.code === 'auth/invalid-email') {
                    showAuthError('유효하지 않은 이메일 형식입니다.');
                } else {
                    showAuthError('이메일 발송에 실패했습니다. 다시 시도해주세요.');
                }
            }
        });

        // 회원가입/로그인 토글
        document.getElementById('authToggleLink').addEventListener('click', function(e) {
            e.preventDefault();
            isSignupMode = !isSignupMode;

            const submitBtn = document.getElementById('authSubmitBtn');
            const toggleText = document.getElementById('authToggleText');
            const toggleLink = document.getElementById('authToggleLink');

            if (isSignupMode) {
                submitBtn.textContent = '회원가입';
                toggleText.textContent = '이미 계정이 있으신가요?';
                toggleLink.textContent = '로그인';
            } else {
                submitBtn.textContent = '로그인';
                toggleText.textContent = '계정이 없으신가요?';
                toggleLink.textContent = '회원가입';
            }

            hideAuthError();
            hideAuthSuccess();
        });

        // Firebase 에러 메시지 한글화
        function getFirebaseErrorMessage(errorCode) {
            const errorMessages = {
                'auth/email-already-in-use': '이미 사용 중인 이메일입니다.',
                'auth/invalid-email': '유효하지 않은 이메일 형식입니다.',
                'auth/operation-not-allowed': '이메일/비밀번호 로그인이 비활성화되어 있습니다.',
                'auth/weak-password': '비밀번호가 너무 약합니다. (최소 6자)',
                'auth/user-disabled': '비활성화된 계정입니다.',
                'auth/user-not-found': '존재하지 않는 계정입니다.',
                'auth/wrong-password': '잘못된 비밀번호입니다.',
                'auth/invalid-credential': '이메일 또는 비밀번호가 올바르지 않습니다.',
                'auth/too-many-requests': '너무 많은 시도가 있었습니다. 잠시 후 다시 시도해주세요.',
                'auth/network-request-failed': '네트워크 오류가 발생했습니다.'
            };
            return errorMessages[errorCode] || '인증 오류가 발생했습니다.';
        }

        // 초기 데이터 생성 (새 사용자용)
        function createInitialData() {
            hobbies = [
                {
                    id: generateId(),
                    name: '운동',
                    type: 'quant',
                    targetValue: 30,
                    unit: '분',
                    icon: '💪',
                    color: COLORS[0],
                    isActive: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: '독서',
                    type: 'quant',
                    targetValue: 30,
                    unit: '분',
                    icon: '📚',
                    color: COLORS[3],
                    isActive: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: '명상',
                    type: 'binary',
                    icon: '🧘',
                    color: COLORS[4],
                    isActive: true,
                    createdAt: new Date().toISOString()
                }
            ];
            records = [];
        }

        // 로그인 후 처리
        async function handleAuthSuccess(user, isNewUser = false) {
            const wasPendingMigration = localStorage.getItem('lifeCommitPendingMigration') === 'true';

            currentUser = {
                uid: user.uid,
                email: user.email,
                name: user.email.split('@')[0]
            };

            // 게스트 모드 플래그 초기화
            isGuestMode = false;
            localStorage.removeItem('lifeCommitGuestMode');
            localStorage.removeItem('lifeCommitPendingMigration');

            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('logoutBtn').textContent = '로그아웃';
            document.getElementById('guestBanner').style.display = 'none';

            if (isNewUser) {
                // 신규 가입 + 게스트 데이터가 있으면 자동 마이그레이션
                if (wasPendingMigration) {
                    loadFromLocalStorage();
                    if (hobbies.length > 0) {
                        await saveToStorage();
                    } else {
                        createInitialData();
                        await saveToStorage();
                    }
                } else {
                    createInitialData();
                    await saveToStorage();
                }
            } else {
                // 기존 유저 로그인
                await loadFromStorage();

                // 게스트 데이터가 있고 Firestore가 비어 있으면 마이그레이션 배너 표시
                if (wasPendingMigration) {
                    const localData = localStorage.getItem('lifeCommitData');
                    const parsed = localData ? JSON.parse(localData) : null;
                    const hasLocalData = parsed && parsed.hobbies && parsed.hobbies.length > 0;
                    const hasCloudData = hobbies.length > 0;

                    if (hasLocalData && !hasCloudData) {
                        // 클라우드가 비어 있으면 자동 마이그레이션
                        loadFromLocalStorage();
                        await saveToStorage();
                    } else if (hasLocalData && hasCloudData) {
                        // 둘 다 있으면 선택 배너 표시
                        showMigrateBanner(parsed);
                    }
                }
            }

            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            renderDashboard();
        }

        // 마이그레이션 선택 배너 표시
        function showMigrateBanner(localParsed) {
            const banner = document.getElementById('migrateBanner');
            banner.innerHTML = `
                <div class="migrate-banner">
                    <div class="migrate-banner-text">
                        <strong>기기에 저장된 게스트 데이터가 있습니다</strong>
                        게스트로 기록한 데이터를 현재 계정으로 가져오시겠습니까? (기존 클라우드 데이터는 유지됩니다)
                    </div>
                    <button class="migrate-yes-btn" id="migrateYesBtn">가져오기</button>
                    <button class="migrate-no-btn" id="migrateNoBtn">무시</button>
                </div>
            `;
            banner.style.display = 'block';

            document.getElementById('migrateYesBtn').addEventListener('click', async function() {
                hobbies = localParsed.hobbies || [];
                records = localParsed.records || [];
                await saveToStorage();
                banner.style.display = 'none';
                renderDashboard();
            });
            document.getElementById('migrateNoBtn').addEventListener('click', function() {
                banner.style.display = 'none';
            });
        }

        // 로그인 처리
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            hideAuthError();

            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const submitBtn = document.getElementById('authSubmitBtn');

            // Firebase가 로드되지 않은 경우 체크
            if (!window.firebaseAuth || !window.firebaseAuthFunctions) {
                showAuthError('Firebase가 아직 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
                return;
            }

            const { createUserWithEmailAndPassword, signInWithEmailAndPassword } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            submitBtn.classList.add('auth-loading');
            submitBtn.disabled = true;

            try {
                if (isSignupMode) {
                    // 회원가입
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    console.log('회원가입 성공:', userCredential.user.email);
                    await handleAuthSuccess(userCredential.user, true);
                } else {
                    // 로그인
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    console.log('로그인 성공:', userCredential.user.email);
                    await handleAuthSuccess(userCredential.user, false);
                }
            } catch (error) {
                console.error('인증 오류:', error);
                showAuthError(getFirebaseErrorMessage(error.code));
            } finally {
                submitBtn.classList.remove('auth-loading');
                submitBtn.disabled = false;
            }
        });

        // 로그아웃
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            // 게스트 모드에서는 "로그인하기" 버튼으로 동작
            if (isGuestMode) {
                exitGuestModeToLogin();
                return;
            }

            if (confirm('로그아웃 하시겠습니까?')) {
                try {
                    if (window.firebaseAuth && window.firebaseAuthFunctions) {
                        const { signOut } = window.firebaseAuthFunctions;
                        await signOut(window.firebaseAuth);
                    }

                    currentUser = null;
                    hobbies = [];
                    records = [];

                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('loginPage').style.display = 'flex';

                    // 폼 초기화
                    document.getElementById('loginForm').reset();
                    hideAuthError();
                } catch (error) {
                    console.error('로그아웃 오류:', error);
                }
            }
        });

        // 테마 토글
        document.getElementById('themeToggle').addEventListener('click', function() {
            toggleTheme();
        });

        // 모바일 메뉴 토글
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const isOpen = sidebar.classList.contains('mobile-open');

            if (isOpen) {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('mobile-open');
                overlay.classList.add('active');
            }
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
        }

        document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
        document.getElementById('mobileOverlay').addEventListener('click', closeMobileMenu);

        // 페이지 네비게이션
        document.querySelectorAll('.nav-link, .widget-action').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.getAttribute('data-page');
                if (page) {
                    navigateTo(page);
                }
            });
        });

        function navigateTo(page) {
            currentPage = page;

            // 모바일 메뉴 닫기
            closeMobileMenu();

            // 네비게이션 활성화
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                }
            });

            // 페이지 표시
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById(page + 'Page').classList.add('active');

            // 페이지별 렌더링
            switch(page) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'hobbies':
                    renderHobbiesList();
                    break;
                case 'overall':
                    renderOverall();
                    break;
                case 'stats':
                    renderStats();
                    break;
            }
        }

        // 대시보드 렌더링
        function renderDashboard() {
            // 오늘 날짜 표시
            document.getElementById('todayDate').textContent = getKoreanDate(new Date());

            // 활성 취미 가져오기
            const activeHobbies = hobbies.filter(h => h.isActive);
            const today = getTodayString();

            // 오늘의 진행도 계산
            const todayRecords = records.filter(r => r.date === today);
            const completedCount = activeHobbies.filter(hobby => {
                const record = todayRecords.find(r => r.hobbyId === hobby.id);
                return record && record.achieved;
            }).length;

            // 진행도 원 업데이트
            const progressCircle = document.getElementById('todayProgress');
            const percentage = activeHobbies.length > 0 ? (completedCount / activeHobbies.length) * 100 : 0;
            progressCircle.style.background = `conic-gradient(var(--success) ${percentage}%, var(--grass-empty) 0%)`;
            progressCircle.querySelector('.progress-text').textContent = `${completedCount}/${activeHobbies.length}`;

            // 취미 카드 렌더링
            const container = document.getElementById('hobbyCardsContainer');
            if (activeHobbies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">🌱</div>
                        <h3 class="empty-title">취미를 추가해보세요</h3>
                        <p class="empty-text">첫 번째 습관을 만들고 꾸준함을 기록하세요</p>
                        <button class="btn btn-primary" onclick="navigateTo('hobbies')">취미 추가하기</button>
                    </div>
                `;
            } else {
                container.innerHTML = activeHobbies.map(hobby => {
                    const record = todayRecords.find(r => r.hobbyId === hobby.id);
                    let status = 'pending';
                    let statusText = '미완료';
                    let recordValue = '';

                    if (record) {
                        if (hobby.type === 'quant') {
                            recordValue = `${record.value}${hobby.unit}`;
                            if (record.value >= hobby.targetValue * 1.5) {
                                status = 'exceeded';
                                statusText = '초과달성';
                            } else if (record.achieved) {
                                status = 'completed';
                                statusText = '완료';
                            } else {
                                status = 'pending';
                                statusText = '미완료';
                            }
                        } else {
                            if (record.achieved) {
                                status = 'completed';
                                statusText = '완료';
                            } else {
                                status = 'pending';
                                statusText = '미완료';
                            }
                        }
                    }

                    const targetText = hobby.type === 'quant' 
                        ? `목표: ${hobby.targetValue}${hobby.unit}`
                        : '완료 여부 체크';

                    return `
                        <div class="hobby-card" onclick="showHobbyDetail('${hobby.id}')">
                            <div class="hobby-card-header">
                                <div class="hobby-info">
                                    <div class="hobby-name">
                                        <span class="hobby-icon">${hobby.icon}</span>
                                        ${hobby.name}
                                    </div>
                                    <div class="hobby-target">${targetText}</div>
                                    ${recordValue ? `<div class="hobby-target" style="color: var(--success); font-weight: 600;">${recordValue}</div>` : ''}
                                </div>
                                <div class="hobby-status status-${status}">${statusText}</div>
                            </div>
                            <div class="hobby-action" style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" style="flex: 1;" onclick="event.stopPropagation(); toggleTodayRecord('${hobby.id}')">
                                    ${record ? (record.achieved ? '<span style="text-decoration: line-through; text-decoration-thickness: 2px; text-decoration-color: currentColor;">완료</span>' : '완료') : '오늘 체크'}
                                </button>
                                <button class="btn btn-secondary" onclick="event.stopPropagation(); editHobby('${hobby.id}')" title="취미 설정 수정">
                                    ⚙️
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // 대시보드 Overall 잔디밭 렌더링
            renderDashboardOverall();

            // 대시보드 통계 렌더링
            renderDashboardStats();
        }

        // 대시보드 Overall 잔디밭 렌더링
        function renderDashboardOverall() {
            const yearSelect = document.getElementById('dashboardOverallYearSelect');
            const year = parseInt(yearSelect.value);
            
            yearSelect.onchange = function() {
                renderDashboardOverall();
            };

            renderOverallGrassInContainer('dashboardOverallGrassContainer', year);

            // 통계 업데이트
            document.getElementById('dashboardOverallYearCount').textContent = calculateOverallCount(year);
            document.getElementById('dashboardOverallCurrentStreak').textContent = calculateOverallCurrentStreak();
            document.getElementById('dashboardOverallMaxStreak').textContent = calculateOverallMaxStreak(year);
        }

        // 대시보드 통계 렌더링
        function renderDashboardStats() {
            const yearSelect = document.getElementById('dashboardStatsYearSelect');
            const year = parseInt(yearSelect.value);
            
            yearSelect.onchange = function() {
                renderDashboardStats();
            };

            // 전체 통계 계산
            const activeHobbies = hobbies.filter(h => h.isActive);
            const yearRecords = records.filter(r => {
                const recordYear = parseInt(r.date.split('-')[0]);
                return recordYear === year;
            });

            const totalDays = Math.min(365, Math.floor((new Date() - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24)) + 1);
            const totalPossible = totalDays * activeHobbies.length;
            const totalAchieved = yearRecords.filter(r => r.achieved).length;
            const achievementRate = totalPossible > 0 ? Math.round((totalAchieved / totalPossible) * 100) : 0;

            const overallCount = calculateOverallCount(year);
            const overallRate = totalDays > 0 ? Math.round((overallCount / totalDays) * 100) : 0;

            // 통계 카드 렌더링
            const statsContainer = document.getElementById('dashboardStatsContainer');
            statsContainer.innerHTML = `
                <div class="stats-card">
                    <div class="stats-card-title">전체 달성률</div>
                    <div class="stats-card-value">${achievementRate}%</div>
                    <div class="stats-card-label">${totalAchieved} / ${totalPossible}</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">완벽한 하루</div>
                    <div class="stats-card-value">${overallCount}</div>
                    <div class="stats-card-label">총 ${totalDays}일 중</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">종합 달성률</div>
                    <div class="stats-card-value">${overallRate}%</div>
                    <div class="stats-card-label">완벽한 하루 비율</div>
                </div>
            `;

            // 취미별 통계
            const hobbyStatsContainer = document.getElementById('dashboardHobbyStatsContainer');
            if (activeHobbies.length === 0) {
                hobbyStatsContainer.innerHTML = `
                    <div class="empty-state">
                        <p class="empty-text">활성 취미가 없습니다</p>
                    </div>
                `;
            } else {
                hobbyStatsContainer.innerHTML = activeHobbies.map(hobby => {
                    const hobbyRecords = yearRecords.filter(r => r.hobbyId === hobby.id);
                    const achievedCount = hobbyRecords.filter(r => r.achieved).length;
                    const rate = totalDays > 0 ? Math.round((achievedCount / totalDays) * 100) : 0;
                    const currentStreak = calculateCurrentStreak(hobby.id);
                    const maxStreak = calculateMaxStreak(hobby.id, year);

                    return `
                        <div class="hobby-stat-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                            <div class="hobby-stat-name">
                                <span>${hobby.icon}</span>
                                <span>${hobby.name}</span>
                            </div>
                            <div style="text-align: right;">
                                <div class="hobby-stat-value">${rate}%</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                                    현재 ${currentStreak}일 · 최장 ${maxStreak}일
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Overall 달성 여부 체크
        function checkOverallAchievement(date) {
            const activeHobbies = hobbies.filter(h => h.isActive);
            if (activeHobbies.length === 0) return false;

            const dayRecords = records.filter(r => r.date === date);
            
            return activeHobbies.every(hobby => {
                const record = dayRecords.find(r => r.hobbyId === hobby.id);
                return record && record.achieved;
            });
        }

        // Overall 잔디 렌더링 (재사용 가능)
        function renderOverallGrassInContainer(containerId, year) {
            const container = document.getElementById(containerId);
            
            // 잔디 그리드 생성
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            let html = '<div class="grass-graph"><div class="grass-grid">';
            
            let currentDate = new Date(startDate);
            
            // 첫 주의 시작을 월요일로 맞추기
            while (currentDate.getDay() !== 1) {
                currentDate.setDate(currentDate.getDate() - 1);
            }

            let weekCount = 0;
            while (currentDate <= endDate || currentDate.getDay() !== 1) {
                html += '<div class="grass-column">';
                
                for (let day = 0; day < 7; day++) {
                    const dateStr = formatDate(currentDate);
                    const isAchieved = checkOverallAchievement(dateStr);
                    const isCurrentYear = currentDate.getFullYear() === year;
                    
                    html += `<div class="grass-cell-full ${isAchieved && isCurrentYear ? 'level-4' : ''}" 
                             title="${dateStr}${isAchieved ? ' - 완벽한 하루' : ''}"></div>`;
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                html += '</div>';
                weekCount++;
                
                if (weekCount > 53) break;
            }
            
            html += '</div></div>';
            
            // 범례 추가
            html += `
                <div class="grass-legend">
                    <span>Less</span>
                    <div class="grass-legend-item"><div class="grass-cell"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-4"></div></div>
                    <span>More</span>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // Overall 카운트 계산
        function calculateOverallCount(year) {
            let count = 0;
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            const today = new Date();
            const lastDate = endDate > today ? today : endDate;

            for (let d = new Date(startDate); d <= lastDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                if (checkOverallAchievement(dateStr)) {
                    count++;
                }
            }
            return count;
        }

        // Quick Stats 렌더링
        // 현재 스트릭 계산
        function calculateCurrentStreak(hobbyId) {
            const today = new Date();
            let streak = 0;
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                
                const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                if (record && record.achieved) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        // 최장 스트릭 계산
        function calculateMaxStreak(hobbyId, year) {
            let maxStreak = 0;
            let currentStreak = 0;
            
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                
                if (record && record.achieved) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            }
            
            return maxStreak;
        }

        // 오늘 기록 토글 (완료형) 또는 모달 열기 (수치형)
        async function toggleTodayRecord(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            const today = getTodayString();
            const existingRecord = records.find(r => r.hobbyId === hobbyId && r.date === today);

            if (hobby.type === 'binary') {
                // 완료형: 토글 방식
                if (existingRecord) {
                    // 기존 기록이 있으면 achieved 토글
                    existingRecord.achieved = !existingRecord.achieved;
                    existingRecord.updatedAt = new Date().toISOString();
                } else {
                    // 기존 기록이 없으면 완료로 생성
                    const newRecord = {
                        id: generateId(),
                        hobbyId: hobbyId,
                        date: today,
                        achieved: true,
                        createdAt: new Date().toISOString()
                    };
                    records.push(newRecord);
                }
                await saveToStorage();
                renderDashboard();
            } else {
                // 수치형: 모달 열기
                openRecordModal(hobbyId);
            }
        }

        // 기록 모달 열기
        function openRecordModal(hobbyId, date = null) {
            selectedHobbyId = hobbyId;
            const hobby = hobbies.find(h => h.id === hobbyId);
            const targetDate = date || getTodayString();
            
            document.getElementById('recordModalTitle').textContent = 
                date ? '기록 수정' : '오늘 기록하기';
            document.getElementById('recordModalSubtitle').textContent = 
                `${hobby.icon} ${hobby.name} - ${targetDate}`;

            const existingRecord = records.find(r => r.hobbyId === hobbyId && r.date === targetDate);
            
            let formHtml = '';
            if (hobby.type === 'quant') {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">달성량 *</label>
                        <div class="form-row">
                            <input type="number" class="form-input" id="recordValue" 
                                   value="${existingRecord ? existingRecord.value : ''}" 
                                   placeholder="${hobby.targetValue}" min="0" required>
                            <input type="text" class="form-input" value="${hobby.unit}" readonly>
                        </div>
                        <div style="margin-top: 8px; font-size: 13px; color: var(--text-secondary);">
                            목표: ${hobby.targetValue}${hobby.unit}
                        </div>
                    </div>
                `;
            } else {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">완료 여부</label>
                        <div class="radio-group">
                            <label class="radio-label ${!existingRecord || existingRecord.achieved ? '' : 'selected'}">
                                <input type="radio" name="achieved" value="false" ${!existingRecord || !existingRecord.achieved ? 'checked' : ''}>
                                <span>미완료</span>
                            </label>
                            <label class="radio-label ${existingRecord && existingRecord.achieved ? 'selected' : ''}">
                                <input type="radio" name="achieved" value="true" ${existingRecord && existingRecord.achieved ? 'checked' : ''}>
                                <span>완료</span>
                            </label>
                        </div>
                    </div>
                `;
            }

            document.getElementById('recordFormContent').innerHTML = formHtml;
            document.getElementById('recordMemo').value = existingRecord ? (existingRecord.memo || '') : '';
            
            // 라디오 버튼 스타일 업데이트
            document.querySelectorAll('.radio-label').forEach(label => {
                label.addEventListener('click', function() {
                    document.querySelectorAll('.radio-label').forEach(l => l.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            document.getElementById('recordModal').classList.add('active');
        }

        function closeRecordModal() {
            document.getElementById('recordModal').classList.remove('active');
            selectedHobbyId = null;
        }

        // 기록 저장
        document.getElementById('recordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const hobby = hobbies.find(h => h.id === selectedHobbyId);
            const today = getTodayString();
            const memo = document.getElementById('recordMemo').value;
            
            let recordData = {
                hobbyId: selectedHobbyId,
                date: today,
                memo: memo,
                createdAt: new Date().toISOString()
            };

            if (hobby.type === 'quant') {
                const value = parseInt(document.getElementById('recordValue').value);
                recordData.value = value;
                recordData.achieved = value >= hobby.targetValue;
            } else {
                const achievedInput = document.querySelector('input[name="achieved"]:checked');
                recordData.achieved = achievedInput.value === 'true';
            }

            // 기존 기록 확인
            const existingIndex = records.findIndex(r => r.hobbyId === selectedHobbyId && r.date === today);
            if (existingIndex >= 0) {
                recordData.id = records[existingIndex].id;
                records[existingIndex] = recordData;
            } else {
                recordData.id = generateId();
                records.push(recordData);
            }

            await saveToStorage();
            closeRecordModal();
            renderDashboard();
        });

        // 취미 목록 렌더링
        function renderHobbiesList() {
            const container = document.getElementById('hobbyListContainer');
            
            if (hobbies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🌱</div>
                        <h3 class="empty-title">아직 취미가 없습니다</h3>
                        <p class="empty-text">첫 번째 취미를 추가해보세요</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = hobbies.map(hobby => {
                const targetText = hobby.type === 'quant' 
                    ? `${hobby.targetValue}${hobby.unit}`
                    : '완료형';
                
                const recordCount = records.filter(r => r.hobbyId === hobby.id).length;

                return `
                    <div class="hobby-list-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                        <div class="hobby-list-info">
                            <div class="hobby-list-name">
                                <span>${hobby.icon}</span>
                                ${hobby.name}
                            </div>
                            <div class="hobby-list-meta">
                                목표: ${targetText} · 총 ${recordCount}회 기록
                            </div>
                        </div>
                        <div class="hobby-list-actions">
                            <div class="toggle-switch ${hobby.isActive ? 'active' : ''}" 
                                 onclick="event.stopPropagation(); toggleHobbyActive('${hobby.id}')">
                                <div class="toggle-slider"></div>
                            </div>
                            <button class="btn-icon" onclick="event.stopPropagation(); editHobby('${hobby.id}')">
                                수정
                            </button>
                            <button class="btn-icon" onclick="event.stopPropagation(); deleteHobby('${hobby.id}')" 
                                    style="color: var(--danger);">
                                삭제
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 취미 활성화/비활성화
        async function toggleHobbyActive(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            hobby.isActive = !hobby.isActive;
            await saveToStorage();
            renderHobbiesList();
        }

        // 취미 삭제
        async function deleteHobby(hobbyId) {
            const hobby = hobbies.find(h => h.id === hobbyId);
            if (confirm(`"${hobby.name}"을(를) 삭제하시겠습니까?\n모든 기록도 함께 삭제됩니다.`)) {
                hobbies = hobbies.filter(h => h.id !== hobbyId);
                records = records.filter(r => r.hobbyId !== hobbyId);
                await saveToStorage();
                renderHobbiesList();
            }
        }

        // 새 취미 버튼
        document.getElementById('newHobbyBtn').addEventListener('click', function() {
            openHobbyModal();
        });

        // 취미 모달 열기
        function openHobbyModal(hobbyId = null) {
            if (hobbyId) {
                // 수정 모드
                const hobby = hobbies.find(h => h.id === hobbyId);
                document.getElementById('hobbyModalTitle').textContent = '취미 수정';
                document.getElementById('hobbyName').value = hobby.name;
                
                // 타입 설정
                document.querySelector(`input[name="hobbyType"][value="${hobby.type}"]`).checked = true;
                
                if (hobby.type === 'quant') {
                    document.getElementById('quantFields').style.display = 'block';
                    document.getElementById('binaryFields').style.display = 'none';
                    document.getElementById('targetValue').value = hobby.targetValue;
                    document.getElementById('targetUnit').value = hobby.unit;
                    document.getElementById('targetValue').required = true;
                    document.getElementById('targetUnit').required = true;
                } else {
                    document.getElementById('quantFields').style.display = 'none';
                    document.getElementById('binaryFields').style.display = 'block';
                    document.getElementById('binaryDesc').value = hobby.description || '';
                    document.getElementById('targetValue').required = false;
                    document.getElementById('targetUnit').required = false;
                }
                
                // 아이콘 선택
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                    if (opt.getAttribute('data-icon') === hobby.icon) {
                        opt.classList.add('selected');
                    }
                });
                
                // 폼에 수정 중인 ID 저장
                document.getElementById('hobbyForm').setAttribute('data-edit-id', hobbyId);
            } else {
                // 생성 모드
                document.getElementById('hobbyModalTitle').textContent = '새 취미 추가';
                document.getElementById('hobbyForm').reset();
                document.getElementById('hobbyForm').removeAttribute('data-edit-id');
                
                // 기본값으로 수치형 선택 및 필드 표시
                document.querySelector('input[name="hobbyType"][value="quant"]').checked = true;
                document.getElementById('quantFields').style.display = 'block';
                document.getElementById('binaryFields').style.display = 'none';
                document.getElementById('targetValue').required = true;
                document.getElementById('targetUnit').required = true;
                
                // 아이콘 선택 초기화
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                document.querySelector('.icon-option').classList.add('selected');
            }
            
            document.getElementById('hobbyModal').classList.add('active');
        }

        function closeHobbyModal() {
            document.getElementById('hobbyModal').classList.remove('active');
            document.getElementById('hobbyForm').removeAttribute('data-edit-id');
        }

        // 취미 수정 함수
        function editHobby(hobbyId) {
            openHobbyModal(hobbyId);
        }

        // 취미 타입 변경
        document.querySelectorAll('input[name="hobbyType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'quant') {
                    document.getElementById('quantFields').style.display = 'block';
                    document.getElementById('binaryFields').style.display = 'none';
                    document.getElementById('targetValue').required = true;
                    document.getElementById('targetUnit').required = true;
                } else {
                    document.getElementById('quantFields').style.display = 'none';
                    document.getElementById('binaryFields').style.display = 'block';
                    document.getElementById('targetValue').required = false;
                    document.getElementById('targetUnit').required = false;
                }
            });
        });

        // 아이콘 선택
        document.querySelectorAll('.icon-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
            });
        });

        // 취미 저장
        document.getElementById('hobbyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const editId = this.getAttribute('data-edit-id');
            const name = document.getElementById('hobbyName').value;
            const type = document.querySelector('input[name="hobbyType"]:checked').value;
            const icon = document.querySelector('.icon-option.selected').getAttribute('data-icon');
            
            if (editId) {
                // 수정 모드
                const hobby = hobbies.find(h => h.id === editId);
                hobby.name = name;
                hobby.type = type;
                hobby.icon = icon;
                
                if (type === 'quant') {
                    hobby.targetValue = parseInt(document.getElementById('targetValue').value);
                    hobby.unit = document.getElementById('targetUnit').value;
                    delete hobby.description;
                } else {
                    const desc = document.getElementById('binaryDesc').value;
                    if (desc) hobby.description = desc;
                    delete hobby.targetValue;
                    delete hobby.unit;
                }
                
                hobby.updatedAt = new Date().toISOString();
            } else {
                // 생성 모드
                const hobbyData = {
                    id: generateId(),
                    name: name,
                    type: type,
                    icon: icon,
                    color: COLORS[hobbies.length % COLORS.length],
                    isActive: true,
                    createdAt: new Date().toISOString()
                };

                if (type === 'quant') {
                    hobbyData.targetValue = parseInt(document.getElementById('targetValue').value);
                    hobbyData.unit = document.getElementById('targetUnit').value;
                } else {
                    const desc = document.getElementById('binaryDesc').value;
                    if (desc) hobbyData.description = desc;
                }

                hobbies.push(hobbyData);
            }

            await saveToStorage();
            closeHobbyModal();

            // 현재 페이지에 따라 렌더링
            if (currentPage === 'hobbies') {
                renderHobbiesList();
            } else if (currentPage === 'dashboard') {
                renderDashboard();
            }
        });

        // 취미 상세 보기
        function showHobbyDetail(hobbyId) {
            selectedHobbyId = hobbyId;
            const hobby = hobbies.find(h => h.id === hobbyId);
            
            document.getElementById('hobbyDetailTitle').textContent = hobby.name;
            document.getElementById('hobbyDetailName').textContent = `${hobby.icon} ${hobby.name}`;
            
            const targetText = hobby.type === 'quant' 
                ? `목표: ${hobby.targetValue}${hobby.unit}`
                : '완료형 목표';
            document.getElementById('hobbyDetailSubtitle').textContent = targetText;

            navigateTo('hobbyDetail');
            renderHobbyGrass(hobbyId, new Date().getFullYear());
        }

        // 취미 잔디밭 렌더링
        function renderHobbyGrass(hobbyId, year) {
            const container = document.getElementById('hobbyDetailGrassContainer');
            const hobby = hobbies.find(h => h.id === hobbyId);
            
            // 연도 선택기 설정
            const yearSelect = document.getElementById('hobbyDetailYearSelect');
            yearSelect.value = year;
            yearSelect.onchange = function() {
                renderHobbyGrass(hobbyId, parseInt(this.value));
            };

            // 월 라벨
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // 잔디 그리드 생성
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            let html = '<div class="grass-graph"><div class="grass-grid">';
            
            let currentDate = new Date(startDate);
            
            // 첫 주의 시작을 월요일로 맞추기
            while (currentDate.getDay() !== 1) {
                currentDate.setDate(currentDate.getDate() - 1);
            }

            let weekCount = 0;
            while (currentDate <= endDate || currentDate.getDay() !== 1) {
                html += '<div class="grass-column">';
                
                for (let day = 0; day < 7; day++) {
                    const dateStr = formatDate(currentDate);
                    const record = records.find(r => r.hobbyId === hobbyId && r.date === dateStr);
                    
                    let level = 0;
                    let tooltipText = dateStr;
                    
                    if (record) {
                        if (hobby.type === 'quant') {
                            const percentage = (record.value / hobby.targetValue) * 100;
                            if (percentage >= 150) level = 4;
                            else if (percentage >= 100) level = 3;
                            else if (percentage >= 50) level = 2;
                            else level = 1;
                            tooltipText += ` - ${record.value}${hobby.unit}`;
                        } else {
                            level = record.achieved ? 4 : 0;
                            tooltipText += record.achieved ? ' - 완료' : '';
                        }
                    }

                    const isCurrentYear = currentDate.getFullYear() === year;
                    
                    html += `<div class="grass-cell-full ${level > 0 && isCurrentYear ? `level-${level}` : ''}" 
                             title="${tooltipText}"></div>`;
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                html += '</div>';
                weekCount++;
                
                if (weekCount > 53) break;
            }
            
            html += '</div></div>';
            
            // 범례 추가
            html += `
                <div class="grass-legend">
                    <span>Less</span>
                    <div class="grass-legend-item"><div class="grass-cell"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-1"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-2"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-3"></div></div>
                    <div class="grass-legend-item"><div class="grass-cell level-4"></div></div>
                    <span>More</span>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // 대시보드로 돌아가기
        document.getElementById('backToDashboard').addEventListener('click', function() {
            navigateTo('dashboard');
        });

        // Overall 페이지 렌더링
        function renderOverall() {
            const year = parseInt(document.getElementById('overallYearSelect').value);
            renderOverallGrass(year);
            
            document.getElementById('overallYearSelect').onchange = function() {
                renderOverall();
            };
        }

        function renderOverallGrass(year) {
            renderOverallGrassInContainer('overallGrassContainer', year);

            // 통계 업데이트
            document.getElementById('overallYearCount').textContent = calculateOverallCount(year);
            
            const currentStreak = calculateOverallCurrentStreak();
            document.getElementById('overallCurrentStreak').textContent = currentStreak;
            
            const maxStreak = calculateOverallMaxStreak(year);
            document.getElementById('overallMaxStreak').textContent = maxStreak;
        }

        function calculateOverallCurrentStreak() {
            const today = new Date();
            let streak = 0;
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = formatDate(date);
                
                if (checkOverallAchievement(dateStr)) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function calculateOverallMaxStreak(year) {
            let maxStreak = 0;
            let currentStreak = 0;
            
            const startDate = new Date(year, 0, 1);
            const endDate = new Date(year, 11, 31);
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                
                if (checkOverallAchievement(dateStr)) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            }
            
            return maxStreak;
        }

        // 통계 페이지 렌더링
        function renderStats() {
            const year = parseInt(document.getElementById('statsYearSelect').value);
            
            document.getElementById('statsYearSelect').onchange = function() {
                renderStats();
            };

            // 전체 통계 계산
            const activeHobbies = hobbies.filter(h => h.isActive);
            const yearRecords = records.filter(r => {
                const recordYear = parseInt(r.date.split('-')[0]);
                return recordYear === year;
            });

            const totalDays = Math.min(365, Math.floor((new Date() - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24)) + 1);
            const totalPossible = totalDays * activeHobbies.length;
            const totalAchieved = yearRecords.filter(r => r.achieved).length;
            const achievementRate = totalPossible > 0 ? Math.round((totalAchieved / totalPossible) * 100) : 0;

            const overallCount = calculateOverallCount(year);
            const overallRate = totalDays > 0 ? Math.round((overallCount / totalDays) * 100) : 0;

            // 통계 카드 렌더링
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="stats-card">
                    <div class="stats-card-title">전체 달성률</div>
                    <div class="stats-card-value">${achievementRate}%</div>
                    <div class="stats-card-label">${totalAchieved} / ${totalPossible}</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">완벽한 하루</div>
                    <div class="stats-card-value">${overallCount}</div>
                    <div class="stats-card-label">총 ${totalDays}일 중</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">종합 달성률</div>
                    <div class="stats-card-value">${overallRate}%</div>
                    <div class="stats-card-label">완벽한 하루 비율</div>
                </div>
            `;

            // 취미별 통계
            const hobbyStatsContainer = document.getElementById('hobbyStatsContainer');
            hobbyStatsContainer.innerHTML = activeHobbies.map(hobby => {
                const hobbyRecords = yearRecords.filter(r => r.hobbyId === hobby.id);
                const achievedCount = hobbyRecords.filter(r => r.achieved).length;
                const rate = totalDays > 0 ? Math.round((achievedCount / totalDays) * 100) : 0;
                const currentStreak = calculateCurrentStreak(hobby.id);
                const maxStreak = calculateMaxStreak(hobby.id, year);

                return `
                    <div class="hobby-stat-item" onclick="showHobbyDetail('${hobby.id}')" style="cursor: pointer;">
                        <div class="hobby-stat-name">
                            <span>${hobby.icon}</span>
                            <span>${hobby.name}</span>
                        </div>
                        <div style="text-align: right;">
                            <div class="hobby-stat-value">${rate}%</div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                                현재 ${currentStreak}일 · 최장 ${maxStreak}일
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            if (activeHobbies.length === 0) {
                hobbyStatsContainer.innerHTML = `
                    <div class="empty-state">
                        <p class="empty-text">활성 취미가 없습니다</p>
                    </div>
                `;
            }
        }

        // Firebase 인증 상태 감지 설정
        function setupAuthStateListener() {
            if (!window.firebaseAuth || !window.firebaseAuthFunctions) {
                // Firebase가 아직 로드되지 않은 경우 재시도
                setTimeout(setupAuthStateListener, 100);
                return;
            }

            const { onAuthStateChanged } = window.firebaseAuthFunctions;
            const auth = window.firebaseAuth;

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    // 사용자가 로그인된 상태
                    console.log('인증 상태: 로그인됨', user.email);
                    await handleAuthSuccess(user, false);
                } else {
                    // 사용자가 로그아웃된 상태
                    console.log('인증 상태: 로그아웃됨');
                    // 게스트 모드 세션이 있으면 복원
                    if (localStorage.getItem('lifeCommitGuestMode') === 'true') {
                        await handleGuestMode();
                    } else {
                        currentUser = null;
                        document.getElementById('mainApp').style.display = 'none';
                        document.getElementById('loginPage').style.display = 'flex';
                    }
                }
            });
        }

        // 초기 로드
        window.addEventListener('load', function() {
            initTheme();

            // Firebase 인증 상태 감지 시작
            setupAuthStateListener();
        });
    </script>
</body>
</html>
